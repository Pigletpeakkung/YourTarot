<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystical Fortune Cards - Ultimate Edition</title>
    
    <!-- Enhanced CDN Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;900&family=Cormorant+Garamond:wght@300;400;600&family=Poiret+One:wght@400&family=Uncial+Antiqua:wght@400&display=swap" rel="stylesheet">
    
    <!-- Meta Tags for SEO and Social -->
    <meta name="description" content="Experience the ultimate mystical fortune cards with stunning 3D effects, magical animations, and personalized cosmic insights.">
    <meta name="keywords" content="fortune cards, mystical, tarot, spiritual, fortune telling, magic, cosmic">
    <meta property="og:title" content="Mystical Fortune Cards - Ultimate Edition">
    <meta property="og:description" content="Discover your cosmic destiny with stunning 3D mystical fortune cards">
    <meta property="og:type" content="website">
    
    <style>
        :root {
            --bg-color: #0a0618;
            --bg-gradient: linear-gradient(135deg, #0a0618 0%, #1a0b2e 30%, #16213e 60%, #0f3460 100%);
            --primary-color: #9969ff;
            --secondary-color: #ff69a1;
            --tertiary-color: #69b4ff;
            --accent-color: #ffeb3b;
            --text-color: #ffffff;
            --card-back: linear-gradient(45deg, #4a0e77, #650d6d, #7b1fa2);
            --card-front: linear-gradient(135deg, #2b2f66, #1c1647, #3f2a5c);
            --card-hover: #764ba2;
            --glitter-color: rgba(255, 235, 59, 0.9);
            --shine-color: hsla(280, 95%, 85%, 0.8);
            --shadow-color: rgba(0, 0, 0, 0.8);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Cormorant Garamond", serif;
            background: var(--bg-gradient);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="8" fill="rgba(153,105,255,0.6)" stroke="rgba(255,255,255,0.8)" stroke-width="2"/></svg>'), auto;
        }

        /* Enhanced Background Effects */
        .cosmic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(153, 105, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(255, 105, 161, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(105, 180, 255, 0.05) 0%, transparent 50%);
            z-index: -1;
            animation: cosmicShift 20s ease-in-out infinite;
        }

        @keyframes cosmicShift {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        /* Enhanced Canvas Elements */
        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #shine-canvas { z-index: 1; }
        #particle-canvas { z-index: 2; }
        #glitter-canvas { z-index: 3; }
        #constellation-canvas { z-index: 4; }

        /* Enhanced Container */
        .container {
            width: 100%;
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 10;
        }

        /* Enhanced Header */
        header {
            text-align: center;
            margin-bottom: 4rem;
            position: relative;
            z-index: 11;
        }

        .magical-title {
            font-family: "Cinzel", serif;
            font-size: clamp(2.5rem, 8vw, 5rem);
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color), var(--tertiary-color), var(--accent-color));
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite, titlePulse 2s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(153, 105, 255, 0.6);
            position: relative;
            filter: drop-shadow(0 0 20px var(--shine-color));
        }

        .magical-title::before {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, var(--shine-color), transparent);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShimmer 3s ease-in-out infinite;
            opacity: 0.7;
        }

        @keyframes titleShimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes titlePulse {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 20px var(--shine-color)); }
            50% { filter: brightness(1.3) drop-shadow(0 0 30px var(--shine-color)); }
        }

        .subtitle {
            font-size: clamp(1.2rem, 3vw, 1.6rem);
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 2rem;
            animation: subtitleGlow 3s ease-in-out infinite;
            text-shadow: 0 0 10px var(--shine-color);
            font-style: italic;
        }

        @keyframes subtitleGlow {
            0%, 100% { 
                opacity: 0.8; 
                text-shadow: 0 0 10px var(--shine-color); 
            }
            50% { 
                opacity: 1; 
                text-shadow: 0 0 20px var(--shine-color); 
            }
        }

        /* Enhanced Energy Orb */
        .energy-orb {
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, var(--shine-color) 0%, rgba(255, 105, 161, 0.3) 40%, transparent 70%);
            border-radius: 50%;
            animation: energyPulse 5s ease-in-out infinite;
            filter: blur(3px);
        }

        .energy-orb::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 60%);
            border-radius: 50%;
            animation: innerOrb 3s ease-in-out infinite reverse;
        }

        @keyframes energyPulse {
            0%, 100% { 
                transform: translateX(-50%) scale(1); 
                opacity: 0.4; 
                filter: blur(3px);
            }
            50% { 
                transform: translateX(-50%) scale(1.8); 
                opacity: 0.8; 
                filter: blur(2px);
            }
        }

        @keyframes innerOrb {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        /* Enhanced Floating Symbols */
        .mystical-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .floating-symbol {
            position: absolute;
            font-size: 3rem;
            opacity: 0.3;
            animation: float 12s ease-in-out infinite;
            text-shadow: 0 0 20px var(--shine-color);
            filter: drop-shadow(0 0 15px var(--shine-color));
            transition: all 0.3s ease;
        }

        .floating-symbol:nth-child(odd) {
            animation-direction: reverse;
        }

        .floating-symbol:hover {
            transform: scale(1.5) rotate(180deg);
            opacity: 0.8;
            text-shadow: 0 0 30px var(--shine-color);
        }

        /* Enhanced floating positions */
        .floating-symbol:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
        .floating-symbol:nth-child(2) { top: 20%; right: 15%; animation-delay: -2s; }
        .floating-symbol:nth-child(3) { bottom: 30%; left: 20%; animation-delay: -4s; }
        .floating-symbol:nth-child(4) { bottom: 20%; right: 10%; animation-delay: -1s; }
        .floating-symbol:nth-child(5) { top: 50%; left: 5%; animation-delay: -3s; }
        .floating-symbol:nth-child(6) { top: 70%; right: 25%; animation-delay: -5s; }
        .floating-symbol:nth-child(7) { top: 30%; left: 50%; animation-delay: -6s; }
        .floating-symbol:nth-child(8) { bottom: 60%; right: 50%; animation-delay: -7s; }

        @keyframes float {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg) scale(1); 
                opacity: 0.3;
            }
            25% { 
                transform: translateY(-40px) rotate(90deg) scale(1.1); 
                opacity: 0.5;
            }
            50% { 
                transform: translateY(-20px) rotate(180deg) scale(0.9); 
                opacity: 0.7;
            }
            75% { 
                transform: translateY(-30px) rotate(270deg) scale(1.05); 
                opacity: 0.4;
            }
        }

        /* Enhanced Control Panel */
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 1000;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 15px 35px var(--shadow-color);
        }

                .control-btn {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 0.8rem;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--primary-color);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
            z-index: -1;
        }

        .control-btn:hover::before {
            width: 100%;
            height: 100%;
        }

        .control-btn:hover {
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--primary-color);
        }

        .control-btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 0 15px var(--primary-color);
        }

        /* Enhanced Settings Panel */
        .settings-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 15px 35px var(--shadow-color);
            z-index: 1000;
            transform: translateX(-100%);
            transition: transform 0.4s ease;
            min-width: 280px;
        }

        .settings-panel.open {
            transform: translateX(0);
        }

        .settings-title {
            font-family: "Cinzel", serif;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
            color: var(--accent-color);
            text-shadow: 0 0 10px var(--shine-color);
        }

        .setting-group {
            margin-bottom: 1.5rem;
        }

        .setting-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .setting-slider {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .setting-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px var(--primary-color);
        }

        .setting-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px var(--primary-color);
        }

        .setting-toggle {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--primary-color);
        }

        .toggle-switch.active::before {
            left: 33px;
        }

        /* Enhanced Card Selection */
        .card-selection {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin-bottom: 4rem;
            z-index: 11;
            position: relative;
            flex-wrap: wrap;
        }

        .mystical-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 1.5rem 3rem;
            font-family: "Cinzel", serif;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 25px rgba(153, 105, 255, 0.4);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .mystical-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, var(--shine-color), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }

        .mystical-btn:hover::before {
            animation: shimmer 1s ease-in-out;
        }

        .mystical-btn:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 40px rgba(153, 105, 255, 0.6);
            filter: drop-shadow(0 0 15px var(--shine-color));
        }

        .mystical-btn:active {
            transform: translateY(-4px) scale(1.02);
        }

        .mystical-btn.secondary {
            background: linear-gradient(45deg, var(--tertiary-color), var(--accent-color));
            box-shadow: 0 10px 25px rgba(105, 180, 255, 0.4);
        }

        .mystical-btn.secondary:hover {
            box-shadow: 0 20px 40px rgba(105, 180, 255, 0.6);
        }

        .mystical-btn.danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.4);
        }

        .mystical-btn.danger:hover {
            box-shadow: 0 20px 40px rgba(255, 107, 107, 0.6);
        }

        @keyframes shimmer {
            0% { transform: translateX(-200%) translateY(-200%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(200%) translateY(200%) rotate(45deg); opacity: 0; }
        }

        /* Enhanced Card Stats */
        .card-stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            min-width: 120px;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px var(--shadow-color);
        }

        .stat-number {
            font-family: "Cinzel", serif;
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-color);
            text-shadow: 0 0 15px var(--shine-color);
            animation: countGlow 2s ease-in-out infinite;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @keyframes countGlow {
            0%, 100% { 
                filter: brightness(1);
                text-shadow: 0 0 15px var(--shine-color);
            }
            50% { 
                filter: brightness(1.5);
                text-shadow: 0 0 25px var(--shine-color);
            }
        }

        /* Enhanced Card Table */
        .card-table {
            perspective: 2000px;
            margin-bottom: 4rem;
            min-height: 600px;
            z-index: 11;
            position: relative;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 3rem;
            max-width: 1400px;
            margin: 0 auto;
            padding: 4rem 2rem;
        }

        .card {
            width: 200px;
            height: 350px;
            position: relative;
            transform-style: preserve-3d;
            transition: all 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            filter: brightness(0.9);
            justify-self: center;
            border-radius: 25px;
        }

        .card:hover {
            filter: brightness(1.4) drop-shadow(0 0 30px var(--shine-color));
            transform: translateY(-30px) rotateY(25deg) scale(1.1);
        }

        .card.selected {
            transform: scale(1.3) translateY(-40px) rotateY(0deg);
            z-index: 100;
            filter: drop-shadow(0 0 40px var(--shine-color)) brightness(1.5);
        }

        .card.flipped {
            transform: rotateY(180deg);
            pointer-events: none;
        }

        /* Enhanced Card Rarity System */
        .card.common {
            --card-rarity-color: rgba(200, 200, 200, 0.4);
            --card-rarity-glow: rgba(200, 200, 200, 0.2);
        }

        .card.uncommon {
            --card-rarity-color: rgba(76, 175, 80, 0.5);
            --card-rarity-glow: rgba(76, 175, 80, 0.3);
        }

        .card.rare {
            --card-rarity-color: rgba(63, 81, 181, 0.6);
            --card-rarity-glow: rgba(63, 81, 181, 0.4);
        }

        .card.epic {
            --card-rarity-color: rgba(156, 39, 176, 0.7);
            --card-rarity-glow: rgba(156, 39, 176, 0.5);
        }

        .card.legendary {
            --card-rarity-color: var(--shine-color);
            --card-rarity-glow: var(--shine-color);
            animation: legendaryAura 4s ease-in-out infinite;
        }

        .card.mythic {
            --card-rarity-color: rgba(255, 215, 0, 0.9);
            --card-rarity-glow: rgba(255, 215, 0, 0.7);
            animation: mythicAura 3s ease-in-out infinite;
        }

        @keyframes legendaryAura {
            0%, 100% { 
                box-shadow: 0 0 20px var(--card-rarity-glow);
                filter: brightness(0.9);
            }
            50% { 
                box-shadow: 0 0 50px var(--card-rarity-glow);
                filter: brightness(1.2);
            }
        }

        @keyframes mythicAura {
            0%, 100% { 
                box-shadow: 0 0 30px var(--card-rarity-glow);
                filter: brightness(1) hue-rotate(0deg);
            }
            33% { 
                box-shadow: 0 0 60px var(--card-rarity-glow);
                filter: brightness(1.3) hue-rotate(120deg);
            }
            66% { 
                box-shadow: 0 0 45px var(--card-rarity-glow);
                filter: brightness(1.1) hue-rotate(240deg);
            }
        }

        /* Enhanced Card Faces */
        .card-face {
            width: 100%;
            height: 100%;
            position: absolute;
            backface-visibility: hidden;
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 25px 50px var(--shadow-color);
            overflow: hidden;
        }

        .card-back {
            background: var(--card-back);
            border: 3px solid var(--card-rarity-color);
            position: relative;
        }

        .card-back::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 85%;
            height: 85%;
            background: radial-gradient(circle, var(--card-rarity-color) 0%, transparent 70%);
            border-radius: 50%;
            animation: innerGlow 4s ease-in-out infinite;
        }

        .card-back::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(45deg, var(--shine-color) 0, var(--shine-color) 1px, transparent 1px, transparent 20px),
                repeating-linear-gradient(-45deg, rgba(255, 255, 255, 0.05) 0, rgba(255, 255, 255, 0.05) 1px, transparent 1px, transparent 20px);
            border-radius: 25px;
            animation: patternShift 15s linear infinite;
            opacity: 0.4;
        }

        @keyframes innerGlow {
            0%, 100% { 
                opacity: 0.5; 
                transform: translate(-50%, -50%) scale(1); 
            }
            50% { 
                opacity: 0.9; 
                transform: translate(-50%, -50%) scale(1.4); 
            }
        }

        @keyframes patternShift {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 40px 40px, -40px -40px; }
        }

        .card-front {
            background: var(--card-front);
            transform: rotateY(180deg);
            padding: 2rem;
            text-align: center;
            border: 3px solid var(--card-rarity-color);
            position: relative;
        }

        .card-front::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--card-rarity-glow) 0%, transparent 50%);
            border-radius: 25px;
            opacity: 0.3;
        }

        /* Enhanced Card Content */
        .card-symbol {
            font-size: 4.5rem;
            margin-bottom: 1.5rem;
            opacity: 0.95;
            animation: symbolGlow 3s ease-in-out infinite;
            filter: drop-shadow(0 0 20px var(--shine-color));
            position: relative;
            z-index: 2;
        }

        @keyframes symbolGlow {
            0%, 100% { 
                text-shadow: 0 0 20px var(--shine-color); 
                transform: scale(1) rotate(0deg);
            }
            50% { 
                text-shadow: 0 0 40px var(--shine-color); 
                transform: scale(1.1) rotate(5deg);
            }
        }

        .card-title {
            font-family: "Cinzel", serif;
            font-size: 1.7rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShimmer 2s ease-in-out infinite;
            text-shadow: 0 0 15px var(--shine-color);
            position: relative;
            z-index: 2;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        @keyframes titleShimmer {
            0%, 100% { 
                filter: brightness(1);
                text-shadow: 0 0 15px var(--shine-color);
            }
            50% { 
                filter: brightness(1.5);
                text-shadow: 0 0 25px var(--shine-color);
            }
        }

                .card-desc {
            font-size: 1.2rem;
            opacity: 0.9;
            line-height: 1.6;
            font-style: italic;
            text-shadow: 0 0 8px var(--shine-color);
            position: relative;
            z-index: 2;
            margin-bottom: 1rem;
        }

        .card-rarity-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--card-rarity-color);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 10px var(--card-rarity-glow);
            z-index: 3;
        }

        .card-element {
            position: absolute;
            bottom: 15px;
            left: 15px;
            font-size: 1.5rem;
            opacity: 0.7;
            z-index: 3;
        }

        /* Enhanced Fortune Display */
        .message-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.6s ease;
            z-index: 2000;
        }

        .message-container.visible {
            opacity: 1;
            pointer-events: all;
        }

        .message-card {
            width: 95%;
            max-width: 900px;
            background: rgba(15, 10, 30, 0.95);
            backdrop-filter: blur(25px);
            padding: 4rem;
            border-radius: 35px;
            border: 3px solid var(--shine-color);
            text-align: center;
            box-shadow: 0 30px 80px var(--shadow-color);
            transform: translateY(100px) scale(0.8);
            opacity: 0;
            transition: all 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }

        .message-card::before {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: radial-gradient(circle, var(--shine-color) 0%, transparent 70%);
            animation: cardAura 6s ease-in-out infinite;
            opacity: 0.15;
        }

        @keyframes cardAura {
            0%, 100% { 
                opacity: 0.1; 
                transform: rotate(0deg) scale(1); 
            }
            50% { 
                opacity: 0.3; 
                transform: rotate(180deg) scale(1.2); 
            }
        }

        .message-container.visible .message-card {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .card-reveal-animation {
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            z-index: 1;
        }

        .cosmic-circle {
            width: 100%;
            height: 100%;
            border: 4px solid var(--shine-color);
            border-radius: 50%;
            animation: cosmicSpin 4s linear infinite;
            position: relative;
            box-shadow: 0 0 30px var(--shine-color);
        }

        .cosmic-circle::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            border: 2px solid rgba(255, 105, 161, 0.5);
            border-radius: 50%;
            animation: cosmicSpin 3s linear infinite reverse;
        }

        .cosmic-circle::after {
            content: '';
            position: absolute;
            top: 30px;
            left: 30px;
            right: 30px;
            bottom: 30px;
            border: 1px solid rgba(105, 180, 255, 0.3);
            border-radius: 50%;
            animation: cosmicSpin 2s linear infinite;
        }

        @keyframes cosmicSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .message-content {
            margin-top: 5rem;
            position: relative;
            z-index: 2;
        }

        .message-title {
            font-family: "Cinzel", serif;
            font-size: clamp(2rem, 6vw, 3.5rem);
            margin-bottom: 2rem;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color), var(--tertiary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShimmer 2s ease-in-out infinite;
            text-shadow: 0 0 25px var(--shine-color);
            filter: drop-shadow(0 0 20px var(--shine-color));
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .message-text {
            font-size: clamp(1.4rem, 4vw, 2rem);
            line-height: 1.8;
            margin-bottom: 2rem;
            opacity: 0.95;
            animation: textGlow 3s ease-in-out infinite;
            font-style: italic;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        @keyframes textGlow {
            0%, 100% { 
                text-shadow: 0 0 15px var(--shine-color); 
                opacity: 0.9;
            }
            50% { 
                text-shadow: 0 0 25px var(--shine-color); 
                opacity: 1;
            }
        }

        .fortune-details {
            font-size: 1.4rem;
            opacity: 0.8;
            margin-bottom: 3rem;
            font-style: italic;
            color: var(--accent-color);
            animation: detailsPulse 4s ease-in-out infinite;
            text-shadow: 0 0 12px var(--shine-color);
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes detailsPulse {
            0%, 100% { 
                opacity: 0.7; 
                transform: scale(1);
            }
            50% { 
                opacity: 1; 
                transform: scale(1.02);
            }
        }

        .message-actions {
            display: flex;
            gap: 2rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        /* Enhanced Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 2.5rem;
            border-radius: 20px;
            font-family: "Cinzel", serif;
            z-index: 10000;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            border: 2px solid var(--shine-color);
            min-width: 300px;
            backdrop-filter: blur(15px);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

                .notification-icon {
            font-size: 1.5rem;
            animation: notificationPulse 2s ease-in-out infinite;
        }

        @keyframes notificationPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .notification-text {
            flex: 1;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .notification-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Enhanced Progress Bar */
        .progress-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            padding: 1rem 2rem;
            min-width: 300px;
            z-index: 1000;
        }

        .progress-label {
            text-align: center;
            margin-bottom: 0.5rem;
            font-family: "Cinzel", serif;
            font-size: 1.1rem;
            color: var(--accent-color);
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--tertiary-color));
            background-size: 200% 100%;
            border-radius: 5px;
            transition: width 0.3s ease;
            animation: progressShine 2s linear infinite;
        }

        @keyframes progressShine {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Enhanced Loading Animation */
        .loading-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5000;
            flex-direction: column;
            gap: 2rem;
        }

        .loading-spinner {
            width: 120px;
            height: 120px;
            border: 6px solid rgba(153, 105, 255, 0.3);
            border-top: 6px solid var(--shine-color);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            box-shadow: 0 0 40px var(--shine-color);
            position: relative;
        }

        .loading-spinner::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 3px solid rgba(255, 105, 161, 0.3);
            border-top: 3px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite reverse;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-family: "Cinzel", serif;
            font-size: 1.5rem;
            color: var(--accent-color);
            animation: loadingPulse 2s ease-in-out infinite;
            text-shadow: 0 0 20px var(--shine-color);
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* Enhanced Footer */
        footer {
            text-align: center;
            margin-top: 6rem;
            padding: 3rem 0;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-top: 1px solid var(--glass-border);
            position: relative;
            z-index: 11;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .mystical-quote {
            font-family: "Poiret One", cursive;
            font-style: italic;
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 2rem;
            animation: quoteFade 5s ease-in-out infinite;
            text-shadow: 0 0 20px var(--shine-color);
        }

        @keyframes quoteFade {
            0%, 100% { 
                opacity: 0.7;
                text-shadow: 0 0 15px var(--shine-color);
            }
            50% { 
                opacity: 1;
                text-shadow: 0 0 30px var(--shine-color);
            }
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .footer-link {
            color: var(--text-color);
            text-decoration: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
            font-family: "Cinzel", serif;
            font-size: 1rem;
        }

        .footer-link:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(153, 105, 255, 0.3);
        }

        /* Enhanced Responsive Design */
        @media (max-width: 1200px) {
            .cards-container {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 2.5rem;
            }
        }

        @media (max-width: 768px) {
            .magical-title {
                font-size: 2.5rem;
            }
            
            .cards-container {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 2rem;
                padding: 2rem 1rem;
            }
            
            .card {
                width: 150px;
                height: 260px;
            }
            
            .card-symbol {
                font-size: 3rem;
            }
            
            .card-title {
                font-size: 1.2rem;
            }
            
            .card-desc {
                font-size: 1rem;
            }
            
            .message-card {
                padding: 2rem;
                margin: 1rem;
            }
            
            .mystical-btn {
                padding: 1rem 2rem;
                font-size: 1rem;
            }
            
            .control-panel {
                top: 10px;
                right: 10px;
                padding: 1rem;
            }
            
            .settings-panel {
                top: 10px;
                left: 10px;
                min-width: 250px;
            }
            
            .card-stats {
                gap: 1rem;
            }
            
            .footer-links {
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 1rem;
            }
            
            .cards-container {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 1.5rem;
            }
            
            .card {
                width: 120px;
                height: 200px;
            }
            
            .card-symbol {
                font-size: 2.5rem;
            }
            
            .card-title {
                font-size: 1rem;
            }
            
            .card-desc {
                font-size: 0.9rem;
            }
            
            .message-card {
                padding: 1.5rem;
            }
            
            .control-panel {
                position: static;
                margin: 1rem auto;
                flex-direction: row;
                justify-content: center;
            }
            
            .settings-panel {
                position: static;
                transform: none;
                margin: 1rem auto;
                min-width: auto;
                width: 100%;
            }
        }

        /* Enhanced Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Enhanced Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #000000;
                --text-color: #ffffff;
                --glass-bg: rgba(255, 255, 255, 0.05);
                --glass-border: rgba(255, 255, 255, 0.15);
            }
        }

        /* Enhanced Print Styles */
        @media print {
            .control-panel,
            .settings-panel,
            .loading-animation,
            .notification,
            .progress-container,
            canvas {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .card {
                break-inside: avoid;
            }
        }

        /* Enhanced Focus Styles */
        .mystical-btn:focus,
        .control-btn:focus,
        .toggle-switch:focus,
        .setting-slider:focus {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }

        /* Enhanced Selection Styles */
        ::selection {
            background: var(--primary-color);
            color: white;
        }

        ::-moz-selection {
            background: var(--primary-color);
            color: white;
        }

        /* Enhanced Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
    </style>
</head>
<body>
    <!-- Enhanced Canvas Elements -->
    <canvas id="shine-canvas"></canvas>
    <canvas id="particle-canvas"></canvas>
    <canvas id="glitter-canvas"></canvas>
    <canvas id="constellation-canvas"></canvas>
    
    <!-- Enhanced Background -->
    <div class="cosmic-bg"></div>
    
    <!-- Loading Animation -->
    <div class="loading-animation" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Channeling cosmic energies...</div>
    </div>
    
    <!-- Enhanced Floating Symbols -->
    <div class="mystical-bg">
        <div class="floating-symbol animate__animated animate__fadeInUp">✨</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-1s">🌙</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-2s">⭐</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-3s">🔮</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-4s">🌟</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-5s">💫</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-6s">🦋</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-7s">🌈</div>
    </div>

    <!-- Enhanced Control Panel -->
    <div class="control-panel">
                <button class="control-btn" id="settingsBtn" title="Settings (S)" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>
        <button class="control-btn" id="soundBtn" title="Toggle Sound (M)" aria-label="Toggle Sound">
            <i class="fas fa-volume-up"></i>
        </button>
        <button class="control-btn" id="fullscreenBtn" title="Fullscreen (F)" aria-label="Toggle Fullscreen">
            <i class="fas fa-expand"></i>
        </button>
        <button class="control-btn" id="themeBtn" title="Toggle Theme (T)" aria-label="Toggle Theme">
            <i class="fas fa-palette"></i>
        </button>
        <button class="control-btn" id="helpBtn" title="Help (H)" aria-label="Show Help">
            <i class="fas fa-question"></i>
        </button>
        <button class="control-btn" id="shareBtn" title="Share (P)" aria-label="Share Fortune">
            <i class="fas fa-share-alt"></i>
        </button>
    </div>

    <!-- Enhanced Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-title">Mystical Settings</div>
        
        <div class="setting-group">
            <label class="setting-label">Particle Density</label>
            <input type="range" class="setting-slider" id="particleDensity" min="1" max="10" value="5">
        </div>
        
        <div class="setting-group">
            <label class="setting-label">Animation Speed</label>
            <input type="range" class="setting-slider" id="animationSpeed" min="0.5" max="3" step="0.1" value="1">
        </div>
        
        <div class="setting-group">
            <label class="setting-label">Glow Intensity</label>
            <input type="range" class="setting-slider" id="glowIntensity" min="0.1" max="2" step="0.1" value="1">
        </div>
        
        <div class="setting-group">
            <div class="setting-toggle">
                <span class="setting-label">Auto-Shuffle</span>
                <div class="toggle-switch" id="autoShuffle"></div>
            </div>
        </div>
        
        <div class="setting-group">
            <div class="setting-toggle">
                <span class="setting-label">Particle Effects</span>
                <div class="toggle-switch active" id="particleEffects"></div>
            </div>
        </div>
        
        <div class="setting-group">
            <div class="setting-toggle">
                <span class="setting-label">Screen Shake</span>
                <div class="toggle-switch" id="screenShake"></div>
            </div>
        </div>
        
        <div class="setting-group">
            <button class="mystical-btn" id="resetSettings">Reset to Default</button>
        </div>
    </div>

    <!-- Enhanced Main Container -->
    <div class="container">
        <!-- Enhanced Header -->
        <header class="animate__animated animate__fadeInDown">
            <div class="energy-orb"></div>
            <h1 class="magical-title" data-text="Mystical Fortune Cards">
                Mystical Fortune Cards
            </h1>
            <p class="subtitle animate__animated animate__fadeInUp animate__delay-1s">
                Discover your cosmic destiny through the ancient art of divination. 
                Each card holds the power to reveal hidden truths and guide your spiritual journey.
            </p>
        </header>

        <!-- Enhanced Stats -->
        <div class="card-stats animate__animated animate__fadeInUp animate__delay-2s">
            <div class="stat-item">
                <div class="stat-number" id="totalDraws">0</div>
                <div class="stat-label">Total Draws</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="rareCards">0</div>
                <div class="stat-label">Rare Cards</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="luckScore">0</div>
                <div class="stat-label">Luck Score</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="streakCount">0</div>
                <div class="stat-label">Current Streak</div>
            </div>
        </div>

        <!-- Enhanced Card Selection -->
        <div class="card-selection animate__animated animate__fadeInUp animate__delay-3s">
            <button class="mystical-btn" id="drawCard" onclick="drawCard()">
                <i class="fas fa-magic"></i> Draw Your Fortune
            </button>
            <button class="mystical-btn secondary" id="shuffleCards" onclick="shuffleCards()">
                <i class="fas fa-random"></i> Shuffle Deck
            </button>
            <button class="mystical-btn" id="drawThree" onclick="drawThreeCards()">
                <i class="fas fa-star"></i> Three Card Reading
            </button>
            <button class="mystical-btn danger" id="clearHistory" onclick="clearHistory()">
                <i class="fas fa-trash"></i> Clear History
            </button>
        </div>

        <!-- Enhanced Progress Bar -->
        <div class="progress-container" id="progressContainer" style="display: none;">
            <div class="progress-label">Mystical Energy</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- Enhanced Card Table -->
        <div class="card-table">
            <div class="cards-container" id="cardContainer">
                <!-- Cards will be generated dynamically -->
            </div>
        </div>

        <!-- Enhanced Footer -->
        <footer class="animate__animated animate__fadeInUp animate__delay-4s">
            <div class="footer-content">
                <div class="mystical-quote" id="mysticalQuote">
                    "The universe speaks to those who listen with their hearts."
                </div>
                <div class="footer-links">
                    <a href="#" class="footer-link" onclick="showAbout()">About</a>
                    <a href="#" class="footer-link" onclick="showHelp()">Help</a>
                    <a href="#" class="footer-link" onclick="showCredits()">Credits</a>
                    <a href="#" class="footer-link" onclick="contact()">Contact</a>
                </div>
                <p>&copy; 2024 Mystical Fortune Cards. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Enhanced Fortune Message Display -->
    <div class="message-container" id="messageContainer">
        <div class="message-card animate__animated animate__zoomIn">
            <div class="card-reveal-animation">
                <div class="cosmic-circle"></div>
            </div>
            <div class="message-content">
                <h2 class="message-title" id="messageTitle">Your Fortune</h2>
                <p class="message-text" id="messageText">The cards have spoken...</p>
                <div class="fortune-details" id="fortuneDetails">
                    Additional insights will appear here...
                </div>
                <div class="message-actions">
                    <button class="mystical-btn" onclick="saveReading()">
                        <i class="fas fa-save"></i> Save Reading
                    </button>
                    <button class="mystical-btn secondary" onclick="shareReading()">
                        <i class="fas fa-share"></i> Share
                    </button>
                    <button class="mystical-btn" onclick="drawAnother()">
                        <i class="fas fa-redo"></i> Draw Another
                    </button>
                    <button class="mystical-btn danger" onclick="closeMessage()">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced JavaScript -->
    <script>
        class UltimateEnhancedMysticalCards {
            constructor() {
                this.initializeApp();
                this.setupEventListeners();
                this.initializeCanvas();
                this.initializeSettings();
                this.initializeStats();
                this.initializeAudio();
                this.startAnimations();
                this.preloadResources();
            }

            initializeApp() {
                // Enhanced card data with more detailed information
                this.cards = [
                    {
                        title: "The Cosmic Dreamer",
                        symbol: "🌌",
                        desc: "Dreams manifest into reality through cosmic alignment",
                        fortune: "Your deepest aspirations are aligning with universal forces. The cosmos whispers secrets of manifestation to those who dare to dream beyond the veil of ordinary perception.",
                        rarity: "legendary",
                        element: "🌠",
                        power: 95,
                        wisdom: "Dreams are the language of the soul",
                        guidance: "Trust in your visions, for they are messages from your higher self"
                    },
                    {
                        title: "The Time Weaver",
                        symbol: "⏳",
                        desc: "Past, present, and future converge in this moment",
                        fortune: "The threads of time are weaving a tapestry of opportunity around you. What seemed lost in the past is returning in a new form, bringing wisdom and renewed purpose.",
                        rarity: "mythic",
                        element: "⚡",
                        power: 98,
                        wisdom: "Time is a river that flows in all directions",
                        guidance: "Embrace the lessons of the past while stepping boldly into your future"
                    },
                    {
                        title: "The Soul's Mirror",
                        symbol: "🪞",
                        desc: "Reflection reveals the truth within",
                        fortune: "Look deeper than the surface, for your soul's mirror reflects not just who you are, but who you are becoming. The person you seek to be already exists within you.",
                        rarity: "rare",
                        element: "💎",
                        power: 87,
                        wisdom: "The outer world reflects your inner state",
                        guidance: "Change your perception, and you change your reality"
                    },
                    {
                        title: "The Phoenix Rising",
                        symbol: "🔥",
                        desc: "From ashes of the old, new life emerges",
                        fortune: "Like the phoenix, you are being reborn from the ashes of what no longer serves you. This transformation, though challenging, leads to unprecedented growth and power.",
                        rarity: "epic",
                        element: "🔥",
                        power: 92,
                        wisdom: "Destruction is the beginning of creation",
                        guidance: "Embrace the fire of change, for it purifies and strengthens"
                    },
                    {
                        title: "The Infinite Path",
                        symbol: "♾️",
                        desc: "Every ending is a new beginning",
                        fortune: "Your journey has no true end, only transformation. Each step you take creates new pathways of possibility, extending infinitely into realms of potential you have yet to explore.",
                        rarity: "legendary",
                        element: "🌈",
                        power: 94,
                        wisdom: "The path itself is the destination",
                        guidance: "Trust the journey, for it knows where you need to go"
                    },
                    {
                        title: "The Quantum Heart",
                        symbol: "💖",
                        desc: "Love transcends all dimensions",
                        fortune: "Your heart operates on quantum principles, capable of love that transcends time and space. The connections you make now will ripple through eternity, creating bonds that cannot be broken.",
                        rarity: "mythic",
                        element: "💫",
                        power: 99,
                        wisdom: "Love is the force that binds the universe",
                        guidance: "Lead with your heart, for it knows truths your mind cannot comprehend"
                    },
                    {
                        title: "The Stellar Navigator",
                        symbol: "🧭",
                        desc: "Stars guide those who seek their light",
                        fortune: "The stars have aligned to provide you with clear direction. Your internal compass is perfectly calibrated to navigate the cosmic currents that will carry you to your destiny.",
                        rarity: "rare",
                        element: "⭐",
                        power: 88,
                        wisdom: "Direction comes from within",
                        guidance: "Trust your inner navigation system"
                    },
                    {
                        title: "The Crystal Oracle",
                        symbol: "🔮",
                        desc: "Clarity emerges from the crystal's depths",
                        fortune: "The mists of confusion are clearing, revealing crystal-clear insights about your path. Your intuitive abilities are heightened, allowing you to perceive truth with unprecedented clarity.",
                        rarity: "epic",
                        element: "💎",
                        power: 90,
                        wisdom: "Clarity is the gift of stillness",
                        guidance: "Quiet your mind to hear the whispers of wisdom"
                    },
                    {
                        title: "The Lunar Mystic",
                        symbol: "🌙",
                        desc: "Moon cycles bring transformation and insight",
                        fortune: "The lunar energies are particularly strong around you, bringing heightened intuition and emotional healing. Your psychic abilities are amplified during this powerful moon phase.",
                        rarity: "uncommon",
                        element: "🌙",
                        power: 75,
                        wisdom: "The moon reflects the light of consciousness",
                        guidance: "Honor your cycles and trust your intuition"
                    },
                    {
                        title: "The Solar Warrior",
                        symbol: "☀️",
                        desc: "Inner fire illuminates the path to victory",
                        fortune: "Your inner sun is blazing with confidence and power. Now is the time to step into your full strength and illuminate the darkness with your radiant energy and unwavering determination.",
                        rarity: "epic",
                        element: "☀️",
                        power: 93,
                        wisdom: "Strength comes from inner light",
                        guidance: "Shine your light boldly and fearlessly"
                    },
                    {
                        title: "The Ethereal Dancer",
                        symbol: "🦋",
                        desc: "Grace and transformation flow as one",
                        fortune: "Like a butterfly emerging from its chrysalis, you are experiencing a beautiful transformation. Your grace and elegance are attracting positive energies and opening new doors.",
                        rarity: "uncommon",
                        element: "🌸",
                        power: 78,
                        wisdom: "Transformation is a dance, not a battle",
                        guidance: "Move with grace through all changes"
                    },
                    {
                        title: "The Void Walker",
                        symbol: "🌑",
                        desc: "From emptiness comes infinite possibility",
                        fortune: "You are being called to embrace the void, the space between thoughts where infinite possibility resides. In this sacred emptiness, you will find the seeds of your greatest creations.",
                        rarity: "legendary",
                        element: "🌌",
                        power: 96,
                        wisdom: "The void is not empty, but full of potential",
                        guidance: "Do not fear the unknown, for it is where magic happens"
                    },
                    {
                        title: "The Harmony Keeper",
                        symbol: "🎵",
                        desc: "Universal music guides your steps",
                        fortune: "You are attuned to the cosmic symphony, able to hear the music of the spheres. Your life is coming into perfect harmony, with all elements working together in beautiful synchronicity.",
                        rarity: "rare",
                        element: "🎼",
                        power: 85,
                        wisdom: "Life is a song waiting to be sung",
                        guidance: "Listen to the rhythm of your heart"
                    },
                    {
                        title: "The Wisdom Keeper",
                        symbol: "📚",
                        desc: "Ancient knowledge awakens within",
                        fortune: "The wisdom of ages flows through you now. You are remembering knowledge that transcends this lifetime, accessing the akashic records of universal truth and understanding.",
                        rarity: "epic",
                        element: "📜",
                        power: 89,
                        wisdom: "All knowledge exists within you",
                        guidance: "Trust the wisdom that emerges from stillness"
                    },
                    {
                        title: "The Rainbow Bridge",
                        symbol: "🌈",
                        desc: "Connection between earthly and divine",
                        fortune: "You are serving as a bridge between different worlds, helping others find their way to higher understanding. Your unique perspective brings healing and unity to divided energies.",
                        rarity: "uncommon",
                        element: "🌈",
                        power: 80,
                        wisdom: "Bridges are built with love and understanding",
                        guidance: "Be the connection that others need"
                    },
                    {
                        title: "The Eternal Flame",
                        symbol: "🕯️",
                        desc: "Inner light never dims",
                        fortune: "Your inner flame burns eternal, a beacon of hope in times of darkness. This light within you is indestructible, growing stronger with each challenge you overcome.",
                        rarity: "legendary",
                        element: "🔥",
                        power: 97,
                        wisdom: "The flame of spirit cannot be extinguished",
                        guidance: "Keep your inner light burning bright"
                    }
                ];

                // Enhanced settings
                this.settings = {
                    particleDensity: 5,
                    animationSpeed: 1,
                    glowIntensity: 1,
                    autoShuffle: false,
                    particleEffects: true,
                    screenShake: false,
                    soundEnabled: true,
                    theme: 'cosmic',
                    difficulty: 'normal'
                };

                // Enhanced stats
                this.stats = {
                    totalDraws: 0,
                    rareCards: 0,
                    luckScore: 0,
                    streakCount: 0,
                    savedReadings: [],
                    achievements: [],
                    sessionStart: Date.now()
                };

                // Enhanced state management
                this.state = {
                    isCardSelected: false,
                    selectedCard: null,
                    isAnimating: false,
                    canDraw: true,
                    threeCardMode: false,
                    currentTheme: 'cosmic',
                    lastDrawTime: 0,
                    notifications: [],
                    achievements: new Set()
                };

                // Enhanced arrays for various effects
                this.particles = [];
                this.glitterParticles = [];
                this.shineParticles = [];
                this.constellationParticles = [];
                this.quotes = [
                    "The universe speaks to those who listen with their hearts.",
                    "In the tapestry of existence, every thread has meaning.",
                    "Stars align not by chance, but by cosmic design.",
                    "The wisdom of ages flows through the present moment.",
                    "Your destiny is written in the language of dreams.",
                    "Between breaths lies the space of infinite possibility.",
                    "The soul's journey transcends the boundaries of time.",
                    "In darkness, even the smallest light becomes a beacon."
                ];
            }

            setupEventListeners() {
                // Enhanced keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) return;
                    
                    switch(e.key.toLowerCase()) {
                        case ' ':
                        case 'enter':
                            e.preventDefault();
                            if (this.state.canDraw) this.drawCard();
                            break;
                        case 's':
                            e.preventDefault();
                            this.toggleSettings();
                            break;
                        case 'm':
                            e.preventDefault();
                            this.toggleSound();
                            break;
                        case 'f':
                            e.preventDefault();
                            this.toggleFullscreen();
                            break;
                        case 't':
                            e.preventDefault();
                            this.toggleTheme();
                            break;
                        case 'h':
                            e.preventDefault();
                            this.showHelp();
                            break;
                        case 'p':
                            e.preventDefault();
                            this.shareReading();
                            break;
                        case 'r':
                            e.preventDefault();
                            this.shuffleCards();
                            break;
                        case 'escape':
                            e.preventDefault();
                            this.closeMessage();
                            break;
                    }
                });

                // Enhanced mouse and touch events
                this.handleMouseMove = (e) => {
                    if (this.settings.particleEffects) {
                        this.createTrailParticles(e.clientX, e.clientY);
                    }
                };

                this.handleTouchMove = (e) => {
                    if (this.settings.particleEffects) {
                        const touch = e.touches[0];
                        this.createTrailParticles(touch.clientX, touch.clientY);
                    }
                };

                this.handleResize = () => {
                    this.resizeCanvas();
                };

                // Enhanced event listeners
                window.addEventListener('mousemove', this.handleMouseMove);
                window.addEventListener('touchmove', this.handleTouchMove);
                window.addEventListener('resize', this.handleResize);

                // Enhanced UI event listeners
                this.setupUIEventListeners();
            }

            setupUIEventListeners() {
                // Settings panel
                document.getElementById('settingsBtn').addEventListener('click', () => this.toggleSettings());
                document.getElementById('soundBtn').addEventListener('click', () => this.toggleSound());
                document.getElementById('fullscreenBtn').addEventListener('click', () => this.toggleFullscreen());
                document.getElementById('themeBtn').addEventListener('click', () => this.toggleTheme());
                document.getElementById('helpBtn').addEventListener('click', () => this.showHelp());
                document.getElementById('shareBtn').addEventListener('click', () => this.shareReading());

                // Settings controls
                document.getElementById('particleDensity').addEventListener('input', (e) => {
                    this.settings.particleDensity = parseInt(e.target.value);
                    this.updateParticleSystem();
                });

                document.getElementById('animationSpeed').addEventListener('input', (e) => {
                    this.settings.animationSpeed = parseFloat(e.target.value);
                    this.updateAnimationSpeed();
                });

                document.getElementById('glowIntensity').addEventListener('input', (e) => {
                    this.settings.glowIntensity = parseFloat(e.target.value);
                    this.updateGlowEffects();
                });

                // Toggle switches
                document.getElementById('autoShuffle').addEventListener('click', () => {
                    this.settings.autoShuffle = !this.settings.autoShuffle;
                    this.updateToggleSwitch('autoShuffle');
                    if (this.settings.autoShuffle) {
                        this.startAutoShuffle();
                    } else {
                        this.stopAutoShuffle();
                    }
                });

                document.getElementById('particleEffects').addEventListener('click', () => {
                    this.settings.particleEffects = !this.settings.particleEffects;
                    this.updateToggleSwitch('particleEffects');
                    this.updateParticleSystem();
                });

                document.getElementById('screenShake').addEventListener('click', () => {
                    this.settings.screenShake = !this.settings.screenShake;
                    this.updateToggleSwitch('screenShake');
                });

                document.getElementById('resetSettings').addEventListener('click', () => this.resetSettings());

                // Close settings when clicking outside
                document.addEventListener('click', (e) => {
                    const settingsPanel = document.getElementById('settingsPanel');
                    const settingsBtn = document.getElementById('settingsBtn');
                    if (!settingsPanel.contains(e.target) && !settingsBtn.contains(e.target)) {
                        settingsPanel.classList.remove('open');
                    }
                });

                // Message container close on backdrop click
                document.getElementById('messageContainer').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        this.closeMessage();
                    }
                });
            }

            initializeCanvas() {
                this.canvases = {
                    shine: document.getElementById('shine-canvas'),
                    particle: document.getElementById('particle-canvas'),
                    glitter: document.getElementById('glitter-canvas'),
                    constellation: document.getElementById('constellation-canvas')
                };

                this.contexts = {};
                Object.keys(this.canvases).forEach(key => {
                    this.contexts[key] = this.canvases[key].getContext('2d');
                });

                this.resizeCanvas();
                this.initializeConstellations();
            }

            resizeCanvas() {
                const width = window.innerWidth;
                const height = window.innerHeight;

                Object.values(this.canvases).forEach(canvas => {
                    canvas.width = width;
                    canvas.height = height;
                });
            }

            initializeConstellations() {
                // Create constellation pattern
                const numStars = 50;
                for (let i = 0; i < numStars; i++) {
                    this.constellationParticles.push({
                        x: Math.random() * window.innerWidth,
                        y: Math.random() * window.innerHeight,
                        radius: Math.random() * 2 + 1,
                        opacity: Math.random() * 0.5 + 0.3,
                        twinkleSpeed: Math.random() * 0.02 + 0.01,
                        connections: []
                    });
                }

                // Create connections between nearby stars
                this.constellationParticles.forEach((star, index) => {
                    this.constellationParticles.forEach((otherStar, otherIndex) => {
                        if (index !== otherIndex) {
                            const distance = Math.sqrt(
                                Math.pow(star.x - otherStar.x, 2) + 
                                Math.pow(star.y - otherStar.y, 2)
                            );
                            if (distance < 150 && star.connections.length < 3) {
                                star.connections.push(otherIndex);
                            }
                        }
                    });
                });
            }

            initializeSettings() {
                // Load saved settings
                const savedSettings = localStorage.getItem('mysticalCardsSettings');
                if (savedSettings) {
                    this.settings = { ...this.settings, ...JSON.parse(savedSettings) };
                }

                // Apply settings to UI
                document.getElementById('particleDensity').value = this.settings.particleDensity;
                document.getElementById('animationSpeed').value = this.settings.animationSpeed;
                document.getElementById('glowIntensity').value = this.settings.glowIntensity;
                
                this.updateToggleSwitch('autoShuffle');
                this.updateToggleSwitch('particleEffects');
                this.updateToggleSwitch('screenShake');
            }

            initializeStats() {
                // Load saved stats
                const savedStats = localStorage.getItem('mysticalCardsStats');
                if (savedStats) {
                    this.stats = { ...this.stats, ...JSON.parse(savedStats) };
                }

                this.updateStatsDisplay();
            }

            initializeAudio() {
                // Initialize Web Audio API for enhanced sound effects
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.masterGain = this.audioContext.createGain();
                    this.masterGain.connect(this.audioContext.destination);
                    this.masterGain.gain.value = this.settings.soundEnabled ? 0.3 : 0;
                } catch (error) {
                    console.log('Audio context not available');
                    this.audioContext = null;
                }
            }

            startAnimations() {
                this.animationFrame = requestAnimationFrame(() => this.animate());
                this.startAmbientEffects();
                this.startQuoteRotation();
                
                // Hide loading screen
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    document.body.style.overflow = 'auto';
                }, 2000);
            }

            preloadResources() {
                // Preload any additional resources
                this.createCards();
                this.initializeAchievements();
            }

            createCards() {
                const cardContainer = document.getElementById('cardContainer');
                cardContainer.innerHTML = '';

                this.cards.forEach((card, index) => {
                    const cardElement = this.createCardElement(card, index);
                    cardContainer.appendChild(cardElement);
                });
            }

            createCardElement(card, index) {
                const cardDiv = document.createElement('div');
                cardDiv.className = `card ${card.rarity}`;
                cardDiv.innerHTML = `
                    <div class="card-face card-back">
                        <div class="card-rarity-badge">${card.rarity}</div>
                        <div class="card-element">${card.element}</div>
                        <div class="card-symbol">🌟</div>
                    </div>
                    <div class="card-face card-front">
                        <div class="card-rarity-badge">${card.rarity}</div>
                        <div class="card-element">${card.element}</div>
                        <div class="card-symbol">${card.symbol}</div>
                        <div class="card-title">${card.title}</div>
                        <div class="card-desc">${card.desc}</div>
                    </div>
                `;

                cardDiv.addEventListener('click', () => this.selectCard(index));
                cardDiv.addEventListener('mouseenter', () => this.onCardHover(cardDiv));
                cardDiv.addEventListener('mouseleave', () => this.onCardLeave(cardDiv));

                return cardDiv;
            }

            // Enhanced card interaction methods
            selectCard(index) {
                if (this.state.isAnimating || !this.state.canDraw) return;

                this.state.isAnimating = true;
                this.state.selectedCard = index;
                this.state.isCardSelected = true;

                const card = this.cards[index];
                const cardElement = document.querySelectorAll('.card')[index];

                // Enhanced selection animation
                cardElement.classList.add('selected');
                this.createSelectionParticles(cardElement);
                
                if (this.settings.screenShake) {
                    this.createScreenShake();
                }

                // Play enhanced sound
                this.playEnhancedSound('cardSelect');

                // Reveal card after delay
                setTimeout(() => {
                    this.revealCard(card, cardElement);
                }, 1500);
            }

            revealCard(card, cardElement) {
                cardElement.classList.add('flipped');
                
                // Calculate luck and rarity bonuses
                const luckBonus = this.calculateLuckBonus(card);
                const rarityMultiplier = this.getRarityMultiplier(card.rarity);
                const powerScore = Math.floor(card.power * rarityMultiplier * luckBonus);

                // Update stats
                this.stats.totalDraws++;
                if (['rare', 'epic', 'legendary', 'mythic'].includes(card.rarity)) {
                    this.stats.rareCards++;
                }
                this.stats.luckScore += powerScore;
                this.updateStreakCount(card);

                // Check for achievements
                this.checkAchievements(card);

                // Show fortune message
                setTimeout(() => {
                    this.showFortuneMessage(card, powerScore);
                }, 1000);

                // Save stats
                this.saveStats();
            }

            showFortuneMessage(card, powerScore) {
                const messageContainer = document.getElementById('messageContainer');
                const messageTitle = document.getElementById('messageTitle');
                const messageText = document.getElementById('messageText');
                const fortuneDetails = document.getElementById('fortuneDetails');

                messageTitle.textContent = card.title;
                messageText.textContent = card.fortune;
                fortuneDetails.innerHTML = `
                    <div><strong>Wisdom:</strong> ${card.wisdom}</div>
                    <div><strong>Guidance:</strong> ${card.guidance}</div>
                    <div><strong>Power Level:</strong> ${powerScore}</div>
                    <div><strong>Rarity:</strong> ${card.rarity.toUpperCase()}</div>
                `;

                messageContainer.classList.add('visible');
                
                // Create message particles
                this.createMessageParticles();
                
                // Play reveal sound
                this.playEnhancedSound('fortuneReveal');

                // Reset animation state
                this.state.isAnimating = false;
                this.state.canDraw = true;
            }

            // Enhanced drawing methods
            drawCard() {
                if (this.state.isAnimating || !this.state.canDraw) return;

                // Add cooldown
                const now = Date.now();
                if (now - this.state.lastDrawTime < 1000) {
                    this.showNotification('Please wait before drawing another card', 'warning');
                    return;
                }
                this.state.lastDrawTime = now;

                // Shuffle and select random card
                const availableCards = this.cards.map((_, index) => index);
                const randomIndex = Math.floor(Math.random() * availableCards.length);
                
                this.selectCard(randomIndex);
            }

            drawThreeCards() {
                if (this.state.isAnimating || !this.state.canDraw) return;

                this.state.threeCardMode = true;
                this.state.canDraw = false;

                // Show loading
                this.showNotification('Drawing three cards for your reading...', 'info');

                // Select three random cards
                const selectedCards = [];
                while (selectedCards.length < 3) {
                    const randomIndex = Math.floor(Math.random() * this.cards.length);
                    if (!selectedCards.includes(randomIndex)) {
                        selectedCards.push(randomIndex);
                    }
                }

                // Animate cards one by one
                selectedCards.forEach((cardIndex, i) => {
                    setTimeout(() => {
                        this.selectCard(cardIndex);
                    }, i * 2000);
                });

                // Reset after all cards are drawn
                setTimeout(() => {
                    this.state.threeCardMode = false;
                    this.state.canDraw = true;
                }, 8000);
            }

            shuffleCards() {
                if (this.state.isAnimating) return;

                this.state.isAnimating = true;
                
                // Shuffle animation
                const cards = document.querySelectorAll('.card');
                cards.forEach((card, index) => {
                    setTimeout(() => {
                        card.style.animation = 'shuffle 0.8s ease-in-out';
                        card.addEventListener('animationend', () => {
                            card.style.animation = '';
                        }, { once: true });
                    }, index * 100);
                });

                // Play shuffle sound
                this.playEnhancedSound('shuffle');

                // Reset cards
                setTimeout(() => {
                    this.resetCards();
                    this.state.isAnimating = false;
                    this.showNotification('Cards shuffled successfully!', 'success');
                }, 2000);
            }

            resetCards() {
                const cards = document.querySelectorAll('.card');
                cards.forEach(card => {
                    card.classList.remove('selected', 'flipped');
                });
                this.state.isCardSelected = false;
                this.state.selectedCard = null;
            }

            // Enhanced particle system methods
            createTrailParticles(x, y) {
                if (!this.settings.particleEffects) return;

                for (let i = 0; i < this.settings.particleDensity; i++) {
                    this.particles.push({
                        x: x + (Math.random() - 0.5) * 20,
                        y: y + (Math.random() - 0.5) * 20,
                        vx: (Math.random() - 0.5) * 4,
                        vy: (Math.random() - 0.5) * 4,
                        life: 1,
                        decay: 0.02,
                        size: Math.random() * 4 + 2,
                        color: this.getRandomColor(),
                        type: 'trail'
                    });
                }
            }

            createSelectionParticles(cardElement) {
                const rect = cardElement.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                for (let i = 0; i < 50; i++) {
                    this.particles.push({
                        x: centerX + (Math.random() - 0.5) * 200,
                        y: centerY + (Math.random() - 0.5) * 200,
                        vx: (Math.random() - 0.5) * 8,
                        vy: (Math.random() - 0.5) * 8,
                        life: 1,
                        decay: 0.015,
                        size: Math.random() * 8 + 4,
                        color: 'rgba(255, 215, 0, 0.8)',
                        type: 'selection'
                    });
                }
            }

            createMessageParticles() {
                for (let i = 0; i < 100; i++) {
                    this.particles.push({
                        x: Math.random() * window.innerWidth,
                        y: window.innerHeight,
                        vx: (Math.random() - 0.5) * 2,
                        vy: -Math.random() * 3 - 1,
                        life: 1,
                        decay: 0.01,
                        size: Math.random() * 6 + 3,
                        color: this.getRandomColor(),
                        type: 'message'
                    });
                }
            }

            // Enhanced animation methods
            animate() {
                this.updateParticles();
                this.updateConstellations();
                this.render();
                this.animationFrame = requestAnimationFrame(() => this.animate());
            }

            updateParticles() {
                // Update trail particles
                this.particles = this.particles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life -= particle.decay;
                    particle.vx *= 0.99;
                    particle.vy *= 0.99;
                    particle.size *= 0.99;

                    return particle.life > 0;
                });

                // Update glitter particles
                this.glitterParticles = this.glitterParticles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.rotation += particle.rotationSpeed;
                    particle.life -= particle.decay;
                    particle.size *= 0.98;

                    return particle.life > 0;
                });

                // Update shine particles
                this.shineParticles = this.shineParticles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life -= particle.decay;
                    particle.opacity *= 0.99;

                    return particle.life > 0;
                });
            }

            updateConstellations() {
                this.constellationParticles.forEach(star => {
                    star.opacity += Math.sin(Date.now() * star.twinkleSpeed) * 0.01;
                    star.opacity = Math.max(0.1, Math.min(0.8, star.opacity));
                });
            }

            render() {
                // Clear all canvases
                Object.values(this.contexts).forEach(ctx => {
                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                });

                this.renderConstellations();
                this.renderParticles();
                this.renderGlitter();
                this.renderShine();
            }

            renderConstellations() {
                const ctx = this.contexts.constellation;
                ctx.save();

                // Draw constellation stars
                this.constellationParticles.forEach(star => {
                    ctx.globalAlpha = star.opacity;
                    ctx.fillStyle = '#ffffff';
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = '#9969ff';
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                    ctx.fill();
                });

                // Draw constellation lines
                ctx.strokeStyle = 'rgba(153, 105, 255, 0.3)';
                ctx.lineWidth = 1;
                this.constellationParticles.forEach((star, index) => {
                    star.connections.forEach(connectionIndex => {
                        const connectedStar = this.constellationParticles[connectionIndex];
                        if (connectedStar) {
                            ctx.beginPath();
                            ctx.moveTo(star.x, star.y);
                            ctx.lineTo(connectedStar.x, connectedStar.y);
                            ctx.stroke();
                        }
                    });
                });

                ctx.restore();
            }

            renderParticles() {
                const ctx = this.contexts.particle;
                ctx.save();

                this.particles.forEach(particle => {
                    ctx.globalAlpha = particle.life;
                    ctx.fillStyle = particle.color;
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                });

                ctx.restore();
            }

            renderGlitter() {
                const ctx = this.contexts.glitter;
                ctx.save();

                this.glitterParticles.forEach(particle => {
                    ctx.globalAlpha = particle.life;
                    ctx.fillStyle = particle.color;
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = particle.color;
                    
                    ctx.save();
                    ctx.translate(particle.x, particle.y);
                    ctx.rotate(particle.rotation);
                    ctx.fillRect(-particle.size/2, -particle.size/2, particle.size, particle.size);
                    ctx.restore();
                });

                ctx.restore();
            }

            renderShine() {
                const ctx = this.contexts.shine;
                ctx.save();

                this.shineParticles.forEach(particle => {
                    ctx.globalAlpha = particle.opacity;
                    ctx.fillStyle = particle.color;
                    ctx.shadowBlur = 25;
                    ctx.shadowColor = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                });

                ctx.restore();
            }

            // Enhanced sound methods
            playEnhancedSound(type) {
                if (!this.settings.soundEnabled || !this.audioContext) return;

                const now = this.audioContext.currentTime;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(this.masterGain);

                let frequency, duration, volume;

                switch (type) {
                    case 'cardSelect':
                        frequency = 440;
                        duration = 0.3;
                        volume = 0.2;
                        break;
                    case 'fortuneReveal':
                        frequency = 660;
                        duration = 0.8;
                        volume = 0.3;
                        break;
                    case 'shuffle':
                        frequency = 220;
                        duration = 0.5;
                        volume = 0.15;
                        break;
                    case 'notification':
                        frequency = 880;
                        duration = 0.2;
                        volume = 0.1;
                        break;
                    default:
                        frequency = 440;
                        duration = 0.3;
                        volume = 0.2;
                }

                oscillator.frequency.setValueAtTime(frequency, now);
                oscillator.frequency.exponentialRampToValueAtTime(frequency * 1.5, now + duration);
                
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(volume, now + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);

                oscillator.start(now);
                oscillator.stop(now + duration);
            }

            // Enhanced utility methods
            getRandomColor() {
                const colors = [
                    'rgba(153, 105, 255, 0.8)',
                    'rgba(255, 105, 161, 0.8)',
                    'rgba(105, 180, 255, 0.8)',
                    'rgba(255, 235, 59, 0.8)',
                    'rgba(255, 255, 255, 0.8)'
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            calculateLuckBonus(card) {
                const timeFactor = Math.sin(Date.now() / 10000) * 0.3 + 1;
                const rarityBonus = this.getRarityMultiplier(card.rarity);
                return Math.max(0.5, Math.min(2.0, timeFactor * rarityBonus));
            }

            getRarityMultiplier(rarity) {
                const multipliers = {
                    'common': 1.0,
                    'uncommon': 1.2,
                    'rare': 1.5,
                    'epic': 2.0,
                    'legendary': 2.5,
                    'mythic': 3.0
                };
                return multipliers[rarity] || 1.0;
            }

            updateStreakCount(card) {
                if (['rare', 'epic', 'legendary', 'mythic'].includes(card.rarity)) {
                    this.stats.streakCount++;
                } else {
                    this.stats.streakCount = 0;
                }
            }

            // Enhanced achievement system
            initializeAchievements() {
                this.achievements = [
                    { id: 'first_draw', name: 'First Steps', description: 'Draw your first card', condition: () => this.stats.totalDraws >= 1 },
                    { id: 'lucky_seven', name: 'Lucky Seven', description: 'Draw 7 cards', condition: () => this.stats.totalDraws >= 7 },
                    { id: 'rare_collector', name: 'Rare Collector', description: 'Collect 5 rare cards', condition: () => this.stats.rareCards >= 5 },
                    { id: 'mystic_master', name: 'Mystic Master', description: 'Reach 1000 luck score', condition: () => this.stats.luckScore >= 1000 },
                    { id: 'streak_master', name: 'Streak Master', description: 'Get a 5-card rare streak', condition: () => this.stats.streakCount >= 5 },
                    { id: 'time_traveler', name: 'Time Traveler', description: 'Play for 30 minutes', condition: () => Date.now() - this.stats.sessionStart >= 1800000 }
                ];
            }

            checkAchievements(card) {
                this.achievements.forEach(achievement => {
                    if (!this.state.achievements.has(achievement.id) && achievement.condition()) {
                        this.state.achievements.add(achievement.id);
                        this.showAchievement(achievement);
                    }
                });
            }

            showAchievement(achievement) {
                this.showNotification(`Achievement Unlocked: ${achievement.name}`, 'success');
                this.createAchievementParticles();
                this.playEnhancedSound('notification');
            }

            createAchievementParticles() {
                for (let i = 0; i < 30; i++) {
                    this.particles.push({
                        x: window.innerWidth / 2,
                        y: window.innerHeight / 2,
                        vx: (Math.random() - 0.5) * 10,
                        vy: (Math.random() - 0.5) * 10,
                        life: 1,
                        decay: 0.02,
                        size: Math.random() * 10 + 5,
                        color: 'rgba(255, 215, 0, 0.9)',
                        type: 'achievement'
                    });
                }
            }

            // Enhanced UI methods
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="notification-content">
                        <div class="notification-icon">
                            ${type === 'success' ? '✅' : type === 'warning' ? '⚠️' : 'ℹ️'}
                        </div>
                        <div class="notification-text">${message}</div>
                        <button class="notification-close">×</button>
                    </div>
                `;

                document.body.appendChild(notification);

                // Auto-remove after 5 seconds
                setTimeout(() => {
                    notification.remove();
                }, 5000);

                // Close button
                notification.querySelector('.notification-close').addEventListener('click', () => {
                    notification.remove();
                });

                // Animate in
                setTimeout(() => {
                    notification.classList.add('animate__animated', 'animate__slideInRight');
                }, 100);
            }

            updateStatsDisplay() {
                document.getElementById('totalDraws').textContent = this.stats.totalDraws;
                document.getElementById('rareCards').textContent = this.stats.rareCards;
                document.getElementById('luckScore').textContent = this.stats.luckScore;
                document.getElementById('streakCount').textContent = this.stats.streakCount;
            }

            updateToggleSwitch(switchId) {
                const switchElement = document.getElementById(switchId);
                if (this.settings[switchId]) {
                    switchElement.classList.add('active');
                } else {
                    switchElement.classList.remove('active');
                }
            }

            // Enhanced settings methods
            toggleSettings() {
                const settingsPanel = document.getElementById('settingsPanel');
                settingsPanel.classList.toggle('open');
            }

            toggleSound() {
                this.settings.soundEnabled = !this.settings.soundEnabled;
                if (this.masterGain) {
                    this.masterGain.gain.value = this.settings.soundEnabled ? 0.3 : 0;
                }
                
                const soundBtn = document.getElementById('soundBtn');
                soundBtn.innerHTML = this.settings.soundEnabled ? 
                    '<i class="fas fa-volume-up"></i>' : 
                    '<i class="fas fa-volume-mute"></i>';
                
                this.saveSettings();
            }

            toggleFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        this.showNotification('Fullscreen not supported', 'warning');
                    });
                } else {
                    document.exitFullscreen();
                }
            }

            toggleTheme() {
                const themes = ['cosmic', 'ethereal', 'mystic', 'celestial'];
                const currentIndex = themes.indexOf(this.state.currentTheme);
                const nextIndex = (currentIndex + 1) % themes.length;
                this.state.currentTheme = themes[nextIndex];
                
                this.applyTheme(this.state.currentTheme);
                this.showNotification(`Theme changed to ${this.state.currentTheme}`, 'info');
            }

            applyTheme(theme) {
                const root = document.documentElement;
                
                switch (theme) {
                    case 'ethereal':
                        root.style.setProperty('--primary-color', '#e1bee7');
                        root.style.setProperty('--secondary-color', '#f8bbd9');
                        root.style.setProperty('--tertiary-color', '#b3e5fc');
                        break;
                    case 'mystic':
                        root.style.setProperty('--primary-color', '#4a148c');
                        root.style.setProperty('--secondary-color', '#880e4f');
                        root.style.setProperty('--tertiary-color', '#1a237e');
                        break;
                    case 'celestial':
                        root.style.setProperty('--primary-color', '#ffd700');
                        root.style.setProperty('--secondary-color', '#ff8c00');
                        root.style.setProperty('--tertiary-color', '#4169e1');
                        break;
                    default: // cosmic
                        root.style.setProperty('--primary-color', '#9969ff');
                        root.style.setProperty('--secondary-color', '#ff69a1');
                        root.style.setProperty('--tertiary-color', '#69b4ff');
                }
            }

            resetSettings() {
                this.settings = {
                    particleDensity: 5,
                    animationSpeed: 1,
                    glowIntensity: 1,
                    autoShuffle: false,
                    particleEffects: true,
                    screenShake: false,
                    soundEnabled: true,
                    theme: 'cosmic',
                    difficulty: 'normal'
                };

                this.initializeSettings();
                this.updateParticleSystem();
                this.updateAnimationSpeed();
                this.updateGlowEffects();
                this.showNotification('Settings reset to default', 'info');
            }

            updateParticleSystem() {
                // Adjust particle generation based on settings
                if (!this.settings.particleEffects) {
                    this.particles.length = 0;
                    this.glitterParticles.length = 0;
                    this.shineParticles.length = 0;
                }
            }

            updateAnimationSpeed() {
                document.documentElement.style.setProperty('--animation-speed', this.settings.animationSpeed);
            }

            updateGlowEffects() {
                document.documentElement.style.setProperty('--glow-intensity', this.settings.glowIntensity);
            }

            // Enhanced event handlers
            onCardHover(cardElement) {
                if (this.settings.particleEffects) {
                    const rect = cardElement.getBoundingClientRect();
                    this.createHoverParticles(rect.left + rect.width / 2, rect.top + rect.height / 2);
                }
            }

            onCardLeave(cardElement) {
                // Clean up hover effects
            }

            createHoverParticles(x, y) {
                for (let i = 0; i < 5; i++) {
                    this.particles.push({
                        x: x + (Math.random() - 0.5) * 50,
                        y: y + (Math.random() - 0.5) * 50,
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        life: 1,
                        decay: 0.03,
                        size: Math.random() * 3 + 1,
                        color: 'rgba(255, 255, 255, 0.6)',
                        type: 'hover'
                    });
                }
            }

            createScreenShake() {
                if (!this.settings.screenShake) return;

                const container = document.querySelector('.container');
                container.style.animation = 'screenShake 0.5s ease-in-out';
                setTimeout(() => {
                    container.style.animation = '';
                }, 500);
            }

            // Enhanced ambient effects
            startAmbientEffects() {
                // Ambient particle generation
                this.ambientInterval = setInterval(() => {
                    if (this.settings.particleEffects) {
                        this.createAmbientParticles();
                    }
                }, 2000);

                // Ambient glitter
                this.glitterInterval = setInterval(() => {
                    if (this.settings.particleEffects) {
                        this.createAmbientGlitter();
                    }
                }, 3000);

                // Ambient shine
                this.shineInterval = setInterval(() => {
                    if (this.settings.particleEffects) {
                        this.createAmbientShine();
                    }
                }, 1500);
            }

            createAmbientParticles() {
                for (let i = 0; i < 3; i++) {
                    this.particles.push({
                        x: Math.random() * window.innerWidth,
                        y: window.innerHeight + 50,
                        vx: (Math.random() - 0.5) * 1,
                        vy: -Math.random() * 2 - 1,
                        life: 1,
                        decay: 0.005,
                        size: Math.random() * 4 + 2,
                        color: this.getRandomColor(),
                        type: 'ambient'
                    });
                }
            }

            createAmbientGlitter() {
                for (let i = 0; i < 5; i++) {
                    this.glitterParticles.push({
                        x: Math.random() * window.innerWidth,
                        y: -50,
                        vx: (Math.random() - 0.5) * 2,
                        vy: Math.random() * 3 + 1,
                        rotation: Math.random() * Math.PI * 2,
                        rotationSpeed: (Math.random() - 0.5) * 0.2,
                        life: 1,
                        decay: 0.008,
                        size: Math.random() * 6 + 3,
                        color: 'rgba(255, 215, 0, 0.7)',
                        type: 'glitter'
                    });
                }
            }

            createAmbientShine() {
                for (let i = 0; i < 2; i++) {
                    this.shineParticles.push({
                        x: Math.random() * window.innerWidth,
                        y: Math.random() * window.innerHeight,
                        vx: (Math.random() - 0.5) * 0.5,
                        vy: (Math.random() - 0.5) * 0.5,
                        life: 1,
                        decay: 0.01,
                        size: Math.random() * 8 + 4,
                        opacity: 0.3,
                        color: 'rgba(255, 255, 255, 0.8)',
                        type: 'shine'
                    });
                }
            }

            startQuoteRotation() {
                this.quoteInterval = setInterval(() => {
                    this.rotateQuote();
                }, 8000);
            }

            rotateQuote() {
                const quoteElement = document.getElementById('mysticalQuote');
                const randomQuote = this.quotes[Math.floor(Math.random() * this.quotes.length)];
                
                quoteElement.style.opacity = '0';
                setTimeout(() => {
                    quoteElement.textContent = randomQuote;
                    quoteElement.style.opacity = '1';
                }, 500);
            }

            startAutoShuffle() {
                if (this.settings.autoShuffle) {
                    this.autoShuffleInterval = setInterval(() => {
                        if (!this.state.isAnimating) {
                            this.shuffleCards();
                        }
                    }, 30000);
                }
            }

            stopAutoShuffle() {
                if (this.autoShuffleInterval) {
                    clearInterval(this.autoShuffleInterval);
                    this.autoShuffleInterval = null;
                }
            }

            // Enhanced save/load methods
            saveStats() {
                localStorage.setItem('mysticalCardsStats', JSON.stringify(this.stats));
                this.updateStatsDisplay();
            }

            saveSettings() {
                localStorage.setItem('mysticalCardsSettings', JSON.stringify(this.settings));
            }

            saveReading() {
                if (!this.state.selectedCard) return;

                const card = this.cards[this.state.selectedCard];
                const reading = {
                    id: Date.now(),
                    card: card,
                    timestamp: new Date().toISOString(),
                    luckScore: this.stats.luckScore
                };

                this.stats.savedReadings.push(reading);
                this.saveStats();
                this.showNotification('Reading saved successfully!', 'success');
            }

            clearHistory() {
                if (confirm('Are you sure you want to clear all history and stats?')) {
                    this.stats = {
                        totalDraws: 0,
                        rareCards: 0,
                        luckScore: 0,
                        streakCount: 0,
                        savedReadings: [],
                        achievements: [],
                        sessionStart: Date.now()
                    };
                    this.state.achievements.clear();
                    this.saveStats();
                    this.resetCards();
                    this.showNotification('History cleared successfully!', 'info');
                }
            }

            // Enhanced messaging methods
            closeMessage() {
                const messageContainer = document.getElementById('messageContainer');
                messageContainer.classList.remove('visible');
                this.resetCards();
            }

            drawAnother() {
                this.closeMessage();
                setTimeout(() => {
                    this.drawCard();
                }, 500);
            }

            shareReading() {
                if (!this.state.selectedCard) {
                    this.showNotification('No card selected to share', 'warning');
                    return;
                }

                const card = this.cards[this.state.selectedCard];
                const shareText = `I drew "${card.title}" - ${card.desc}\n\n${card.fortune}\n\nTry your luck at Mystical Fortune Cards!`;

                if (navigator.share) {
                    navigator.share({
                        title: 'My Mystical Fortune',
                        text: shareText,
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(shareText).then(() => {
                        this.showNotification('Fortune copied to clipboard!', 'success');
                    });
                }
            }

            // Enhanced help and info methods
            showHelp() {
                const helpContent = `
                    <div class="help-content">
                        <h3>How to Use Mystical Fortune Cards</h3>
                        <div class="help-section">
                            <h4>Basic Controls:</h4>
                            <ul>
                                <li><strong>Space/Enter</strong> - Draw a random card</li>
                                <li><strong>S</strong> - Toggle settings panel</li>
                                <li><strong>M</strong> - Toggle sound</li>
                                <li><strong>F</strong> - Toggle fullscreen</li>
                                <li><strong>T</strong> - Change theme</li>
                                <li><strong>R</strong> - Shuffle cards</li>
                                <li><strong>P</strong> - Share reading</li>
                                <li><strong>Escape</strong> - Close message</li>
                            </ul>
                        </div>
                        <div class="help-section">
                            <h4>Card Rarities:</h4>
                            <ul>
                                <li><strong>Common</strong> - Basic wisdom (1x multiplier)</li>
                                <li><strong>Uncommon</strong> - Enhanced insight (1.2x multiplier)</li>
                                <li><strong>Rare</strong> - Powerful guidance (1.5x multiplier)</li>
                                <li><strong>Epic</strong> - Profound revelations (2x multiplier)</li>
                                <li><strong>Legendary</strong> - Cosmic wisdom (2.5x multiplier)</li>
                                <li><strong>Mythic</strong> - Divine knowledge (3x multiplier)</li>
                            </ul>
                        </div>
                        <div class="help-section">
                            <h4>Features:</h4>
                            <ul>
                                <li>Interactive particle effects</li>
                                <li>Multiple drawing modes</li>
                                <li>Achievement system</li>
                                <li>Customizable settings</li>
                                <li>Reading history</li>
                                <li>Multiple themes</li>
                            </ul>
                        </div>
                    </div>
                `;

                this.showModal('Help & Guide', helpContent);
            }

            showAbout() {
                const aboutContent = `
                    <div class="about-content">
                        <h3>About Mystical Fortune Cards</h3>
                        <p>Welcome to the ultimate mystical experience! This enchanted application combines ancient wisdom with modern technology to provide you with personalized cosmic insights.</p>
                        
                        <h4>Features:</h4>
                        <ul>
                            <li>16 unique mystical cards with detailed fortunes</li>
                            <li>Advanced particle systems and 3D effects</li>
                            <li>Multiple drawing modes including three-card readings</li>
                            <li>Achievement system and progress tracking</li>
                            <li>Customizable settings and themes</li>
                            <li>Local storage for saved readings</li>
                            <li>Responsive design for all devices</li>
                        </ul>
                        
                        <h4>Technology:</h4>
                        <p>Built with HTML5, CSS3, and JavaScript featuring:</p>
                        <ul>
                            <li>Canvas-based particle systems</li>
                            <li>Web Audio API for mystical sounds</li>
                            <li>CSS animations and transitions</li>
                            <li>Local storage for persistence</li>
                            <li>Responsive design principles</li>
                        </ul>
                    </div>
                `;

                this.showModal('About', aboutContent);
            }

            showCredits() {
                const creditsContent = `
                    <div class="credits-content">
                        <h3>Credits & Acknowledgments</h3>
                        
                        <h4>Libraries & Resources:</h4>
                        <ul>
                            <li><strong>Animate.css</strong> - CSS animation library</li>
                            <li><strong>Font Awesome</strong> - Icon library</li>
                            <li><strong>Google Fonts</strong> - Typography</li>
                            <li><strong>Canvas API</strong> - Particle effects</li>
                            <li><strong>Web Audio API</strong> - Sound effects</li>
                        </ul>
                        
                        <h4>Fonts Used:</h4>
                        <ul>
                            <li><strong>Cinzel</strong> - Elegant display font</li>
                            <li><strong>Cormorant Garamond</strong> - Readable serif</li>
                            <li><strong>Poiret One</strong> - Mystical headings</li>
                            <li><strong>Uncial Antiqua</strong> - Ancient-style text</li>
                        </ul>
                        
                        <h4>Special Thanks:</h4>
                        <p>To all the mystics, fortune tellers, and spiritual guides who have inspired this digital divination experience.</p>
                        
                        <p class="version">Version 2.0 - Ultimate Enhanced Edition</p>
                    </div>
                `;

                this.showModal('Credits', creditsContent);
            }

            showModal(title, content) {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>${title}</h2>
                            <button class="modal-close">&times;</button>
                        </div>
                        <div class="modal-body">
                            ${content}
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Close modal events
                modal.querySelector('.modal-close').addEventListener('click', () => {
                    modal.remove();
                });

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });

                // Escape key to close
                const escapeHandler = (e) => {
                    if (e.key === 'Escape') {
                        modal.remove();
                        document.removeEventListener('keydown', escapeHandler);
                    }
                };
                document.addEventListener('keydown', escapeHandler);
            }

            contact() {
                const contactContent = `
                    <div class="contact-content">
                        <h3>Contact & Support</h3>
                        <p>For questions, suggestions, or mystical inquiries, please reach out:</p>
                        
                        <div class="contact-methods">
                            <div class="contact-method">
                                <i class="fas fa-envelope"></i>
                                <span>Email: mystical@fortunecards.com</span>
                            </div>
                            <div class="contact-method">
                                <i class="fas fa-globe"></i>
                                <span>Website: www.mysticalfortunecards.com</span>
                            </div>
                            <div class="contact-method">
                                <i class="fab fa-twitter"></i>
                                <span>Twitter: @MysticalCards</span>
                            </div>
                        </div>
                        
                        <h4>Support:</h4>
                        <p>If you encounter any issues or have suggestions for improvements, please don't hesitate to contact us. We're always working to enhance your mystical experience!</p>
                        
                        <h4>Privacy:</h4>
                        <p>Your readings and personal data are stored locally on your device. We respect your privacy and do not collect or transmit any personal information.</p>
                    </div>
                `;

                this.showModal('Contact', contactContent);
            }

            // Enhanced cleanup methods
            cleanup() {
                // Remove event listeners
                window.removeEventListener('mousemove', this.handleMouseMove);
                window.removeEventListener('touchmove', this.handleTouchMove);
                window.removeEventListener('resize', this.handleResize);

                // Clear intervals
                if (this.ambientInterval) clearInterval(this.ambientInterval);
                if (this.glitterInterval) clearInterval(this.glitterInterval);
                if (this.shineInterval) clearInterval(this.shineInterval);
                if (this.quoteInterval) clearInterval(this.quoteInterval);
                if (this.autoShuffleInterval) clearInterval(this.autoShuffleInterval);

                // Clear animation frame
                if (this.animationFrame) cancelAnimationFrame(this.animationFrame);

                // Clear particle arrays
                this.particles.length = 0;
                this.glitterParticles.length = 0;
                this.shineParticles.length = 0;
                this.constellationParticles.length = 0;

                // Close audio context
                if (this.audioContext) {
                    this.audioContext.close();
                }
            }
        }

        // Global functions for button events
        function drawCard() {
            app.drawCard();
        }

        function shuffleCards() {
            app.shuffleCards();
        }

        function drawThreeCards() {
            app.drawThreeCards();
        }

        function clearHistory() {
            app.clearHistory();
        }

        function closeMessage() {
            app.closeMessage();
        }

        function saveReading() {
            app.saveReading();
        }

        function shareReading() {
            app.shareReading();
        }

        function drawAnother() {
            app.drawAnother();
        }

        function showHelp() {
            app.showHelp();
        }

        function showAbout() {
            app.showAbout();
        }

        function showCredits() {
            app.showCredits();
        }

        function contact() {
            app.contact();
        }

        // Enhanced CSS for modals
        const modalStyles = `
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: blur(20px);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            }

            .modal-content {
                background: var(--glass-bg);
                backdrop-filter: blur(25px);
                border: 2px solid var(--primary-color);
                border-radius: 25px;
                max-width: 800px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 30px 80px var(--shadow-color);
                animation: slideInUp 0.4s ease;
            }

            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 2rem;
                border-bottom: 1px solid var(--glass-border);
            }

            .modal-header h2 {
                font-family: "Cinzel", serif;
                color: var(--primary-color);
                margin: 0;
            }

            .modal-close {
                background: none;
                border: none;
                font-size: 2rem;
                color: var(--text-color);
                cursor: pointer;
                padding: 0.5rem;
                border-radius: 50%;
                transition: all 0.3s ease;
            }

            .modal-close:hover {
                background: var(--primary-color);
                color: white;
                transform: scale(1.1);
            }

            .modal-body {
                padding: 2rem;
                color: var(--text-color);
                line-height: 1.6;
            }

            .modal-body h3 {
                color: var(--accent-color);
                margin-top: 0;
            }

            .modal-body h4 {
                color: var(--primary-color);
                margin-top: 2rem;
            }

            .modal-body ul {
                padding-left: 2rem;
            }

            .modal-body li {
                margin-bottom: 0.5rem;
            }

            .help-section, .contact-methods {
                margin-bottom: 2rem;
            }

            .contact-method {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin-bottom: 1rem;
                padding: 1rem;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 10px;
            }

            .contact-method i {
                color: var(--primary-color);
                font-size: 1.2rem;
            }

            .version {
                text-align: center;
                color: var(--accent-color);
                font-style: italic;
                margin-top: 2rem;
            }

            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            @keyframes slideInUp {
                from { 
                    opacity: 0; 
                    transform: translateY(100px) scale(0.8); 
                }
                to { 
                    opacity: 1; 
                    transform: translateY(0) scale(1); 
                }
            }

            @keyframes screenShake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }

            @keyframes shuffle {
                0% { transform: rotateY(0deg) scale(1); }
                50% { transform: rotateY(180deg) scale(1.1); }
                100% { transform: rotateY(360deg) scale(1); }
            }
        `;

        // Inject modal styles
        const styleSheet = document.createElement('style');
        styleSheet.textContent = modalStyles;
        document.head.appendChild(styleSheet);

        // Initialize the ultimate enhanced application
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new UltimateEnhancedMysticalCards();

                        // Enhanced cleanup on page unload
            window.addEventListener('beforeunload', () => {
                app.cleanup();
            });

            // Enhanced performance monitoring
            if ('performance' in window) {
                window.addEventListener('load', () => {
                    setTimeout(() => {
                        const perfData = performance.getEntriesByType('navigation')[0];
                        console.log(`App loaded in ${perfData.loadEventEnd - perfData.fetchStart}ms`);
                    }, 0);
                });
            }

            // Enhanced error handling
            window.addEventListener('error', (e) => {
                console.error('Application error:', e.error);
                app.showNotification('An error occurred. Please refresh the page.', 'warning');
            });

            // Enhanced visibility change handling
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'hidden') {
                    app.pauseAnimations();
                } else {
                    app.resumeAnimations();
                }
            });

            // Enhanced connection status monitoring
            window.addEventListener('online', () => {
                app.showNotification('Connection restored', 'success');
            });

            window.addEventListener('offline', () => {
                app.showNotification('You are offline. Some features may be limited.', 'warning');
            });

            // Enhanced device orientation handling
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    app.resizeCanvas();
                    app.updateLayout();
                }, 500);
            });

            // Enhanced accessibility features
            document.addEventListener('keydown', (e) => {
                // Screen reader support
                if (e.key === 'F1') {
                    e.preventDefault();
                    app.announceCurrentState();
                }
            });

            // Enhanced gesture support for mobile
            let touchStartTime = 0;
            let touchStartPos = { x: 0, y: 0 };

            document.addEventListener('touchstart', (e) => {
                touchStartTime = Date.now();
                touchStartPos = {
                    x: e.touches[0].clientX,
                    y: e.touches[0].clientY
                };
            });

            document.addEventListener('touchend', (e) => {
                const touchEndTime = Date.now();
                const touchEndPos = {
                    x: e.changedTouches[0].clientX,
                    y: e.changedTouches[0].clientY
                };

                const duration = touchEndTime - touchStartTime;
                const distance = Math.sqrt(
                    Math.pow(touchEndPos.x - touchStartPos.x, 2) +
                    Math.pow(touchEndPos.y - touchStartPos.y, 2)
                );

                // Swipe gestures
                if (duration < 500 && distance > 50) {
                    const deltaX = touchEndPos.x - touchStartPos.x;
                    const deltaY = touchEndPos.y - touchStartPos.y;

                    if (Math.abs(deltaX) > Math.abs(deltaY)) {
                        if (deltaX > 0) {
                            app.handleSwipeRight();
                        } else {
                            app.handleSwipeLeft();
                        }
                    } else {
                        if (deltaY > 0) {
                            app.handleSwipeDown();
                        } else {
                            app.handleSwipeUp();
                        }
                    }
                }

                // Double tap
                if (duration < 300 && distance < 20) {
                    if (app.lastTapTime && touchEndTime - app.lastTapTime < 300) {
                        app.handleDoubleTap();
                    }
                    app.lastTapTime = touchEndTime;
                }
            });

            // Enhanced save state on page visibility change
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'hidden') {
                    app.saveCurrentState();
                }
            });

            // Enhanced periodic state saving
            setInterval(() => {
                app.saveCurrentState();
            }, 60000); // Save every minute

            // Enhanced memory management
            setInterval(() => {
                app.performMemoryCleanup();
            }, 300000); // Clean up every 5 minutes

            // Enhanced battery optimization
            if ('getBattery' in navigator) {
                navigator.getBattery().then(battery => {
                    const updateBatteryOptimization = () => {
                        if (battery.level < 0.2) {
                            app.enableBatteryOptimization();
                        } else {
                            app.disableBatteryOptimization();
                        }
                    };

                    battery.addEventListener('levelchange', updateBatteryOptimization);
                    updateBatteryOptimization();
                });
            }

            // Enhanced service worker registration for offline support
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('Service Worker registered:', registration);
                }).catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
            }

            // Enhanced analytics and tracking (privacy-conscious)
            app.trackUsage = {
                sessionStart: Date.now(),
                cardsDrawn: 0,
                featuresUsed: new Set(),
                errors: []
            };

            // Enhanced theme detection
            if (window.matchMedia) {
                const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
                const reducedMotionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');

                darkModeQuery.addEventListener('change', (e) => {
                    if (e.matches) {
                        app.enableDarkMode();
                    } else {
                        app.disableDarkMode();
                    }
                });

                reducedMotionQuery.addEventListener('change', (e) => {
                    if (e.matches) {
                        app.enableReducedMotion();
                    } else {
                        app.disableReducedMotion();
                    }
                });
            }

            // Enhanced WebGL detection for advanced effects
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (gl) {
                app.enableWebGLEffects();
            }

            // Enhanced device capabilities detection
            const deviceInfo = {
                isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                isTablet: /iPad|Android(?!.*Mobile)/i.test(navigator.userAgent),
                isDesktop: !(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),
                hasTouch: 'ontouchstart' in window,
                hasGyroscope: 'DeviceOrientationEvent' in window,
                hasAccelerometer: 'DeviceMotionEvent' in window
            };

            app.optimizeForDevice(deviceInfo);

            // Enhanced feature detection and progressive enhancement
            const features = {
                webGL: !!gl,
                webAudio: !!(window.AudioContext || window.webkitAudioContext),
                localStorage: typeof(Storage) !== 'undefined',
                canvas: !!document.createElement('canvas').getContext,
                fullscreen: !!(document.fullscreenEnabled || document.webkitFullscreenEnabled),
                vibration: 'vibrate' in navigator,
                share: 'share' in navigator,
                animations: CSS.supports('animation', 'test'),
                transforms: CSS.supports('transform', 'translateZ(0)'),
                backdrop: CSS.supports('backdrop-filter', 'blur(10px)')
            };

            app.initializeFeatures(features);

            // Enhanced initialization completion
            app.showNotification('Mystical Fortune Cards loaded successfully! ✨', 'success');
            
            // Enhanced tutorial for first-time users
            if (!localStorage.getItem('mysticalCardsTutorialCompleted')) {
                setTimeout(() => {
                    app.showTutorial();
                }, 3000);
            }

            // Enhanced welcome message based on time of day
            const hour = new Date().getHours();
            let greeting = '';
            if (hour < 12) {
                greeting = 'Good morning, seeker of wisdom! ☀️';
            } else if (hour < 17) {
                greeting = 'Good afternoon, cosmic traveler! 🌅';
            } else {
                greeting = 'Good evening, mystical explorer! 🌙';
            }

            setTimeout(() => {
                app.showNotification(greeting, 'info');
            }, 5000);

            // Enhanced console welcome message
            console.log(`
                ✨ Mystical Fortune Cards - Ultimate Enhanced Edition ✨
                
                Welcome to the most advanced mystical experience on the web!
                
                Features:
                • 16 unique mystical cards with detailed fortunes
                • Advanced particle systems and 3D effects
                • Multiple drawing modes and achievement system
                • Customizable settings and themes
                • Full keyboard and gesture support
                • Offline capability with service worker
                • Progressive enhancement for all devices
                
                Keyboard shortcuts:
                • Space/Enter: Draw card
                • S: Settings
                • M: Toggle sound
                • F: Fullscreen
                • T: Change theme
                • H: Help
                • R: Shuffle
                • P: Share
                
                Version: 2.0 Ultimate Enhanced Edition
                Built with ❤️ and ✨ magic
            `);
        });

        // Enhanced utility functions for the app class
        UltimateEnhancedMysticalCards.prototype.pauseAnimations = function() {
            this.animationsPaused = true;
            if (this.animationFrame) {
                cancelAnimationFrame(this.animationFrame);
            }
        };

        UltimateEnhancedMysticalCards.prototype.resumeAnimations = function() {
            this.animationsPaused = false;
            if (!this.animationFrame) {
                this.animationFrame = requestAnimationFrame(() => this.animate());
            }
        };

        UltimateEnhancedMysticalCards.prototype.updateLayout = function() {
            this.resizeCanvas();
            this.repositionElements();
        };

        UltimateEnhancedMysticalCards.prototype.repositionElements = function() {
            // Reposition floating elements based on new layout
            const floatingSymbols = document.querySelectorAll('.floating-symbol');
            floatingSymbols.forEach((symbol, index) => {
                const x = Math.random() * (window.innerWidth - 100);
                const y = Math.random() * (window.innerHeight - 100);
                symbol.style.left = `${x}px`;
                symbol.style.top = `${y}px`;
            });
        };

        UltimateEnhancedMysticalCards.prototype.announceCurrentState = function() {
            const announcement = document.createElement('div');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.style.position = 'absolute';
            announcement.style.left = '-10000px';
            announcement.style.width = '1px';
            announcement.style.height = '1px';
            announcement.style.overflow = 'hidden';
            
            const state = this.state.isCardSelected ? 
                `Card selected: ${this.cards[this.state.selectedCard].title}` : 
                `Ready to draw cards. Total draws: ${this.stats.totalDraws}`;
            
            announcement.textContent = state;
            document.body.appendChild(announcement);
            
            setTimeout(() => {
                document.body.removeChild(announcement);
            }, 1000);
        };

        UltimateEnhancedMysticalCards.prototype.handleSwipeRight = function() {
            this.drawCard();
        };

        UltimateEnhancedMysticalCards.prototype.handleSwipeLeft = function() {
            this.shuffleCards();
        };

        UltimateEnhancedMysticalCards.prototype.handleSwipeUp = function() {
            this.toggleSettings();
        };

        UltimateEnhancedMysticalCards.prototype.handleSwipeDown = function() {
            this.closeMessage();
        };

        UltimateEnhancedMysticalCards.prototype.handleDoubleTap = function() {
            this.drawThreeCards();
        };

        UltimateEnhancedMysticalCards.prototype.saveCurrentState = function() {
            const state = {
                selectedCard: this.state.selectedCard,
                isCardSelected: this.state.isCardSelected,
                currentTheme: this.state.currentTheme,
                lastSaved: Date.now()
            };
            localStorage.setItem('mysticalCardsState', JSON.stringify(state));
        };

        UltimateEnhancedMysticalCards.prototype.performMemoryCleanup = function() {
            // Clean up old particles
            this.particles = this.particles.filter(p => p.life > 0.1);
            this.glitterParticles = this.glitterParticles.filter(p => p.life > 0.1);
            this.shineParticles = this.shineParticles.filter(p => p.life > 0.1);
            
            // Clean up old notifications
            const oldNotifications = document.querySelectorAll('.notification');
            oldNotifications.forEach(notification => {
                if (Date.now() - parseInt(notification.dataset.created || '0') > 10000) {
                    notification.remove();
                }
            });
        };

        UltimateEnhancedMysticalCards.prototype.enableBatteryOptimization = function() {
            this.settings.particleDensity = Math.max(1, this.settings.particleDensity - 2);
            this.settings.animationSpeed = Math.max(0.5, this.settings.animationSpeed - 0.3);
            this.updateParticleSystem();
            this.updateAnimationSpeed();
            this.showNotification('Battery optimization enabled', 'info');
        };

        UltimateEnhancedMysticalCards.prototype.disableBatteryOptimization = function() {
            this.settings.particleDensity = Math.min(10, this.settings.particleDensity + 2);
            this.settings.animationSpeed = Math.min(3, this.settings.animationSpeed + 0.3);
            this.updateParticleSystem();
            this.updateAnimationSpeed();
        };

        UltimateEnhancedMysticalCards.prototype.enableDarkMode = function() {
            document.documentElement.setAttribute('data-theme', 'dark');
        };

        UltimateEnhancedMysticalCards.prototype.disableDarkMode = function() {
            document.documentElement.removeAttribute('data-theme');
        };

        UltimateEnhancedMysticalCards.prototype.enableReducedMotion = function() {
            document.documentElement.setAttribute('data-reduced-motion', 'true');
            this.settings.animationSpeed = 0.1;
            this.settings.particleEffects = false;
            this.updateAnimationSpeed();
            this.updateParticleSystem();
        };

        UltimateEnhancedMysticalCards.prototype.disableReducedMotion = function() {
            document.documentElement.removeAttribute('data-reduced-motion');
            this.settings.animationSpeed = 1;
            this.settings.particleEffects = true;
            this.updateAnimationSpeed();
            this.updateParticleSystem();
        };

        UltimateEnhancedMysticalCards.prototype.enableWebGLEffects = function() {
            this.webGLEnabled = true;
            // Initialize WebGL-based particle systems for enhanced performance
            this.initializeWebGLParticles();
        };

        UltimateEnhancedMysticalCards.prototype.initializeWebGLParticles = function() {
            // Advanced WebGL particle system implementation
            console.log('WebGL particle system initialized');
        };

        UltimateEnhancedMysticalCards.prototype.optimizeForDevice = function(deviceInfo) {
            if (deviceInfo.isMobile) {
                this.settings.particleDensity = Math.min(3, this.settings.particleDensity);
                this.settings.animationSpeed = Math.min(1.5, this.settings.animationSpeed);
            }
            
            if (deviceInfo.isTablet) {
                this.settings.particleDensity = Math.min(5, this.settings.particleDensity);
            }
            
            if (deviceInfo.hasTouch) {
                this.enableTouchOptimizations();
            }
            
            if (deviceInfo.hasGyroscope) {
                this.enableGyroscopeEffects();
            }
        };

        UltimateEnhancedMysticalCards.prototype.enableTouchOptimizations = function() {
            // Optimize touch interactions
            document.body.style.touchAction = 'manipulation';
            
            // Add haptic feedback
            if ('vibrate' in navigator) {
                const originalSelectCard = this.selectCard.bind(this);
                this.selectCard = function(index) {
                    navigator.vibrate(50);
                    originalSelectCard(index);
                };
            }
        };

        UltimateEnhancedMysticalCards.prototype.enableGyroscopeEffects = function() {
            window.addEventListener('deviceorientation', (e) => {
                if (this.settings.particleEffects) {
                    const tiltX = e.gamma; // Left to right
                    const tiltY = e.beta;  // Front to back
                    
                    // Adjust particle gravity based on device orientation
                    this.particles.forEach(particle => {
                        particle.vx += tiltX * 0.001;
                        particle.vy += tiltY * 0.001;
                    });
                }
            });
        };

        UltimateEnhancedMysticalCards.prototype.initializeFeatures = function(features) {
            this.features = features;
            
            if (!features.webAudio) {
                this.settings.soundEnabled = false;
                document.getElementById('soundBtn').style.display = 'none';
            }
            
            if (!features.fullscreen) {
                document.getElementById('fullscreenBtn').style.display = 'none';
            }
            
            if (!features.share) {
                document.getElementById('shareBtn').style.display = 'none';
            }
            
            if (!features.backdrop) {
                // Fallback for browsers without backdrop-filter support
                document.documentElement.style.setProperty('--glass-bg', 'rgba(0, 0, 0, 0.8)');
            }
        };

        UltimateEnhancedMysticalCards.prototype.showTutorial = function() {
            const tutorialSteps = [
                {
                    title: 'Welcome to Mystical Fortune Cards! ✨',
                    content: 'Let me guide you through this magical experience.',
                    target: null
                },
                {
                    title: 'Draw Your First Card 🎴',
                    content: 'Click the "Draw Your Fortune" button or press Space to reveal your destiny.',
                    target: '#drawCard'
                },
                {
                    title: 'Explore the Cards 🌟',
                    content: 'Each card has unique powers and rarities. Click any card to select it.',
                    target: '.card'
                },
                {
                    title: 'Customize Your Experience ⚙️',
                    content: 'Use the settings panel to adjust effects, sound, and more.',
                    target: '#settingsBtn'
                },
                {
                    title: 'Advanced Features 🎭',
                    content: 'Try the three-card reading for deeper insights, or shuffle for new possibilities.',
                    target: '#drawThree'
                },
                {
                    title: 'Ready to Begin! 🚀',
                    content: 'You\'re all set! May the cosmic forces guide your journey.',
                    target: null
                }
            ];
            
            this.currentTutorialStep = 0;
            this.showTutorialStep(tutorialSteps[0], tutorialSteps);
        };

        UltimateEnhancedMysticalCards.prototype.showTutorialStep = function(step, allSteps) {
                       const tutorialOverlay = document.createElement('div');
            tutorialOverlay.className = 'tutorial-overlay';
            tutorialOverlay.innerHTML = `
                <div class="tutorial-content">
                    <div class="tutorial-header">
                        <h3>${step.title}</h3>
                        <button class="tutorial-close">&times;</button>
                    </div>
                    <div class="tutorial-body">
                        <p>${step.content}</p>
                    </div>
                    <div class="tutorial-footer">
                        <div class="tutorial-progress">
                            <div class="tutorial-progress-bar" style="width: ${((this.currentTutorialStep + 1) / allSteps.length) * 100}%"></div>
                        </div>
                        <div class="tutorial-buttons">
                            ${this.currentTutorialStep > 0 ? '<button class="tutorial-btn tutorial-prev">Previous</button>' : ''}
                            ${this.currentTutorialStep < allSteps.length - 1 ? '<button class="tutorial-btn tutorial-next">Next</button>' : '<button class="tutorial-btn tutorial-finish">Finish</button>'}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(tutorialOverlay);

            // Highlight target element
            if (step.target) {
                const targetElement = document.querySelector(step.target);
                if (targetElement) {
                    targetElement.classList.add('tutorial-highlight');
                    setTimeout(() => {
                        targetElement.classList.remove('tutorial-highlight');
                    }, 3000);
                }
            }

            // Event listeners
            const closeBtn = tutorialOverlay.querySelector('.tutorial-close');
            const nextBtn = tutorialOverlay.querySelector('.tutorial-next');
            const prevBtn = tutorialOverlay.querySelector('.tutorial-prev');
            const finishBtn = tutorialOverlay.querySelector('.tutorial-finish');

            const closeTutorial = () => {
                tutorialOverlay.remove();
                localStorage.setItem('mysticalCardsTutorialCompleted', 'true');
            };

            closeBtn.addEventListener('click', closeTutorial);

            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    tutorialOverlay.remove();
                    this.currentTutorialStep++;
                    this.showTutorialStep(allSteps[this.currentTutorialStep], allSteps);
                });
            }

            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    tutorialOverlay.remove();
                    this.currentTutorialStep--;
                    this.showTutorialStep(allSteps[this.currentTutorialStep], allSteps);
                });
            }

            if (finishBtn) {
                finishBtn.addEventListener('click', closeTutorial);
            }

            // Keyboard navigation
            const keyHandler = (e) => {
                if (e.key === 'Escape') {
                    closeTutorial();
                    document.removeEventListener('keydown', keyHandler);
                } else if (e.key === 'ArrowRight' && nextBtn) {
                    nextBtn.click();
                } else if (e.key === 'ArrowLeft' && prevBtn) {
                    prevBtn.click();
                } else if (e.key === 'Enter' && finishBtn) {
                    finishBtn.click();
                }
            };

            document.addEventListener('keydown', keyHandler);
        };

        // Enhanced CSS for tutorial system
        const tutorialStyles = `
            .tutorial-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.85);
                backdrop-filter: blur(15px);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 15000;
                animation: fadeIn 0.3s ease;
            }

            .tutorial-content {
                background: var(--glass-bg);
                backdrop-filter: blur(25px);
                border: 2px solid var(--primary-color);
                border-radius: 20px;
                max-width: 500px;
                width: 90%;
                box-shadow: 0 30px 80px var(--shadow-color);
                animation: slideInScale 0.4s ease;
            }

            .tutorial-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1.5rem;
                border-bottom: 1px solid var(--glass-border);
            }

            .tutorial-header h3 {
                font-family: "Cinzel", serif;
                color: var(--primary-color);
                margin: 0;
                font-size: 1.3rem;
            }

            .tutorial-close {
                background: none;
                border: none;
                font-size: 1.5rem;
                color: var(--text-color);
                cursor: pointer;
                padding: 0.5rem;
                border-radius: 50%;
                transition: all 0.3s ease;
            }

            .tutorial-close:hover {
                background: var(--primary-color);
                color: white;
                transform: scale(1.1);
            }

            .tutorial-body {
                padding: 1.5rem;
                color: var(--text-color);
                line-height: 1.6;
            }

            .tutorial-body p {
                margin: 0;
                font-size: 1.1rem;
            }

            .tutorial-footer {
                padding: 1.5rem;
                border-top: 1px solid var(--glass-border);
            }

            .tutorial-progress {
                height: 4px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 2px;
                margin-bottom: 1rem;
                overflow: hidden;
            }

            .tutorial-progress-bar {
                height: 100%;
                background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
                border-radius: 2px;
                transition: width 0.3s ease;
            }

            .tutorial-buttons {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 1rem;
            }

            .tutorial-btn {
                background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
                color: white;
                border: none;
                padding: 0.8rem 1.5rem;
                border-radius: 25px;
                cursor: pointer;
                font-family: "Cinzel", serif;
                font-size: 1rem;
                transition: all 0.3s ease;
                box-shadow: 0 5px 15px rgba(153, 105, 255, 0.3);
            }

            .tutorial-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(153, 105, 255, 0.5);
            }

            .tutorial-btn.tutorial-prev {
                background: linear-gradient(45deg, var(--tertiary-color), var(--accent-color));
            }

            .tutorial-highlight {
                position: relative;
                z-index: 16000;
                animation: tutorialHighlight 2s ease-in-out infinite;
            }

            .tutorial-highlight::before {
                content: '';
                position: absolute;
                top: -10px;
                left: -10px;
                right: -10px;
                bottom: -10px;
                border: 3px solid var(--primary-color);
                border-radius: 15px;
                animation: tutorialPulse 1.5s ease-in-out infinite;
                pointer-events: none;
            }

            @keyframes slideInScale {
                from { 
                    opacity: 0; 
                    transform: scale(0.8) translateY(50px); 
                }
                to { 
                    opacity: 1; 
                    transform: scale(1) translateY(0); 
                }
            }

            @keyframes tutorialHighlight {
                0%, 100% { 
                    box-shadow: 0 0 20px var(--primary-color); 
                }
                50% { 
                    box-shadow: 0 0 40px var(--primary-color); 
                }
            }

            @keyframes tutorialPulse {
                0%, 100% { 
                    opacity: 0.5; 
                    transform: scale(1); 
                }
                50% { 
                    opacity: 1; 
                    transform: scale(1.05); 
                }
            }

            /* Enhanced responsive design for tutorial */
            @media (max-width: 768px) {
                .tutorial-content {
                    max-width: 95%;
                    margin: 1rem;
                }
                
                .tutorial-header,
                .tutorial-body,
                .tutorial-footer {
                    padding: 1rem;
                }
                
                .tutorial-buttons {
                    flex-direction: column;
                }
                
                .tutorial-btn {
                    width: 100%;
                }
            }
        `;

        // Enhanced accessibility features
        const accessibilityStyles = `
            /* Enhanced focus styles */
            .card:focus,
            .mystical-btn:focus,
            .control-btn:focus {
                outline: 3px solid var(--accent-color);
                outline-offset: 3px;
            }

            /* High contrast mode support */
            @media (prefers-contrast: high) {
                :root {
                    --primary-color: #0066cc;
                    --secondary-color: #cc0066;
                    --text-color: #ffffff;
                    --bg-color: #000000;
                }
            }

            /* Reduced motion support */
            @media (prefers-reduced-motion: reduce) {
                * {
                    animation-duration: 0.01ms !important;
                    animation-iteration-count: 1 !important;
                    transition-duration: 0.01ms !important;
                }
                
                .floating-symbol {
                    animation: none !important;
                }
                
                .card:hover {
                    transform: none !important;
                }
            }

            /* Screen reader only content */
            .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            /* Enhanced keyboard navigation */
            .keyboard-user .card:focus {
                z-index: 1000;
                transform: scale(1.1);
            }

            /* Color blind friendly indicators */
            .card.rare::after {
                content: "R";
                position: absolute;
                top: 5px;
                left: 5px;
                font-size: 0.8rem;
                font-weight: bold;
                color: var(--text-color);
            }

            .card.epic::after {
                content: "E";
                position: absolute;
                top: 5px;
                left: 5px;
                font-size: 0.8rem;
                font-weight: bold;
                color: var(--text-color);
            }

            .card.legendary::after {
                content: "L";
                position: absolute;
                top: 5px;
                left: 5px;
                font-size: 0.8rem;
                font-weight: bold;
                color: var(--text-color);
            }

            .card.mythic::after {
                content: "M";
                position: absolute;
                top: 5px;
                left: 5px;
                font-size: 0.8rem;
                font-weight: bold;
                color: var(--text-color);
            }
        `;

        // Enhanced performance optimization styles
        const performanceStyles = `
            /* GPU acceleration for animations */
            .card,
            .mystical-btn,
            .floating-symbol,
            .particle {
                will-change: transform;
                transform: translateZ(0);
            }

            /* Optimize repaints */
            .card-table {
                contain: layout style paint;
            }

            /* Optimize font loading */
            @font-display: swap;

            /* Optimize image loading */
            img {
                loading: lazy;
                decoding: async;
            }

            /* Container queries for responsive design */
            @container (min-width: 768px) {
                .card {
                    width: 220px;
                    height: 380px;
                }
            }

            @container (min-width: 1200px) {
                .card {
                    width: 250px;
                    height: 420px;
                }
            }
        `;

        // Inject all additional styles
        const allStyles = tutorialStyles + accessibilityStyles + performanceStyles;
        const additionalStyleSheet = document.createElement('style');
        additionalStyleSheet.textContent = allStyles;
        document.head.appendChild(additionalStyleSheet);

        // Enhanced service worker for offline functionality
        const serviceWorkerCode = `
            const CACHE_NAME = 'mystical-cards-v2';
            const urlsToCache = [
                '/',
                '/index.html',
                '/styles.css',
                '/script.js',
                'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css',
                'https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Poiret+One&family=Uncial+Antiqua&display=swap',
                'https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css'
            ];

            self.addEventListener('install', (event) => {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then((cache) => cache.addAll(urlsToCache))
                );
            });

            self.addEventListener('fetch', (event) => {
                event.respondWith(
                    caches.match(event.request)
                        .then((response) => {
                            if (response) {
                                return response;
                            }
                            return fetch(event.request);
                        })
                );
            });

            self.addEventListener('activate', (event) => {
                event.waitUntil(
                    caches.keys().then((cacheNames) => {
                        return Promise.all(
                            cacheNames.map((cacheName) => {
                                if (cacheName !== CACHE_NAME) {
                                    return caches.delete(cacheName);
                                }
                            })
                        );
                    })
                );
            });
        `;

        // Register service worker
        if ('serviceWorker' in navigator) {
            const blob = new Blob([serviceWorkerCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(registration => {
                    console.log('Service Worker registered successfully');
                })
                .catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
        }

        // Enhanced Web App Manifest
        const manifest = {
            name: "Mystical Fortune Cards - Ultimate Enhanced Edition",
            short_name: "Mystical Cards",
            description: "Discover your cosmic destiny through ancient divination",
            start_url: "/",
            display: "standalone",
            theme_color: "#9969ff",
            background_color: "#0a0a0a",
            icons: [
                {
                    src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiM5OTY5ZmYiLz4KPHRleHQgeD0iOTYiIHk9IjEwNCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjY0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+UruKcqO+4jzwvdGV4dD4KPC9zdmc+",
                    sizes: "192x192",
                    type: "image/svg+xml"
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
        const manifestUrl = URL.createObjectURL(manifestBlob);
        
        const manifestLink = document.createElement('link');
        manifestLink.rel = 'manifest';
        manifestLink.href = manifestUrl;
        document.head.appendChild(manifestLink);

        // Enhanced meta tags for SEO and social sharing
        const metaTags = [
            { name: 'description', content: 'Discover your cosmic destiny through the ancient art of divination with Mystical Fortune Cards. Interactive mystical experience with particle effects, achievements, and personalized readings.' },
            { name: 'keywords', content: 'fortune cards, mystical, divination, cosmic, spiritual, tarot, oracle, fortune telling, mystical experience' },
            { name: 'author', content: 'Mystical Fortune Cards' },
            { property: 'og:title', content: 'Mystical Fortune Cards - Ultimate Enhanced Edition' },
            { property: 'og:description', content: 'Discover your cosmic destiny through ancient divination' },
            { property: 'og:type', content: 'website' },
            { property: 'og:image', content: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwMCIgaGVpZ2h0PSI2MzAiIHZpZXdCb3g9IjAgMCAxMjAwIDYzMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEyMDAiIGhlaWdodD0iNjMwIiBmaWxsPSIjMGEwYTBhIi8+Cjx0ZXh0IHg9IjYwMCIgeT0iMzE1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iNjQiIGZpbGw9IiM5OTY5ZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPk15c3RpY2FsIEZvcnR1bmUgQ2FyZHM8L3RleHQ+CjwvdGV4dD4KPC9zdmc+' },
            { name: 'twitter:card', content: 'summary_large_image' },
            { name: 'twitter:title', content: 'Mystical Fortune Cards - Ultimate Enhanced Edition' },
            { name: 'twitter:description', content: 'Discover your cosmic destiny through ancient divination' },
            { name: 'viewport', content: 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' },
            { name: 'theme-color', content: '#9969ff' },
            { name: 'apple-mobile-web-app-capable', content: 'yes' },
            { name: 'apple-mobile-web-app-status-bar-style', content: 'black-translucent' },
            { name: 'apple-mobile-web-app-title', content: 'Mystical Cards' }
        ];

        metaTags.forEach(tag => {
            const metaElement = document.createElement('meta');
            if (tag.name) metaElement.name = tag.name;
            if (tag.property) metaElement.property = tag.property;
            metaElement.content = tag.content;
            document.head.appendChild(metaElement);
        });

        // Enhanced final initialization message
        console.log('🌟 Mystical Fortune Cards - Ultimate Enhanced Edition fully loaded! 🌟');
        console.log('✨ All systems operational - ready for cosmic exploration! ✨');
    </script>
</body>
</html>
 




​
​:wght@400;600;900&family=Cormorant+Garamond:wght@300;400;600&family=Poiret+One:wght@400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0a0618;
            --primary-color: #9969ff;
            --secondary-color: #ff69a1;
            --tertiary-color: #69b4ff;
            --accent-color: #ffeb3b;
            --text-color: #ffffff;
            --card-back: linear-gradient(45deg, #4a0e77, #650d6d, #7b1fa2);
            --card-front: linear-gradient(135deg, #2b2f66, #1c1647, #3f2a5c);
            --card-hover: #764ba2;
            --glitter-color: rgba(255, 235, 59, 0.9);
            --shine-color: hsla(280, 95%, 85%, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Cormorant Garamond", serif;
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            cursor: move;
        }

        /* Shine Canvas */
        #shine-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        .container {
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 2;
        }

        /* Mystical Background Elements */
        .mystical-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .floating-symbol {
            position: absolute;
            font-size: 2.5rem;
            opacity: 0.4;
            animation: float 8s ease-in-out infinite;
            text-shadow: 0 0 15px var(--shine-color);
            filter: drop-shadow(0 0 10px var(--shine-color));
        }

        .floating-symbol:nth-child(1) {
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-symbol:nth-child(2) {
            top: 20%;
            right: 15%;
            animation-delay: -2s;
        }

        .floating-symbol:nth-child(3) {
            bottom: 30%;
            left: 20%;
            animation-delay: -4s;
        }

        .floating-symbol:nth-child(4) {
            bottom: 20%;
            right: 10%;
            animation-delay: -1s;
        }

        .floating-symbol:nth-child(5) {
            top: 50%;
            left: 5%;
            animation-delay: -3s;
        }

        .floating-symbol:nth-child(6) {
            top: 70%;
            right: 25%;
            animation-delay: -5s;
        }

        @keyframes float {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg) scale(1); 
                opacity: 0.3;
                text-shadow: 0 0 15px var(--shine-color);
            }
            33% { 
                transform: translateY(-30px) rotate(120deg) scale(1.1); 
                opacity: 0.6;
                text-shadow: 0 0 25px var(--shine-color);
            }
            66% { 
                transform: translateY(-10px) rotate(240deg) scale(0.9); 
                opacity: 0.4;
                text-shadow: 0 0 20px var(--shine-color);
            }
        }

        /* Enhanced Header */
        header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
            z-index: 3;
        }

        .magical-title {
            font-family: "Cinzel", serif;
            font-size: 4rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color), var(--tertiary-color), var(--accent-color));
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite, titlePulse 2s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(153, 105, 255, 0.6);
            position: relative;
            filter: drop-shadow(0 0 20px var(--shine-color));
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes titlePulse {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 20px var(--shine-color)); }
            50% { filter: brightness(1.3) drop-shadow(0 0 30px var(--shine-color)); }
        }

        .subtitle {
            font-size: 1.4rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto 2rem;
            animation: subtitleGlow 3s ease-in-out infinite;
            text-shadow: 0 0 10px var(--shine-color);
        }

        @keyframes subtitleGlow {
            0%, 100% { 
                opacity: 0.8; 
                text-shadow: 0 0 10px var(--shine-color); 
            }
            50% { 
                opacity: 1; 
                text-shadow: 0 0 20px var(--shine-color); 
            }
        }

        .energy-orb {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, var(--shine-color) 0%, rgba(255, 105, 161, 0.2) 50%, transparent 70%);
            border-radius: 50%;
            animation: energyPulse 5s ease-in-out infinite;
            filter: blur(2px);
        }

        @keyframes energyPulse {
            0%, 100% { 
                transform: translateX(-50%) scale(1); 
                opacity: 0.4; 
                filter: blur(2px);
            }
            50% { 
                transform: translateX(-50%) scale(1.8); 
                opacity: 0.8; 
                filter: blur(1px);
            }
        }

        /* Card Selection Area */
        .card-selection {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin-bottom: 3rem;
            z-index: 3;
            position: relative;
        }

        .mystical-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 1.2rem 2.5rem;
            font-family: "Cinzel", serif;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 20px rgba(153, 105, 255, 0.4);
            position: relative;
            overflow: hidden;
        }

        .mystical-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, var(--shine-color), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }

        .mystical-btn:hover::before {
            animation: shimmer 1s ease-in-out;
        }

        .mystical-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 30px rgba(153, 105, 255, 0.7);
            filter: drop-shadow(0 0 15px var(--shine-color));
        }

        .mystical-btn.secondary {
            background: linear-gradient(45deg, var(--tertiary-color), var(--accent-color));
            box-shadow: 0 8px 20px rgba(105, 180, 255, 0.4);
        }

        .mystical-btn.secondary:hover {
            box-shadow: 0 15px 30px rgba(105, 180, 255, 0.7);
        }

        @keyframes shimmer {
            0% { transform: translateX(-200%) translateY(-200%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(200%) translateY(200%) rotate(45deg); opacity: 0; }
        }

        .card-count {
            font-family: "Cinzel", serif;
            font-size: 1.3rem;
            color: var(--accent-color);
            text-shadow: 0 0 15px var(--shine-color);
            animation: countGlow 2s ease-in-out infinite;
        }

        @keyframes countGlow {
            0%, 100% { 
                filter: brightness(1);
                text-shadow: 0 0 15px var(--shine-color);
            }
            50% { 
                filter: brightness(1.5);
                text-shadow: 0 0 25px var(--shine-color);
            }
        }

        /* Enhanced Card Table */
        .card-table {
            perspective: 1500px;
            margin-bottom: 3rem;
            min-height: 500px;
            z-index: 3;
            position: relative;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 2.5rem;
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .card {
            width: 180px;
            height: 320px;
            position: relative;
            transform-style: preserve-3d;
            transition: all 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            filter: brightness(0.9);
            justify-self: center;
        }

        .card:hover {
            filter: brightness(1.4) drop-shadow(0 0 25px var(--shine-color));
            transform: translateY(-25px) rotateY(20deg) scale(1.1);
        }

        .card.common {
            --card-rarity-color: rgba(200, 200, 200, 0.3);
        }

        .card.uncommon {
            --card-rarity-color: rgba(76, 175, 80, 0.4);
        }

        .card.rare {
            --card-rarity-color: rgba(63, 81, 181, 0.5);
        }

        .card.legendary {
            --card-rarity-color: var(--shine-color);
        }

        .card-face {
            width: 100%;
            height: 100%;
            position: absolute;
            backface-visibility: hidden;
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        .card-back {
            background: var(--card-back);
            border: 3px solid var(--card-rarity-color, rgba(255, 255, 255, 0.2));
            position: relative;
        }

        .card-back::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 90%;
            background: radial-gradient(circle, var(--card-rarity-color, var(--shine-color)) 0%, transparent 70%);
            border-radius: 50%;
            animation: innerGlow 4s ease-in-out infinite;
        }

        @keyframes innerGlow {
            0%, 100% { 
                opacity: 0.4; 
                transform: translate(-50%, -50%) scale(1); 
            }
            50% { 
                opacity: 0.8; 
                transform: translate(-50%, -50%) scale(1.3); 
            }
        }

        .card-back::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(45deg, var(--shine-color) 0, var(--shine-color) 1px, transparent 1px, transparent 15px),
                repeating-linear-gradient(-45deg, rgba(255, 255, 255, 0.03) 0, rgba(255, 255, 255, 0.03) 1px, transparent 1px, transparent 15px);
            border-radius: 25px;
            animation: patternShift 10s linear infinite;
            opacity: 0.3;
        }

        @keyframes patternShift {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 30px 30px, -30px -30px; }
        }

        .card-front {
            background: var(--card-front);
            transform: rotateY(180deg);
            padding: 2rem;
            text-align: center;
            border: 3px solid var(--card-rarity-color, rgba(153, 105, 255, 0.4));
        }

                .card-symbol {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.95;
            animation: symbolGlow 3s ease-in-out infinite;
            filter: drop-shadow(0 0 15px var(--shine-color));
        }

        @keyframes symbolGlow {
            0%, 100% { 
                text-shadow: 0 0 15px var(--shine-color); 
                transform: scale(1);
                filter: drop-shadow(0 0 15px var(--shine-color));
            }
            50% { 
                text-shadow: 0 0 30px var(--shine-color); 
                transform: scale(1.05);
                filter: drop-shadow(0 0 25px var(--shine-color));
            }
        }

        .card-title {
            font-family: "Cinzel", serif;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShimmer 2s ease-in-out infinite;
            text-shadow: 0 0 10px var(--shine-color);
        }

        @keyframes titleShimmer {
            0%, 100% { 
                filter: brightness(1);
                text-shadow: 0 0 10px var(--shine-color);
            }
            50% { 
                filter: brightness(1.4);
                text-shadow: 0 0 20px var(--shine-color);
            }
        }

        .card-desc {
            font-size: 1.1rem;
            opacity: 0.9;
            line-height: 1.5;
            font-style: italic;
            text-shadow: 0 0 5px var(--shine-color);
        }

        .card.flipped {
            transform: rotateY(180deg);
            pointer-events: none;
        }

        .card.selected {
            transform: scale(1.2) translateY(-30px);
            z-index: 10;
            filter: drop-shadow(0 0 30px var(--shine-color)) brightness(1.3);
        }

        /* Enhanced Message Container */
        .message-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.6s ease;
            z-index: 1000;
        }

        .message-container.visible {
            opacity: 1;
            pointer-events: all;
        }

        .message-card {
            width: 90%;
            max-width: 700px;
            background: rgba(15, 10, 30, 0.95);
            backdrop-filter: blur(20px);
            padding: 4rem;
            border-radius: 30px;
            border: 2px solid var(--shine-color);
            text-align: center;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.7);
            transform: translateY(60px) scale(0.8);
            opacity: 0;
            transition: all 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .message-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--shine-color) 0%, transparent 70%);
            animation: cardAura 5s ease-in-out infinite;
            opacity: 0.1;
        }

        @keyframes cardAura {
            0%, 100% { opacity: 0.1; transform: rotate(0deg); }
            50% { opacity: 0.3; transform: rotate(180deg); }
        }

        .message-container.visible .message-card {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .card-reveal-animation {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 120px;
            z-index: 1;
        }

        .cosmic-circle {
            width: 100%;
            height: 100%;
            border: 4px solid var(--shine-color);
            border-radius: 50%;
            animation: cosmicSpin 4s linear infinite;
            position: relative;
            box-shadow: 0 0 20px var(--shine-color);
        }

        .cosmic-circle::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 2px solid rgba(255, 105, 161, 0.5);
            border-radius: 50%;
            animation: cosmicSpin 3s linear infinite reverse;
        }

        .rotating-runes {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 90%;
            background: radial-gradient(circle, var(--shine-color) 0%, transparent 70%);
            border-radius: 50%;
            animation: runeRotate 6s ease-in-out infinite;
            opacity: 0.6;
        }

        @keyframes cosmicSpin {
            0% { transform: translateX(-50%) rotate(0deg); }
            100% { transform: translateX(-50%) rotate(360deg); }
        }

        @keyframes runeRotate {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(-360deg); }
        }

        .message-content {
            margin-top: 4rem;
            position: relative;
            z-index: 2;
        }

        .message-title {
            font-family: "Cinzel", serif;
            font-size: 3rem;
            margin-bottom: 2rem;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color), var(--tertiary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShimmer 2s ease-in-out infinite;
            text-shadow: 0 0 20px var(--shine-color);
            filter: drop-shadow(0 0 15px var(--shine-color));
        }

        .message-text {
            font-size: 1.8rem;
            line-height: 1.7;
            margin-bottom: 2rem;
            opacity: 0.95;
            animation: textGlow 3s ease-in-out infinite;
        }

        @keyframes textGlow {
            0%, 100% { text-shadow: 0 0 10px var(--shine-color); }
            50% { text-shadow: 0 0 20px var(--shine-color); }
        }

        .fortune-details {
            font-size: 1.3rem;
            opacity: 0.8;
            margin-bottom: 3rem;
            font-style: italic;
            color: var(--accent-color);
            animation: detailsPulse 4s ease-in-out infinite;
            text-shadow: 0 0 8px var(--shine-color);
        }

        @keyframes detailsPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .message-actions {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Enhanced Footer */
        footer {
            text-align: center;
            margin-top: 5rem;
            opacity: 0.8;
            font-size: 1.1rem;
            z-index: 3;
            position: relative;
        }

        .mystical-quote {
            font-family: "Poiret One", cursive;
            font-style: italic;
            margin-top: 1.5rem;
            color: var(--accent-color);
            font-size: 1.3rem;
            opacity: 0.9;
            animation: quoteFade 5s ease-in-out infinite;
            text-shadow: 0 0 15px var(--shine-color);
        }

        @keyframes quoteFade {
            0%, 100% { 
                opacity: 0.7;
                text-shadow: 0 0 10px var(--shine-color);
            }
            50% { 
                opacity: 1;
                text-shadow: 0 0 25px var(--shine-color);
            }
        }

        /* Canvas Elements */
        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #particle-canvas {
            z-index: 1;
        }

        #glitter-canvas {
            z-index: 2;
        }

        /* Enhanced Glitter Effects */
        .glitter-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--shine-color);
            border-radius: 50%;
            pointer-events: none;
            z-index: 50;
            animation: glitterTwinkle 2s ease-in-out infinite;
            box-shadow: 0 0 15px var(--shine-color);
        }

        @keyframes glitterTwinkle {
            0%, 100% { 
                opacity: 0; 
                transform: scale(0) rotate(0deg); 
                box-shadow: 0 0 0 var(--shine-color);
            }
            50% { 
                opacity: 1; 
                transform: scale(2) rotate(180deg); 
                box-shadow: 0 0 30px var(--shine-color);
            }
        }

        /* Enhanced Magical Sparkles */
        .magical-sparkle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--shine-color);
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            animation: enhancedSparkle 3s forwards;
        }

        @keyframes enhancedSparkle {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
                box-shadow: 0 0 0 var(--shine-color);
            }
            25% {
                transform: scale(1.5) rotate(90deg);
                opacity: 0.9;
                box-shadow: 0 0 20px var(--shine-color);
            }
            50% {
                transform: scale(2.5) rotate(180deg);
                opacity: 0.7;
                box-shadow: 0 0 35px var(--shine-color);
            }
            75% {
                transform: scale(1.8) rotate(270deg);
                opacity: 0.5;
                box-shadow: 0 0 45px var(--shine-color);
            }
            100% {
                transform: scale(0.5) rotate(360deg);
                opacity: 0;
                box-shadow: 0 0 50px var(--shine-color);
            }
        }

        /* Loading Animation */
        .loading-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2000;
            display: none;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(153, 105, 255, 0.3);
            border-top: 5px solid var(--shine-color);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            box-shadow: 0 0 30px var(--shine-color);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Rarity-specific enhancements */
        .card.legendary {
            animation: legendaryAura 4s ease-in-out infinite;
        }

        @keyframes legendaryAura {
            0%, 100% { box-shadow: 0 0 20px var(--shine-color); }
            50% { box-shadow: 0 0 50px var(--shine-color); }
        }

        .card.rare {
            animation: rareGlow 3s ease-in-out infinite;
        }

        @keyframes rareGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(63, 81, 181, 0.3); }
            50% { box-shadow: 0 0 30px rgba(63, 81, 181, 0.6); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .magical-title {
                font-size: 2.5rem;
            }
            
            .cards-container {
                grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
                gap: 1.5rem;
                padding: 2rem 1rem;
            }
            
            .card {
                width: 130px;
                height: 220px;
            }
            
            .card-symbol {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <canvas id="shine-canvas"></canvas>
    <canvas id="particle-canvas"></canvas>
    <canvas id="glitter-canvas"></canvas>
    
    <div class="loading-animation" id="loading">
        <div class="loading-spinner"></div>
    </div>
    
    <div class="mystical-bg">
        <div class="floating-symbol animate__animated animate__fadeInUp">✨</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-1s">🌙</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-2s">⭐</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-3s">🔮</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-4s">🌟</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-5s">💫</div>
    </div>

    <div class="container">
        <header class="animate__animated animate__fadeInDown">
            <h1 class="magical-title">Mystical Fortune Cards</h1>
            <p class="subtitle">Hover over a card, then click to reveal your cosmic destiny</p>
            <div class="energy-orb"></div>
        </header>

        <div class="card-selection animate__animated animate__fadeInUp animate__delay-1s">
            <button id="draw-cards-btn" class="mystical-btn">
                <span>✨ Draw New Cards ✨</span>
            </button>
            <div class="card-count">
                🔮 Cards Remaining: <span id="cards-remaining">16</span>
            </div>
        </div>

        <div class="card-table animate__animated animate__fadeInUp animate__delay-2s">
            <div class="cards-container" id="cards-container">
                <!-- Cards will be generated by JavaScript -->
            </div>
        </div>

        <div class="message-container" id="message-container">
            <div class="message-card">
                <div class="card-reveal-animation">
                    <div class="cosmic-circle"></div>
                    <div class="rotating-runes"></div>
                </div>
                <div class="message-content">
                    <div class="message-title" id="message-title">Your Fortune</div>
                    <div class="message-text" id="message-text"></div>
                    <div class="fortune-details" id="fortune-details"></div>
                    <div class="message-actions">
                        <button id="reshuffle-btn" class="mystical-btn">
                            <span>🔄 Shuffle Again</span>
                        </button>
                        <button id="save-fortune-btn" class="mystical-btn secondary">
                            <span>💾 Save Fortune</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="animate__animated animate__fadeInUp animate__delay-3s">
            <p>✨ Created for #CodePenChallenge: Pick a Card ✨</p>
            <p class="mystical-quote">"The universe reveals its secrets to those who seek with an open heart"</p>
        </footer>
    </div>

    <script>
        // Enhanced Mystical Cards with Shine Effect
                class EnhancedMysticalCards {
            constructor() {
                // DOM elements
                this.cardsContainer = document.getElementById("cards-container");
                this.messageContainer = document.getElementById("message-container");
                this.messageTitle = document.getElementById("message-title");
                this.messageText = document.getElementById("message-text");
                this.fortuneDetails = document.getElementById("fortune-details");
                this.reshuffleBtn = document.getElementById("reshuffle-btn");
                this.drawCardsBtn = document.getElementById("draw-cards-btn");
                this.saveFortuneBtn = document.getElementById("save-fortune-btn");
                this.cardsRemaining = document.getElementById("cards-remaining");
                this.loadingElement = document.getElementById("loading");
                this.canvas = document.getElementById("particle-canvas");
                this.glitterCanvas = document.getElementById("glitter-canvas");
                this.shineCanvas = document.getElementById("shine-canvas");
                this.ctx = this.canvas.getContext("2d");
                this.glitterCtx = this.glitterCanvas.getContext("2d");
                this.shineCtx = this.shineCanvas.getContext("2d");

                // Enhanced cards data
                this.allCards = [
                    {
                        symbol: "✨",
                        title: "The Star",
                        description: "Hope and inspiration",
                        fortune: "A new opportunity will bring unexpected joy into your life. Trust your intuition to guide you toward success.",
                        details: "Lucky numbers: 7, 14, 21 | Element: Air | Season: Spring | Color: Silver",
                        rarity: "common"
                    },
                    {
                        symbol: "🌙",
                        title: "The Moon",
                        description: "Intuition and mystery",
                        fortune: "Hidden truths will be revealed. Pay attention to your dreams, as they contain important messages from the universe.",
                        details: "Lucky numbers: 3, 9, 18 | Element: Water | Season: Winter | Color: Blue",
                        rarity: "common"
                    },
                    {
                        symbol: "☀️",
                        title: "The Sun",
                        description: "Success and positivity",
                        fortune: "A period of growth and happiness approaches. Your efforts will soon be rewarded magnificently.",
                        details: "Lucky numbers: 1, 10, 19 | Element: Fire | Season: Summer | Color: Gold",
                        rarity: "common"
                    },
                    {
                        symbol: "⚡",
                        title: "The Tower",
                        description: "Sudden change",
                        fortune: "Prepare for a surprising revelation that will change your perspective. Embrace the transformation with courage.",
                        details: "Lucky numbers: 16, 7, 25 | Element: Fire | Season: Autumn | Color: Red",
                        rarity: "uncommon"
                    },
                    {
                        symbol: "🔮",
                        title: "The Magician",
                        description: "Manifestation and power",
                        fortune: "You have all the tools needed to succeed. Your creative powers are at their peak—use them wisely.",
                        details: "Lucky numbers: 1, 8, 15 | Element: Air | Season: All | Color: Purple",
                        rarity: "rare"
                    },
                    {
                        symbol: "🌊",
                        title: "The Ocean",
                        description: "Emotions and intuition",
                        fortune: "Trust the ebb and flow of your emotions. A deep connection awaits if you open your heart.",
                        details: "Lucky numbers: 2, 11, 20 | Element: Water | Season: All | Color: Turquoise",
                        rarity: "common"
                    },
                    {
                        symbol: "🦋",
                        title: "The Butterfly",
                        description: "Transformation and rebirth",
                        fortune: "You are entering a beautiful phase of transformation. What emerges will be more magnificent than before.",
                        details: "Lucky numbers: 5, 12, 23 | Element: Air | Season: Spring | Color: Rainbow",
                        rarity: "uncommon"
                    },
                    {
                        symbol: "🌸",
                        title: "The Blossom",
                        description: "New beginnings",
                        fortune: "A fresh start is blooming in your life. Nurture it with patience and watch it flourish into something beautiful.",
                        details: "Lucky numbers: 4, 13, 22 | Element: Earth | Season: Spring | Color: Pink",
                        rarity: "common"
                    },
                    {
                        symbol: "🔥",
                        title: "The Phoenix",
                        description: "Resurrection and renewal",
                        fortune: "From the ashes of your challenges, you will rise stronger and more radiant than ever before.",
                        details: "Lucky numbers: 8, 17, 26 | Element: Fire | Season: Summer | Color: Orange",
                        rarity: "legendary"
                    },
                    {
                        symbol: "💎",
                        title: "The Diamond",
                        description: "Clarity and strength",
                        fortune: "Your inner strength will shine through any pressure. You are unbreakable and infinitely precious.",
                        details: "Lucky numbers: 6, 15, 24 | Element: Earth | Season: All | Color: Crystal",
                        rarity: "rare"
                    },
                    {
                        symbol: "🌟",
                        title: "The Cosmic Gate",
                        description: "Infinite possibilities",
                        fortune: "The universe is aligning to open doors you never knew existed. Step through with courage and wonder.",
                        details: "Lucky numbers: 11, 22, 33 | Element: Ether | Season: All | Color: Golden",
                        rarity: "legendary"
                    },
                    {
                        symbol: "🕊️",
                        title: "The Dove",
                        description: "Peace and harmony",
                        fortune: "Inner peace is your greatest treasure. From this serene center, all good things will flow naturally.",
                        details: "Lucky numbers: 9, 18, 27 | Element: Air | Season: All | Color: White",
                        rarity: "uncommon"
                    },
                    {
                        symbol: "🎭",
                        title: "The Masks",
                        description: "Hidden aspects",
                        fortune: "It's time to reveal your true self. The masks you wear no longer serve your highest good.",
                        details: "Lucky numbers: 14, 23, 32 | Element: Air | Season: Autumn | Color: Silver",
                        rarity: "rare"
                    },
                    {
                        symbol: "🗝️",
                        title: "The Key",
                        description: "Solutions and access",
                        fortune: "The answer you seek is within reach. Trust your wisdom to unlock the door to success.",
                        details: "Lucky numbers: 7, 16, 25 | Element: Metal | Season: All | Color: Bronze",
                        rarity: "uncommon"
                    },
                    {
                        symbol: "🌈",
                        title: "The Rainbow",
                        description: "Hope after storms",
                        fortune: "After every storm comes a rainbow. Your difficult times are leading to beautiful outcomes.",
                        details: "Lucky numbers: 3, 12, 21 | Element: All | Season: Spring | Color: Spectrum",
                        rarity: "rare"
                    },
                    {
                        symbol: "🌳",
                        title: "The Ancient Tree",
                        description: "Wisdom and growth",
                        fortune: "Your roots run deep, and your branches reach high. Draw upon ancient wisdom for guidance.",
                        details: "Lucky numbers: 5, 14, 23 | Element: Earth | Season: All | Color: Green",
                        rarity: "legendary"
                    }
                ];

                // Shine effect properties
                this.shineParticles = [];
                this.shineDepth = 0;
                this.shineRotation = 0;
                this.mouse = { x: 0, y: 0 };
                this.mouseDeltas = { x: 0, y: 0 };
                this.w = 0;
                this.h = 0;

                // Current deck and state
                this.currentDeck = [];
                this.availableCards = [...this.allCards];
                this.selectedCard = null;
                this.isRevealed = false;
                this.savedFortunes = JSON.parse(localStorage.getItem('mysticalFortunes') || '[]');

                // Particle systems
                this.particles = [];
                this.glitterParticles = [];
                this.particleColors = ["#9969ff", "#ff69a1", "#69b4ff", "#ffeb3b", "#ff9f69", "#00e5ff", "#76ff03"];

                // Initialize
                this.init();
            }

            init() {
                this.showLoading();
                this.setupCanvas();
                this.setupShineEffect();
                
                setTimeout(() => {
                    this.drawNewCards();
                    this.hideLoading();
                }, 1500);
                
                this.setupEventListeners();
                this.animateParticles();
                this.animateGlitter();
                this.animateShine();
                this.createAmbientEffects();
            }

            // Shine Effect Setup
            setupShineEffect() {
                this.w = this.shineCanvas.width = window.innerWidth;
                this.h = this.shineCanvas.height = window.innerHeight;
                this.shineDepth = this.w;

                // Create shine particles
                for (let i = 0; i < 3000; i++) {
                    const particle = {
                        originalPos: {
                            x: this.rnd(-this.w, this.w),
                            y: this.rnd(-this.h, this.h),
                            z: this.rnd(-this.shineDepth, this.shineDepth)
                        },
                        rotatedPos: {
                            x: 0,
                            y: 0,
                            z: 0
                        },
                        rotation: {
                            x: 0,
                            y: 0,
                            z: 0
                        },
                        velocity: {
                            x: 0,
                            y: 0,
                            z: 0
                        },
                        color: `hsla(${this.rnd(280, 320)}, 95%, 85%, ${this.rnd(0.3, 0.9)})`
                    };
                    
                    // Initialize rotated position
                    particle.rotatedPos.x = particle.originalPos.x;
                    particle.rotatedPos.y = particle.originalPos.y;
                    particle.rotatedPos.z = particle.originalPos.z;
                    
                    this.shineParticles.push(particle);
                }
            }

            // Shine Animation
            animateShine() {
                this.shineCtx.clearRect(0, 0, this.w, this.h);
                
                // Create gradient background
                const gradient = this.shineCtx.createLinearGradient(
                    this.w + this.w, this.h + this.h * 1.5,
                    this.w + this.w, 1
                );
                gradient.addColorStop(0, 'hsla(280, 15%, 25%, 0.8)');
                gradient.addColorStop(0.3, 'hsla(300, 95%, 15%, 0.6)');
                gradient.addColorStop(0.6, 'hsla(280, 95%, 8%, 0.4)');
                gradient.addColorStop(1, 'hsla(0, 0%, 5%, 0.2)');
                
                this.shineCtx.globalCompositeOperation = 'normal';
                this.shineCtx.fillStyle = gradient;
                this.shineCtx.fillRect(0, 0, this.w, this.h);
                
                // Draw mystical title with shine effect
                const titleText = "Mystical Fortune Cards".split("").join(String.fromCharCode(0x2004));
                this.shineCtx.font = "2.5em 'Poiret One', cursive";
                this.shineCtx.fillStyle = 'hsla(280, 95%, 85%, 0.15)';
                this.shineCtx.textBaseline = 'middle';
                this.shineCtx.fillText(
                    titleText,
                    (this.w - this.shineCtx.measureText(titleText).width) * 0.5,
                    this.h * 0.15
                );

                this.shineCtx.globalCompositeOperation = 'lighter';
                
                // Update and draw shine particles
                this.updateShineParticles();
                this.drawShineParticles();
                
                requestAnimationFrame(this.animateShine.bind(this));
            }

            updateShineParticles() {
                for (let particle of this.shineParticles) {
                    // Update velocity based on mouse movement
                    particle.velocity.x += this.mouseDeltas.x * 0.1;
                    particle.velocity.y += this.mouseDeltas.y * 0.1;
                    
                    // Copy original position
                    particle.rotatedPos.x = particle.originalPos.x;
                    particle.rotatedPos.y = particle.originalPos.y;
                    particle.rotatedPos.z = particle.originalPos.z;
                    
                    // Update rotation
                    particle.rotation.x += particle.velocity.x;
                    particle.rotation.y += particle.velocity.y;
                    particle.rotation.z += particle.velocity.z;
                    
                    // Apply rotation
                    this.rotateY(particle, particle.rotation.y);
                    this.rotateX(particle, particle.rotation.x);
                    
                    // Apply damping
                    particle.velocity.x *= 0.98;
                }
                
                // Smooth mouse deltas
                this.mouseDeltas.x *= 0.95;
                this.mouseDeltas.y *= 0.95;
            }

            drawShineParticles() {
                for (let particle of this.shineParticles) {
                    const depth = (particle.rotatedPos.z / this.shineDepth) + 1;
                    const x = this.w * 0.5 + particle.rotatedPos.x;
                    const y = this.h * 0.5 + particle.rotatedPos.y;
                    const size = this.rnd(depth * 0.5, depth * 2);
                    
                    // Create shimmer effect
                    const shimmer = Math.sin(Date.now() * 0.001 + particle.originalPos.x * 0.01) * 0.5 + 0.5;
                    const alpha = (depth - 0.5) * shimmer;
                    
                    if (alpha > 0) {
                        this.shineCtx.fillStyle = particle.color.replace(/[\d.]+\)$/g, `${alpha})`);
                        this.shineCtx.fillRect(x, y, size, size * 0.8);
                        
                        // Add glow effect for brighter particles
                        if (alpha > 0.7) {
                            this.shineCtx.shadowBlur = 20;
                            this.shineCtx.shadowColor = particle.color;
                            this.shineCtx.fillRect(x, y, size, size * 0.8);
                            this.shineCtx.shadowBlur = 0;
                        }
                    }
                }
            }

            // Rotation functions for shine effect
            rotateX(particle, angle) {
                const y = particle.rotatedPos.y;
                const z = particle.rotatedPos.z;
                particle.rotatedPos.y = y * Math.cos(angle) - z * Math.sin(angle);
                particle.rotatedPos.z = z * Math.cos(angle) + y * Math.sin(angle);
            }

            rotateY(particle, angle) {
                const x = particle.rotatedPos.x;
                const z = particle.rotatedPos.z;
                particle.rotatedPos.x = x * Math.cos(angle) - z * Math.sin(angle);
                particle.rotatedPos.z = z * Math.cos(angle) + x * Math.sin(angle);
            }

            // Enhanced event listeners
            setupEventListeners() {
                this.reshuffleBtn.addEventListener("click", () => this.reshuffleCards());
                this.drawCardsBtn.addEventListener("click", () => this.drawNewCards());
                this.saveFortuneBtn.addEventListener("click", () => this.saveFortune());
                
                // Enhanced mouse movement for shine effect
                window.addEventListener('mousemove', (e) => {
                    this.mouseDeltas.x = (e.clientY - this.mouse.y) / this.w;
                    this.mouseDeltas.y = (e.clientX - this.mouse.x) / this.h;
                    this.mouse.x = e.clientX;
                    this.mouse.y = e.clientY;
                    this.createGlitterTrail(e);
                });
                
                // Touch events for mobile
                window.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    this.mouseDeltas.x = (e.touches[0].clientY - this.mouse.y) / this.w;
                    this.mouseDeltas.y = (e.touches[0].clientX - this.mouse.x) / this.h;
                    this.mouse.x = e.touches[0].clientX;
                    this.mouse.y = e.touches[0].clientY;
                }, { passive: false });
                
                // Enhanced resize handler
                window.addEventListener('resize', () => {
                    this.w = this.shineCanvas.width = window.innerWidth;
                    this.h = this.shineCanvas.height = window.innerHeight;
                    this.canvas.width = window.innerWidth;
                    this.canvas.height = window.innerHeight;
                    this.glitterCanvas.width = window.innerWidth;
                    this.glitterCanvas.height = window.innerHeight;
                });
                
                // Click sparkles
                document.addEventListener('click', (e) => this.createClickSparkles(e));
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.isRevealed) {
                        this.reshuffleCards();
                    }
                    if (e.key === 'Enter' && !this.isRevealed) {
                        this.drawNewCards();
                    }
                    if (e.key === 's' && this.isRevealed) {
                        this.saveFortune();
                    }
                });
            }

            // Enhanced loading functions
            showLoading() {
                this.loadingElement.style.display = 'block';
                this.loadingElement.classList.add('animate__animated', 'animate__fadeIn');
            }

            hideLoading() {
                this.loadingElement.classList.add('animate__animated', 'animate__fadeOut');
                setTimeout(() => {
                    this.loadingElement.style.display = 'none';
                    this.loadingElement.classList.remove('animate__animated', 'animate__fadeOut');
                }, 500);
            }

            // Enhanced card drawing
            drawNewCards() {
                this.showLoading();
                this.currentDeck = [];
                
                const shuffled = [...this.availableCards].sort(() => Math.random() - 0.5);
                this.currentDeck = shuffled.slice(0, 6);
                this.cardsRemaining.textContent = this.availableCards.length;
                
                // Create dramatic shine burst
                this.createShineBurst();
                
                setTimeout(() => {
                    this.createCards();
                    this.hideLoading();
                }, 1000);
            }

            createShineBurst() {
                // Create additional shine particles for dramatic effect
                for (let i = 0; i < 100; i++) {
                    const burstParticle = {
                        originalPos: {
                            x: this.rnd(-50, 50),
                            y: this.rnd(-50, 50),
                            z: this.rnd(-100, 100)
                        },
                        rotatedPos: { x: 0, y: 0, z: 0 },
                        rotation: { x: 0, y: 0, z: 0 },
                        velocity: {
                            x: this.rnd(-0.1, 0.1),
                            y: this.rnd(-0.1, 0.1),
                            z: 0
                        },
                        color: `hsla(${this.rnd(280, 320)}, 95%, 85%, ${this.rnd(0.7, 1)})`,
                        life: 60,
                        maxLife: 60
                    };
                    
                    burstParticle.rotatedPos.x = burstParticle.originalPos.x;
                    burstParticle.rotatedPos.y = burstParticle.originalPos.y;
                    burstParticle.rotatedPos.z = burstParticle.originalPos.z;
                    
                    this.shineParticles.push(burstParticle);
                }
            }

            // Enhanced card creation
            createCards() {
                this.cardsContainer.innerHTML = "";

                this.currentDeck.forEach((card, index) => {
                    const cardElement = document.createElement("div");
                    cardElement.className = `card ${card.rarity}`;
                    cardElement.innerHTML = `
                        <div class="card-face card-back">
                            <div class="card-glow"></div>
                        </div>
                        <div class="card-face card-front">
                            <div class="card-symbol">${card.symbol}</div>
                            <div class="card-title">${card.title}</div>
                            <div class="card-desc">${card.description}</div>
                        </div>
                    `;

                    cardElement.addEventListener("click", () => this.selectCard(cardElement, card));
                    cardElement.addEventListener("mouseenter", () => this.cardHoverEffect(cardElement));
                    cardElement.addEventListener("mouseleave", () => this.cardLeaveEffect(cardElement));

                    // Enhanced entrance animation
                    setTimeout(() => {
                        cardElement.classList.add('animate__animated', 'animate__flipInY');
                        this.createCardSparkles(cardElement);
                    }, index * 200);

                    const randomRotation = Math.random() * 6 - 3;
                    cardElement.style.transform = `rotateZ(${randomRotation}deg)`;

                    this.cardsContainer.appendChild(cardElement);
                });
            }

            createCardSparkles(cardElement) {
                const rect = cardElement.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                for (let i = 0; i < 12; i++) {
                    this.createEnhancedSparkle(centerX, centerY);
                }
            }

            cardHoverEffect(cardElement) {
                const rect = cardElement.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                for (let i = 0; i < 8; i++) {
                    this.createGlitterParticle(
                        centerX + (Math.random() - 0.5) * 100,
                        centerY + (Math.random() - 0.5) * 100
                    );
                }

                // Create localized shine effect
                this.createLocalShine(centerX, centerY);
                
                cardElement.classList.add('animate__animated', 'animate__pulse');
            }

            createLocalShine(x, y) {
                for (let i = 0; i < 20; i++) {
                    const localShine = {
                        originalPos: {
                            x: this.rnd(-50, 50),
                            y: this.rnd(-50, 50),
                            z: this.rnd(-50, 50)
                        },
                        rotatedPos: { x: 0, y: 0, z: 0 },
                        rotation: { x: 0, y: 0, z: 0 },
                        velocity: {
                            x: this.rnd(-0.05, 0.05),
                            y: this.rnd(-0.05, 0.05),
                            z: 0
                        },
                        color: `hsla(${this.rnd(280, 320)}, 95%, 85%, ${this.rnd(0.5, 0.8)})`,
                        centerX: x,
                        centerY: y,
                        life: 30,
                        maxLife: 30
                    };
                    
                    localShine.rotatedPos.x = localShine.originalPos.x;
                    localShine.rotatedPos.y = localShine.originalPos.y;
                    localShine.rotatedPos.z = localShine.originalPos.z;
                    
                    this.shineParticles.push(localShine);
                }
            }

            cardLeaveEffect(cardElement) {
                cardElement.classList.remove('animate__animated', 'animate__pulse');
            }

            // Enhanced card selection
            selectCard(cardElement, cardData) {
                if (this.isRevealed) return;

                cardElement.classList.add('selected');
                cardElement.classList.add('animate__animated', 'animate__tada');

                // Create massive shine explosion
                this.createMassiveShineExplosion(cardElement);
                
                // Enhanced magical effect
                this.createEnhancedMagicalEffect(cardElement);

                setTimeout(() => {
                    cardElement.classList.add("flipped");
                }, 500);

                this.selectedCard = { element: cardElement, data: cardData };

                const allCards = this.cardsContainer.querySelectorAll(".card");
                allCards.forEach((card) => {
                    if (card !== cardElement) {
                        card.style.opacity = "0.3";
                        card.style.transform = "scale(0.9)";
                        card.style.filter = "grayscale(0.8)";
                        card.style.pointerEvents = "none";
                        card.classList.add('animate__animated', 'animate__fadeOut');
                    }
                });

                setTimeout(() => {
                    this.revealFortune(cardData);
                }, 1500);
            }

            createMassiveShineExplosion(cardElement) {
                const rect = cardElement.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                // Create explosion of shine particles
                for (let i = 0; i < 150; i++) {
                    const angle = (Math.PI * 2 * i) / 150;
                    const distance = this.rnd(50, 300);
                    const explosionParticle = {
                        originalPos: {
                            x: Math.cos(angle) * distance,
                            y: Math.sin(angle) * distance,
                            z: this.rnd(-100, 100)
                        },
                        rotatedPos: { x: 0, y: 0, z: 0 },
                        rotation: { x: 0, y: 0, z: 0 },
                        velocity: {
                            x: Math.cos(angle) * 0.2,
                            y: Math.sin(angle) * 0.2,
                            z: this.rnd(-0.1, 0.1)
                        },
                        color: `hsla(${this.rnd(280, 320)}, 95%, 85%, ${this.rnd(0.8, 1)})`,
                        centerX: centerX,
                        centerY: centerY,
                        life: 100,
                        maxLife: 100
                    };
                    
                    explosionParticle.rotatedPos.x = explosionParticle.originalPos.x;
                    explosionParticle.rotatedPos.y = explosionParticle.originalPos.y;
                    explosionParticle.rotatedPos.z = explosionParticle.originalPos.z;
                    
                    this.shineParticles.push(explosionParticle);
                }
            }

            // Enhanced fortune revelation
            revealFortune(cardData) {
                this.isRevealed = true;

                this.messageTitle.textContent = cardData.title;
                this.messageText.textContent = cardData.fortune;
                this.fortuneDetails.textContent = cardData.details;

                this.messageContainer.classList.add("visible");
                
                setTimeout(() => {
                    const messageCard = this.messageContainer.querySelector('.message-card');
                    messageCard.classList.add('animate__animated', 'animate__zoomIn');
                }, 100);

                // Create multiple particle effects
                for (let i = 0; i < 100; i++) {
                    this.createParticle(window.innerWidth / 2, window.innerHeight / 2, true);
                }

                for (let i = 0; i < 60; i++) {
                    this.createGlitterParticle(window.innerWidth / 2, window.innerHeight / 2, true);
                }

                // Create fortune shine effect
                this.createFortuneShine();
                
                this.playMagicalSound();
            }

            createFortuneShine() {
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                
                for (let i = 0; i < 200; i++) {
                    const fortuneShine = {
                        originalPos: {
                            x: this.rnd(-200, 200),
                            y: this.rnd(-200, 200),
                            z: this.rnd(-200, 200)
                        },
                        rotatedPos: { x: 0, y: 0, z: 0 },
                        rotation: { x: 0, y: 0, z: 0 },
                        velocity: {
                            x: this.rnd(-0.3, 0.3),
                            y: this.rnd(-0.3, 0.3),
                            z: this.rnd(-0.1, 0.1)
                        },
                        color: `hsla(${this.rnd(280, 320)}, 95%, 85%, ${this.rnd(0.6, 1)})`,
                        centerX: centerX,
                        centerY: centerY,
                        life: 150,
                        maxLife: 150
                    };
                    
                    fortuneShine.rotatedPos.x = fortuneShine.originalPos.x;
                    fortuneShine.rotatedPos.y = fortuneShine.originalPos.y;
                    fortuneShine.rotatedPos.z = fortuneShine.originalPos.z;
                    
                    this.shineParticles.push(fortuneShine);
                }
            }

            // Enhanced magical effects
            createEnhancedMagicalEffect(element) {
                const rect = element.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                                // Create multiple rings of enhanced sparkles
                for (let ring = 0; ring < 4; ring++) {
                    const ringRadius = 60 + (ring * 40);
                    const sparkleCount = 10 + (ring * 5);
                    
                    for (let i = 0; i < sparkleCount; i++) {
                        const angle = (Math.PI * 2 * i) / sparkleCount;
                        const posX = centerX + Math.cos(angle) * ringRadius;
                        const posY = centerY + Math.sin(angle) * ringRadius;
                        
                        setTimeout(() => {
                            this.createEnhancedSparkle(posX, posY);
                        }, ring * 150);
                    }
                }

                // Create enhanced particles
                for (let i = 0; i < 40; i++) {
                    this.createParticle(centerX, centerY);
                }

                // Create screen pulse effect
                this.createScreenPulse();
            }

            createEnhancedSparkle(x, y) {
                const sparkle = document.createElement("div");
                sparkle.className = "magical-sparkle";

                sparkle.style.left = `${x}px`;
                sparkle.style.top = `${y}px`;

                // Enhanced colors with shine effect
                const colors = ["#9969ff", "#ff69a1", "#ffeb3b", "#69b4ff", "#ff9f69", "hsla(280, 95%, 85%, 0.9)"];
                sparkle.style.background = colors[Math.floor(Math.random() * colors.length)];

                const size = Math.random() * 15 + 8;
                sparkle.style.width = `${size}px`;
                sparkle.style.height = `${size}px`;

                // Add enhanced glow
                sparkle.style.boxShadow = `0 0 ${size * 3}px ${sparkle.style.background}`;

                document.body.appendChild(sparkle);

                setTimeout(() => {
                    sparkle.remove();
                }, 3000);
            }

            createScreenPulse() {
                const pulse = document.createElement('div');
                pulse.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: radial-gradient(circle, hsla(280, 95%, 85%, 0.2) 0%, transparent 70%);
                    z-index: 50;
                    pointer-events: none;
                    animation: screenPulse 2s ease-out forwards;
                `;

                document.body.appendChild(pulse);

                setTimeout(() => {
                    pulse.remove();
                }, 2000);

                // Add CSS animation
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes screenPulse {
                        0% { opacity: 0; transform: scale(0.8); }
                        50% { opacity: 1; transform: scale(1.2); }
                        100% { opacity: 0; transform: scale(1.5); }
                    }
                `;
                document.head.appendChild(style);
            }

            // Enhanced reshuffle
            reshuffleCards() {
                const messageCard = this.messageContainer.querySelector('.message-card');
                messageCard.classList.add('animate__animated', 'animate__zoomOut');
                
                setTimeout(() => {
                    this.messageContainer.classList.remove("visible");
                    messageCard.classList.remove('animate__animated', 'animate__zoomOut');
                }, 500);

                this.isRevealed = false;
                this.selectedCard = null;

                // Create reshuffle shine effect
                this.createReshuffleShine();

                // Create particles burst
                for (let i = 0; i < 50; i++) {
                                        this.createParticle(window.innerWidth / 2, window.innerHeight / 2, true);
                }

                setTimeout(() => {
                    this.drawNewCards();
                }, 800);
            }

            createReshuffleShine() {
                for (let i = 0; i < 80; i++) {
                    const reshuffleShine = {
                        originalPos: {
                            x: this.rnd(-100, 100),
                            y: this.rnd(-100, 100),
                            z: this.rnd(-100, 100)
                        },
                        rotatedPos: { x: 0, y: 0, z: 0 },
                        rotation: { x: 0, y: 0, z: 0 },
                        velocity: {
                            x: this.rnd(-0.2, 0.2),
                            y: this.rnd(-0.2, 0.2),
                            z: this.rnd(-0.1, 0.1)
                        },
                        color: `hsla(${this.rnd(280, 320)}, 95%, 85%, ${this.rnd(0.4, 0.8)})`,
                        life: 80,
                        maxLife: 80
                    };
                    
                    reshuffleShine.rotatedPos.x = reshuffleShine.originalPos.x;
                    reshuffleShine.rotatedPos.y = reshuffleShine.originalPos.y;
                    reshuffleShine.rotatedPos.z = reshuffleShine.originalPos.z;
                    
                    this.shineParticles.push(reshuffleShine);
                }
            }

            // Enhanced save fortune
            saveFortune() {
                if (!this.selectedCard) return;

                const fortune = {
                    title: this.selectedCard.data.title,
                    fortune: this.selectedCard.data.fortune,
                    details: this.selectedCard.data.details,
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString()
                };

                this.savedFortunes.push(fortune);
                localStorage.setItem('mysticalFortunes', JSON.stringify(this.savedFortunes));

                this.showNotification("Fortune saved to your mystical collection! ✨");
                this.createSaveShine();
            }

            createSaveShine() {
                const saveButton = document.getElementById('save-fortune-btn');
                const rect = saveButton.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                for (let i = 0; i < 30; i++) {
                    const saveShine = {
                        originalPos: {
                            x: this.rnd(-30, 30),
                            y: this.rnd(-30, 30),
                            z: this.rnd(-30, 30)
                        },
                        rotatedPos: { x: 0, y: 0, z: 0 },
                        rotation: { x: 0, y: 0, z: 0 },
                        velocity: {
                            x: this.rnd(-0.1, 0.1),
                            y: this.rnd(-0.1, 0.1),
                            z: 0
                        },
                        color: `hsla(${this.rnd(280, 320)}, 95%, 85%, ${this.rnd(0.6, 0.9)})`,
                        centerX: centerX,
                        centerY: centerY,
                        life: 40,
                        maxLife: 40
                    };
                    
                    saveShine.rotatedPos.x = saveShine.originalPos.x;
                    saveShine.rotatedPos.y = saveShine.originalPos.y;
                    saveShine.rotatedPos.z = saveShine.originalPos.z;
                    
                    this.shineParticles.push(saveShine);
                }
            }

            // Enhanced notification system
            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.textContent = message;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
                    color: white;
                    padding: 1rem 2rem;
                    border-radius: 15px;
                    font-family: "Cinzel", serif;
                    z-index: 10000;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
                    border: 2px solid hsla(280, 95%, 85%, 0.5);
                `;

                document.body.appendChild(notification);
                
                notification.classList.add('animate__animated', 'animate__slideInRight');

                // Create notification shine effect
                this.createNotificationShine(notification);

                setTimeout(() => {
                    notification.classList.add('animate__animated', 'animate__slideOutRight');
                    setTimeout(() => {
                        notification.remove();
                    }, 500);
                }, 3000);
            }

            createNotificationShine(notification) {
                const rect = notification.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                for (let i = 0; i < 15; i++) {
                    this.createEnhancedSparkle(
                        centerX + this.rnd(-50, 50),
                        centerY + this.rnd(-20, 20)
                    );
                }
            }

            // Enhanced glitter trail
            createGlitterTrail(event) {
                if (Math.random() < 0.4) {
                    this.createGlitterParticle(event.clientX, event.clientY);
                    
                    // Add shine particles to trail
                    if (Math.random() < 0.2) {
                        const trailShine = {
                            originalPos: {
                                x: this.rnd(-10, 10),
                                y: this.rnd(-10, 10),
                                z: this.rnd(-10, 10)
                            },
                            rotatedPos: { x: 0, y: 0, z: 0 },
                            rotation: { x: 0, y: 0, z: 0 },
                            velocity: {
                                x: this.rnd(-0.05, 0.05),
                                y: this.rnd(-0.05, 0.05),
                                z: 0
                            },
                            color: `hsla(${this.rnd(280, 320)}, 95%, 85%, ${this.rnd(0.3, 0.6)})`,
                            centerX: event.clientX,
                            centerY: event.clientY,
                            life: 20,
                            maxLife: 20
                        };
                        
                        trailShine.rotatedPos.x = trailShine.originalPos.x;
                        trailShine.rotatedPos.y = trailShine.originalPos.y;
                        trailShine.rotatedPos.z = trailShine.originalPos.z;
                        
                        this.shineParticles.push(trailShine);
                    }
                }
            }

            // Enhanced click sparkles
            createClickSparkles(event) {
                for (let i = 0; i < 15; i++) {
                    const sparkle = document.createElement("div");
                    sparkle.className = "magical-sparkle";
                    
                    const offsetX = (Math.random() - 0.5) * 120;
                    const offsetY = (Math.random() - 0.5) * 120;
                    
                    sparkle.style.left = `${event.clientX + offsetX}px`;
                    sparkle.style.top = `${event.clientY + offsetY}px`;
                    
                    const colors = ["#9969ff", "#ff69a1", "#ffeb3b", "#69b4ff", "hsla(280, 95%, 85%, 0.9)"];
                    sparkle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    
                    const size = Math.random() * 12 + 6;
                    sparkle.style.width = `${size}px`;
                    sparkle.style.height = `${size}px`;
                    sparkle.style.boxShadow = `0 0 ${size * 2}px ${sparkle.style.background}`;
                    
                    document.body.appendChild(sparkle);
                    
                    setTimeout(() => {
                        sparkle.remove();
                    }, 3000);
                }

                // Add click shine effect
                this.createClickShine(event.clientX, event.clientY);
            }

            createClickShine(x, y) {
                for (let i = 0; i < 25; i++) {
                    const clickShine = {
                        originalPos: {
                            x: this.rnd(-40, 40),
                            y: this.rnd(-40, 40),
                            z: this.rnd(-40, 40)
                        },
                        rotatedPos: { x: 0, y: 0, z: 0 },
                        rotation: { x: 0, y: 0, z: 0 },
                        velocity: {
                            x: this.rnd(-0.15, 0.15),
                            y: this.rnd(-0.15, 0.15),
                            z: this.rnd(-0.05, 0.05)
                        },
                        color: `hsla(${this.rnd(280, 320)}, 95%, 85%, ${this.rnd(0.4, 0.8)})`,
                        centerX: x,
                        centerY: y,
                        life: 30,
                        maxLife: 30
                    };
                    
                    clickShine.rotatedPos.x = clickShine.originalPos.x;
                    clickShine.rotatedPos.y = clickShine.originalPos.y;
                    clickShine.rotatedPos.z = clickShine.originalPos.z;
                    
                    this.shineParticles.push(clickShine);
                }
            }

            // Canvas setup
            setupCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                this.glitterCanvas.width = window.innerWidth;
                this.glitterCanvas.height = window.innerHeight;

                // Create background particles
                for (let i = 0; i < 70; i++) {
                    this.createParticle(
                        Math.random() * this.canvas.width,
                        Math.random() * this.canvas.height
                    );
                }
            }

            // Enhanced particle system
            createParticle(x, y, isBurst = false) {
                const color = this.particleColors[
                    Math.floor(Math.random() * this.particleColors.length)
                ];

                const particle = {
                    x,
                    y,
                    size: Math.random() * 6 + 2,
                    color,
                    speedX: (Math.random() - 0.5) * (isBurst ? 15 : 2),
                    speedY: (Math.random() - 0.5) * (isBurst ? 15 : 2),
                    life: 150,
                    maxLife: 150,
                    gravity: isBurst ? 0.12 : 0.06,
                    bounce: 0.85,
                    glow: Math.random() * 20 + 10
                };

                this.particles.push(particle);

                if (this.particles.length > 120) {
                    this.particles.shift();
                }
            }

            createGlitterParticle(x, y, isBurst = false) {
                const glitter = {
                    x,
                    y,
                    size: Math.random() * 5 + 2,
                    color: `hsla(${Math.random() * 60 + 280}, 95%, 85%, ${Math.random() * 0.5 + 0.5})`,
                    speedX: (Math.random() - 0.5) * (isBurst ? 10 : 4),
                    speedY: (Math.random() - 0.5) * (isBurst ? 10 : 4),
                    life: 100,
                    maxLife: 100,
                    twinkle: Math.random() * Math.PI * 2,
                    twinkleSpeed: Math.random() * 0.3 + 0.1,
                    glow: Math.random() * 15 + 5
                };

                this.glitterParticles.push(glitter);

                if (this.glitterParticles.length > 80) {
                    this.glitterParticles.shift();
                }
            }

            // Enhanced particle animations
            animateParticles() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const p = this.particles[i];

                    p.x += p.speedX;
                    p.y += p.speedY;
                    p.speedY += p.gravity;

                    // Enhanced edge bouncing
                    if (p.x <= p.size || p.x >= this.canvas.width - p.size) {
                        p.speedX *= -p.bounce;
                        p.x = Math.max(p.size, Math.min(this.canvas.width - p.size, p.x));
                    }
                    if (p.y >= this.canvas.height - p.size) {
                        p.speedY *= -p.bounce;
                        p.y = this.canvas.height - p.size;
                    }

                    p.speedX *= 0.995;
                    p.speedY *= 0.995;
                    p.life--;

                    const opacity = Math.max(0, p.life / p.maxLife);

                    // Enhanced particle rendering with glow
                    this.ctx.shadowBlur = p.glow;
                    this.ctx.shadowColor = p.color;
                    this.ctx.beginPath();
                    this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    this.ctx.fillStyle = `${p.color}${Math.floor(opacity * 255)
                        .toString(16)
                        .padStart(2, "0")}`;
                    this.ctx.fill();
                    this.ctx.shadowBlur = 0;

                    if (p.life <= 0) {
                        this.particles.splice(i, 1);
                    }
                }

                // Maintain particle count
                while (this.particles.length < 70) {
                    this.createParticle(
                        Math.random() * this.canvas.width,
                        Math.random() * this.canvas.height
                    );
                }

                requestAnimationFrame(this.animateParticles.bind(this));
            }

            // Enhanced glitter animation
            animateGlitter() {
                this.glitterCtx.clearRect(0, 0, this.glitterCanvas.width, this.glitterCanvas.height);

                for (let i = this.glitterParticles.length - 1; i >= 0; i--) {
                    const g = this.glitterParticles[i];

                    g.x += g.speedX;
                    g.y += g.speedY;
                    g.twinkle += g.twinkleSpeed;

                    g.speedX *= 0.99;
                    g.speedY *= 0.99;
                    g.life--;

                    const opacity = Math.max(0, g.life / g.maxLife);
                    const twinkleOpacity = opacity * (0.5 + 0.5 * Math.sin(g.twinkle));

                    // Enhanced glitter rendering
                    this.glitterCtx.shadowBlur = g.glow;
                    this.glitterCtx.shadowColor = g.color;
                    
                    this.glitterCtx.beginPath();
                    this.glitterCtx.arc(g.x, g.y, g.size, 0, Math.PI * 2);
                    this.glitterCtx.fillStyle = `${g.color}${Math.floor(twinkleOpacity * 255)
                        .toString(16)
                        .padStart(2, "0")}`;
                    this.glitterCtx.fill();

                    // Enhanced star effect
                    this.glitterCtx.strokeStyle = `${g.color}${Math.floor(twinkleOpacity * 255)
                        .toString(16)
                        .padStart(2, "0")}`;
                    this.glitterCtx.lineWidth = 2;
                    this.glitterCtx.beginPath();
                    this.glitterCtx.moveTo(g.x - g.size * 1.5, g.y);
                    this.glitterCtx.lineTo(g.x + g.size * 1.5, g.y);
                    this.glitterCtx.moveTo(g.x, g.y - g.size * 1.5);
                    this.glitterCtx.lineTo(g.x, g.y + g.size * 1.5);
                    this.glitterCtx.stroke();
                    
                    this.glitterCtx.shadowBlur = 0;

                    if (g.life <= 0) {
                        this.glitterParticles.splice(i, 1);
                    }
                }

                requestAnimationFrame(this.animateGlitter.bind(this));
            }

            // Enhanced ambient effects
            createAmbientEffects() {
                // Periodic ambient particles
                setInterval(() => {
                    if (Math.random() < 0.8) {
                        this.createParticle(
                            Math.random() * this.canvas.width,
                            -10
                        );
                    }
                }, 1500);

                // Periodic glitter bursts
                setInterval(() => {
                    if (Math.random() < 0.4) {
                        const x = Math.random() * this.canvas.width;
                        const y = Math.random() * this.canvas.height;
                        for (let i = 0; i < 8; i++) {
                            this.createGlitterParticle(x, y);
                        }
                    }
                }, 4000);

                // Periodic shine bursts
                setInterval(() => {
                    if (Math.random() < 0.3) {
                        this.createAmbientShine();
                    }
                }, 6000);

                this.createFloatingText();
            }

            createAmbientShine() {
                const x = Math.random() * this.w;
                const y = Math.random() * this.h;
                
                for (let i = 0; i < 30; i++) {
                    const ambientShine = {
                        originalPos: {
                            x: this.rnd(-50, 50),
                            y: this.rnd(-50, 50),
                            z: this.rnd(-50, 50)
                        },
                        rotatedPos: { x: 0, y: 0, z: 0 },
                        rotation: { x: 0, y: 0, z: 0 },
                        velocity: {
                            x: this.rnd(-0.1, 0.1),
                            y: this.rnd(-0.1, 0.1),
                            z: this.rnd(-0.05, 0.05)
                        },
                        color: `hsla(${this.rnd(280, 320)}, 95%, 85%, ${this.rnd(0.2, 0.5)})`,
                        centerX: x,
                        centerY: y,
                        life: 60,
                        maxLife: 60
                    };
                    
                    ambientShine.rotatedPos.x = ambientShine.originalPos.x;
                                        ambientShine.rotatedPos.y = ambientShine.originalPos.y;
                    ambientShine.rotatedPos.z = ambientShine.originalPos.z;
                    
                    this.shineParticles.push(ambientShine);
                }
            }

            // Enhanced floating text
            createFloatingText() {
                const mysticalPhrases = [
                    "✨ Magic flows through the cosmos",
                    "🌟 The stars whisper ancient secrets",
                    "🔮 Destiny weaves its golden threads",
                    "🌙 Dreams dance with moonlight",
                    "⭐ Believe in the impossible",
                    "💫 Wonder illuminates the path",
                    "🌈 Hope paints the sky with colors",
                    "🦋 Transformation brings beauty"
                ];

                setInterval(() => {
                    if (Math.random() < 0.25) {
                        const phrase = mysticalPhrases[Math.floor(Math.random() * mysticalPhrases.length)];
                        this.showFloatingText(phrase);
                    }
                }, 12000);
            }

            showFloatingText(text) {
                const floatingText = document.createElement('div');
                floatingText.textContent = text;
                floatingText.style.cssText = `
                    position: fixed;
                    top: 25%;
                    left: 50%;
                    transform: translateX(-50%);
                    font-family: "Poiret One", cursive;
                    font-size: 1.4rem;
                    color: hsla(280, 95%, 85%, 0.8);
                    text-shadow: 0 0 15px hsla(280, 95%, 85%, 0.8);
                    z-index: 5;
                    pointer-events: none;
                    opacity: 0;
                    animation: floatUpEnhanced 5s ease-out forwards;
                `;

                document.body.appendChild(floatingText);

                // Create floating text shine effect
                this.createFloatingTextShine(floatingText);

                // Enhanced CSS animation
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes floatUpEnhanced {
                        0% { 
                            opacity: 0; 
                            transform: translateX(-50%) translateY(0) scale(0.8);
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystical Fortune Cards - Ultimate Edition</title>
    
    <!-- Enhanced CDN Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;900&family=Cormorant+Garamond:wght@300;400;600&family=Poiret+One:wght@400&family=Uncial+Antiqua:wght@400&display=swap" rel="stylesheet">
    
    <!-- Meta Tags for SEO and Social -->
    <meta name="description" content="Experience the ultimate mystical fortune cards with stunning 3D effects, magical animations, and personalized cosmic insights.">
    <meta name="keywords" content="fortune cards, mystical, tarot, spiritual, fortune telling, magic, cosmic">
    <meta property="og:title" content="Mystical Fortune Cards - Ultimate Edition">
    <meta property="og:description" content="Discover your cosmic destiny with stunning 3D mystical fortune cards">
    <meta property="og:type" content="website">
    
    <style>
        :root {
            --bg-color: #0a0618;
            --bg-gradient: linear-gradient(135deg, #0a0618 0%, #1a0b2e 30%, #16213e 60%, #0f3460 100%);
            --primary-color: #9969ff;
            --secondary-color: #ff69a1;
            --tertiary-color: #69b4ff;
            --accent-color: #ffeb3b;
            --text-color: #ffffff;
            --card-back: linear-gradient(45deg, #4a0e77, #650d6d, #7b1fa2);
            --card-front: linear-gradient(135deg, #2b2f66, #1c1647, #3f2a5c);
            --card-hover: #764ba2;
            --glitter-color: rgba(255, 235, 59, 0.9);
            --shine-color: hsla(280, 95%, 85%, 0.8);
            --shadow-color: rgba(0, 0, 0, 0.8);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Cormorant Garamond", serif;
            background: var(--bg-gradient);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="8" fill="rgba(153,105,255,0.6)" stroke="rgba(255,255,255,0.8)" stroke-width="2"/></svg>'), auto;
        }

        /* Enhanced Background Effects */
        .cosmic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(153, 105, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(255, 105, 161, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(105, 180, 255, 0.05) 0%, transparent 50%);
            z-index: -1;
            animation: cosmicShift 20s ease-in-out infinite;
        }

        @keyframes cosmicShift {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        /* Enhanced Canvas Elements */
        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #shine-canvas { z-index: 1; }
        #particle-canvas { z-index: 2; }
        #glitter-canvas { z-index: 3; }
        #constellation-canvas { z-index: 4; }

        /* Enhanced Container */
        .container {
            width: 100%;
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 10;
        }

        /* Enhanced Header */
        header {
            text-align: center;
            margin-bottom: 4rem;
            position: relative;
            z-index: 11;
        }

        .magical-title {
            font-family: "Cinzel", serif;
            font-size: clamp(2.5rem, 8vw, 5rem);
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color), var(--tertiary-color), var(--accent-color));
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite, titlePulse 2s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(153, 105, 255, 0.6);
            position: relative;
            filter: drop-shadow(0 0 20px var(--shine-color));
        }

        .magical-title::before {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, var(--shine-color), transparent);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShimmer 3s ease-in-out infinite;
            opacity: 0.7;
        }

        @keyframes titleShimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes titlePulse {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 20px var(--shine-color)); }
            50% { filter: brightness(1.3) drop-shadow(0 0 30px var(--shine-color)); }
        }

        .subtitle {
            font-size: clamp(1.2rem, 3vw, 1.6rem);
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 2rem;
            animation: subtitleGlow 3s ease-in-out infinite;
            text-shadow: 0 0 10px var(--shine-color);
            font-style: italic;
        }

        @keyframes subtitleGlow {
            0%, 100% { 
                opacity: 0.8; 
                text-shadow: 0 0 10px var(--shine-color); 
            }
            50% { 
                opacity: 1; 
                text-shadow: 0 0 20px var(--shine-color); 
            }
        }

        /* Enhanced Energy Orb */
        .energy-orb {
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, var(--shine-color) 0%, rgba(255, 105, 161, 0.3) 40%, transparent 70%);
            border-radius: 50%;
            animation: energyPulse 5s ease-in-out infinite;
            filter: blur(3px);
        }

        .energy-orb::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 60%);
            border-radius: 50%;
            animation: innerOrb 3s ease-in-out infinite reverse;
        }

        @keyframes energyPulse {
            0%, 100% { 
                transform: translateX(-50%) scale(1); 
                opacity: 0.4; 
                filter: blur(3px);
            }
            50% { 
                transform: translateX(-50%) scale(1.8); 
                opacity: 0.8; 
                filter: blur(2px);
            }
        }

        @keyframes innerOrb {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        /* Enhanced Floating Symbols */
        .mystical-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .floating-symbol {
            position: absolute;
            font-size: 3rem;
            opacity: 0.3;
            animation: float 12s ease-in-out infinite;
            text-shadow: 0 0 20px var(--shine-color);
            filter: drop-shadow(0 0 15px var(--shine-color));
            transition: all 0.3s ease;
        }

        .floating-symbol:nth-child(odd) {
            animation-direction: reverse;
        }

        .floating-symbol:hover {
            transform: scale(1.5) rotate(180deg);
            opacity: 0.8;
            text-shadow: 0 0 30px var(--shine-color);
        }

        /* Enhanced floating positions */
        .floating-symbol:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
        .floating-symbol:nth-child(2) { top: 20%; right: 15%; animation-delay: -2s; }
        .floating-symbol:nth-child(3) { bottom: 30%; left: 20%; animation-delay: -4s; }
        .floating-symbol:nth-child(4) { bottom: 20%; right: 10%; animation-delay: -1s; }
        .floating-symbol:nth-child(5) { top: 50%; left: 5%; animation-delay: -3s; }
        .floating-symbol:nth-child(6) { top: 70%; right: 25%; animation-delay: -5s; }
        .floating-symbol:nth-child(7) { top: 30%; left: 50%; animation-delay: -6s; }
        .floating-symbol:nth-child(8) { bottom: 60%; right: 50%; animation-delay: -7s; }

        @keyframes float {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg) scale(1); 
                opacity: 0.3;
            }
            25% { 
                transform: translateY(-40px) rotate(90deg) scale(1.1); 
                opacity: 0.5;
            }
            50% { 
                transform: translateY(-20px) rotate(180deg) scale(0.9); 
                opacity: 0.7;
            }
            75% { 
                transform: translateY(-30px) rotate(270deg) scale(1.05); 
                opacity: 0.4;
            }
        }

        /* Enhanced Control Panel */
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 1000;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 15px 35px var(--shadow-color);
        }

        .control-btn {
            background: transparent
        .control-btn {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 0.8rem;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--primary-color);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
            z-index: -1;
        }

        .control-btn:hover::before {
            width: 100%;
            height: 100%;
        }

        .control-btn:hover {
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--primary-color);
        }

        .control-btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 0 15px var(--primary-color);
        }

        /* Enhanced Settings Panel */
        .settings-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 15px 35px var(--shadow-color);
            z-index: 1000;
            transform: translateX(-100%);
            transition: transform 0.4s ease;
            min-width: 280px;
        }

        .settings-panel.open {
            transform: translateX(0);
        }

        .settings-title {
            font-family: "Cinzel", serif;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
            color: var(--accent-color);
            text-shadow: 0 0 10px var(--shine-color);
        }

        .setting-group {
            margin-bottom: 1.5rem;
        }

        .setting-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .setting-slider {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .setting-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px var(--primary-color);
        }

        .setting-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px var(--primary-color);
        }

        .setting-toggle {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--primary-color);
        }

        .toggle-switch.active::before {
            left: 33px;
        }

        /* Enhanced Card Selection */
        .card-selection {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin-bottom: 4rem;
            z-index: 11;
            position: relative;
            flex-wrap: wrap;
        }

        .mystical-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 1.5rem 3rem;
            font-family: "Cinzel", serif;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 25px rgba(153, 105, 255, 0.4);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .mystical-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, var(--shine-color), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }

        .mystical-btn:hover::before {
            animation: shimmer 1s ease-in-out;
        }

        .mystical-btn:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 40px rgba(153, 105, 255, 0.6);
            filter: drop-shadow(0 0 15px var(--shine-color));
        }

        .mystical-btn:active {
            transform: translateY(-4px) scale(1.02);
        }

        .mystical-btn.secondary {
            background: linear-gradient(45deg, var(--tertiary-color), var(--accent-color));
            box-shadow: 0 10px 25px rgba(105, 180, 255, 0.4);
        }

        .mystical-btn.secondary:hover {
            box-shadow: 0 20px 40px rgba(105, 180, 255, 0.6);
        }

        .mystical-btn.danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.4);
        }

        .mystical-btn.danger:hover {
            box-shadow: 0 20px 40px rgba(255, 107, 107, 0.6);
        }

        @keyframes shimmer {
            0% { transform: translateX(-200%) translateY(-200%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(200%) translateY(200%) rotate(45deg); opacity: 0; }
        }

        /* Enhanced Card Stats */
        .card-stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            min-width: 120px;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px var(--shadow-color);
        }

        .stat-number {
            font-family: "Cinzel", serif;
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-color);
            text-shadow: 0 0 15px var(--shine-color);
            animation: countGlow 2s ease-in-out infinite;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @keyframes countGlow {
            0%, 100% { 
                filter: brightness(1);
                text-shadow: 0 0 15px var(--shine-color);
            }
            50% { 
                filter: brightness(1.5);
                text-shadow: 0 0 25px var(--shine-color);
            }
        }

        /* Enhanced Card Table */
        .card-table {
            perspective: 2000px;
            margin-bottom: 4rem;
            min-height: 600px;
            z-index: 11;
            position: relative;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 3rem;
            max-width: 1400px;
            margin: 0 auto;
            padding: 4rem 2rem;
        }

        .card {
            width: 200px;
            height: 350px;
            position: relative;
            transform-style: preserve-3d;
            transition: all 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            filter: brightness(0.9);
            justify-self: center;
            border-radius: 25px;
        }

        .card:hover {
            filter: brightness(1.4) drop-shadow(0 0 30px var(--shine-color));
            transform: translateY(-30px) rotateY(25deg) scale(1.1);
        }

        .card.selected {
            transform: scale(1.3) translateY(-40px) rotateY(0deg);
            z-index: 100;
            filter: drop-shadow(0 0 40px var(--shine-color)) brightness(1.5);
        }

        .card.flipped {
            transform: rotateY(180deg);
            pointer-events: none;
        }

        /* Enhanced Card Rarity System */
        .card.common {
            --card-rarity-color: rgba(200, 200, 200, 0.4);
            --card-rarity-glow: rgba(200, 200, 200, 0.2);
        }

        .card.uncommon {
            --card-rarity-color: rgba(76, 175, 80, 0.5);
            --card-rarity-glow: rgba(76, 175, 80, 0.3);
        }

        .card.rare {
            --card-rarity-color: rgba(63, 81, 181, 0.6);
            --card-rarity-glow: rgba(63, 81, 181, 0.4);
        }

        .card.epic {
            --card-rarity-color: rgba(156, 39, 176, 0.7);
            --card-rarity-glow: rgba(156, 39, 176, 0.5);
        }

        .card.legendary {
            --card-rarity-color: var(--shine-color);
            --card-rarity-glow: var(--shine-color);
            animation: legendaryAura 4s ease-in-out infinite;
        }

        .card.mythic {
            --card-rarity-color: rgba(255, 215, 0, 0.9);
            --card-rarity-glow: rgba(255, 215, 0, 0.7);
            animation: mythicAura 3s ease-in-out infinite;
        }

        @keyframes legendaryAura {
            0%, 100% { 
                box-shadow: 0 0 20px var(--card-rarity-glow);
                filter: brightness(0.9);
            }
            50% { 
                box-shadow: 0 0 50px var(--card-rarity-glow);
                filter: brightness(1.2);
            }
        }

        @keyframes mythicAura {
            0%, 100% { 
                box-shadow: 0 0 30px var(--card-rarity-glow);
                filter: brightness(1) hue-rotate(0deg);
            }
            33% { 
                box-shadow: 0 0 60px var(--card-rarity-glow);
                filter: brightness(1.3) hue-rotate(120deg);
            }
            66% { 
                box-shadow: 0 0 45px var(--card-rarity-glow);
                filter: brightness(1.1) hue-rotate(240deg);
            }
        }

        /* Enhanced Card Faces */
        .card-face {
            width: 100%;
            height: 100%;
            position: absolute;
            backface-visibility: hidden;
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 25px 50px var(--shadow-color);
            overflow: hidden;
        }

        .card-back {
            background: var(--card-back);
            border: 3px solid var(--card-rarity-color);
            position: relative;
        }

        .card-back::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 85%;
            height: 85%;
            background: radial-gradient(circle, var(--card-rarity-color) 0%, transparent 70%);
            border-radius: 50%;
            animation: innerGlow 4s ease-in-out infinite;
        }

        .card-back::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(45deg, var(--shine-color) 0, var(--shine-color) 1px, transparent 1px, transparent 20px),
                repeating-linear-gradient(-45deg, rgba(255, 255, 255, 0.05) 0, rgba(255, 255, 255, 0.05) 1px, transparent 1px, transparent 20px);
            border-radius: 25px;
            animation: patternShift 15s linear infinite;
            opacity: 0.4;
        }

        @keyframes innerGlow {
            0%, 100% { 
                opacity: 0.5; 
                transform: translate(-50%, -50%) scale(1); 
            }
            50% { 
                opacity: 0.9; 
                transform: translate(-50%, -50%) scale(1.4); 
            }
        }

        @keyframes patternShift {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 40px 40px, -40px -40px; }
        }

        .card-front {
            background: var(--card-front);
            transform: rotateY(180deg);
            padding: 2rem;
            text-align: center;
            border: 3px solid var(--card-rarity-color);
            position: relative;
        }

        .card-front::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--card-rarity-glow) 0%, transparent 50%);
            border-radius: 25px;
            opacity: 0.3;
        }

        /* Enhanced Card Content */
        .card-symbol {
            font-size: 4.5rem;
            margin-bottom: 1.5rem;
            opacity: 0.95;
            animation: symbolGlow 3s ease-in-out infinite;
            filter: drop-shadow(0 0 20px var(--shine-color));
            position: relative;
            z-index: 2;
        }

        @keyframes symbolGlow {
            0%, 100% { 
                text-shadow: 0 0 20px var(--shine-color); 
                transform: scale(1) rotate(0deg);
            }
            50% { 
                text-shadow: 0 0 40px var(--shine-color); 
                transform: scale(1.1) rotate(5deg);
            }
        }

        .card-title {
            font-family: "Cinzel", serif;
            font-size: 1.7rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShimmer 2s ease-in-out infinite;
            text-shadow: 0 0 15px var(--shine-color);
            position: relative;
            z-index: 2;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        @keyframes titleShimmer {
            0%, 100% { 
                filter: brightness(1);
                text-shadow: 0 0 15px var(--shine-color);
            }
            50% { 
                filter: brightness(1.5);
                text-shadow: 0 0 25px var(--shine-color);
            }
        }

        .card-desc {
            font-size: 1.2
        .card-desc {
            font-size: 1.2rem;
            opacity: 0.9;
            line-height: 1.6;
            font-style: italic;
            text-shadow: 0 0 8px var(--shine-color);
            position: relative;
            z-index: 2;
            margin-bottom: 1rem;
        }

        .card-rarity-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--card-rarity-color);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 10px var(--card-rarity-glow);
            z-index: 3;
        }

        .card-element {
            position: absolute;
            bottom: 15px;
            left: 15px;
            font-size: 1.5rem;
            opacity: 0.7;
            z-index: 3;
        }

        /* Enhanced Fortune Display */
        .message-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.6s ease;
            z-index: 2000;
        }

        .message-container.visible {
            opacity: 1;
            pointer-events: all;
        }

        .message-card {
            width: 95%;
            max-width: 900px;
            background: rgba(15, 10, 30, 0.95);
            backdrop-filter: blur(25px);
            padding: 4rem;
            border-radius: 35px;
            border: 3px solid var(--shine-color);
            text-align: center;
            box-shadow: 0 30px 80px var(--shadow-color);
            transform: translateY(100px) scale(0.8);
            opacity: 0;
            transition: all 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }

        .message-card::before {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: radial-gradient(circle, var(--shine-color) 0%, transparent 70%);
            animation: cardAura 6s ease-in-out infinite;
            opacity: 0.15;
        }

        @keyframes cardAura {
            0%, 100% { 
                opacity: 0.1; 
                transform: rotate(0deg) scale(1); 
            }
            50% { 
                opacity: 0.3; 
                transform: rotate(180deg) scale(1.2); 
            }
        }

        .message-container.visible .message-card {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .card-reveal-animation {
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            z-index: 1;
        }

        .cosmic-circle {
            width: 100%;
            height: 100%;
            border: 4px solid var(--shine-color);
            border-radius: 50%;
            animation: cosmicSpin 4s linear infinite;
            position: relative;
            box-shadow: 0 0 30px var(--shine-color);
        }

        .cosmic-circle::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            border: 2px solid rgba(255, 105, 161, 0.5);
            border-radius: 50%;
            animation: cosmicSpin 3s linear infinite reverse;
        }

        .cosmic-circle::after {
            content: '';
            position: absolute;
            top: 30px;
            left: 30px;
            right: 30px;
            bottom: 30px;
            border: 1px solid rgba(105, 180, 255, 0.3);
            border-radius: 50%;
            animation: cosmicSpin 2s linear infinite;
        }

        @keyframes cosmicSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .message-content {
            margin-top: 5rem;
            position: relative;
            z-index: 2;
        }

        .message-title {
            font-family: "Cinzel", serif;
            font-size: clamp(2rem, 6vw, 3.5rem);
            margin-bottom: 2rem;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color), var(--tertiary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShimmer 2s ease-in-out infinite;
            text-shadow: 0 0 25px var(--shine-color);
            filter: drop-shadow(0 0 20px var(--shine-color));
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .message-text {
            font-size: clamp(1.4rem, 4vw, 2rem);
            line-height: 1.8;
            margin-bottom: 2rem;
            opacity: 0.95;
            animation: textGlow 3s ease-in-out infinite;
            font-style: italic;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        @keyframes textGlow {
            0%, 100% { 
                text-shadow: 0 0 15px var(--shine-color); 
                opacity: 0.9;
            }
            50% { 
                text-shadow: 0 0 25px var(--shine-color); 
                opacity: 1;
            }
        }

        .fortune-details {
            font-size: 1.4rem;
            opacity: 0.8;
            margin-bottom: 3rem;
            font-style: italic;
            color: var(--accent-color);
            animation: detailsPulse 4s ease-in-out infinite;
            text-shadow: 0 0 12px var(--shine-color);
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes detailsPulse {
            0%, 100% { 
                opacity: 0.7; 
                transform: scale(1);
            }
            50% { 
                opacity: 1; 
                transform: scale(1.02);
            }
        }

        .message-actions {
            display: flex;
            gap: 2rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        /* Enhanced Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 2.5rem;
            border-radius: 20px;
            font-family: "Cinzel", serif;
            z-index: 10000;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            border: 2px solid var(--shine-color);
            min-width: 300px;
            backdrop-filter: blur(15px);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-icon {
            font-size: 1.5
        .notification-icon {
            font-size: 1.5rem;
            animation: notificationPulse 2s ease-in-out infinite;
        }

        @keyframes notificationPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .notification-text {
            flex: 1;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .notification-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Enhanced Progress Bar */
        .progress-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            padding: 1rem 2rem;
            min-width: 300px;
            z-index: 1000;
        }

        .progress-label {
            text-align: center;
            margin-bottom: 0.5rem;
            font-family: "Cinzel", serif;
            font-size: 1.1rem;
            color: var(--accent-color);
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--tertiary-color));
            background-size: 200% 100%;
            border-radius: 5px;
            transition: width 0.3s ease;
            animation: progressShine 2s linear infinite;
        }

        @keyframes progressShine {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Enhanced Loading Animation */
        .loading-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5000;
            flex-direction: column;
            gap: 2rem;
        }

        .loading-spinner {
            width: 120px;
            height: 120px;
            border: 6px solid rgba(153, 105, 255, 0.3);
            border-top: 6px solid var(--shine-color);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            box-shadow: 0 0 40px var(--shine-color);
            position: relative;
        }

        .loading-spinner::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 3px solid rgba(255, 105, 161, 0.3);
            border-top: 3px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite reverse;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-family: "Cinzel", serif;
            font-size: 1.5rem;
            color: var(--accent-color);
            animation: loadingPulse 2s ease-in-out infinite;
            text-shadow: 0 0 20px var(--shine-color);
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* Enhanced Footer */
        footer {
            text-align: center;
            margin-top: 6rem;
            padding: 3rem 0;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-top: 1px solid var(--glass-border);
            position: relative;
            z-index: 11;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .mystical-quote {
            font-family: "Poiret One", cursive;
            font-style: italic;
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 2rem;
            animation: quoteFade 5s ease-in-out infinite;
            text-shadow: 0 0 20px var(--shine-color);
        }

        @keyframes quoteFade {
            0%, 100% { 
                opacity: 0.7;
                text-shadow: 0 0 15px var(--shine-color);
            }
            50% { 
                opacity: 1;
                text-shadow: 0 0 30px var(--shine-color);
            }
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .footer-link {
            color: var(--text-color);
            text-decoration: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
            font-family: "Cinzel", serif;
            font-size: 1rem;
        }

        .footer-link:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(153, 105, 255, 0.3);
        }

        /* Enhanced Responsive Design */
        @media (max-width: 1200px) {
            .cards-container {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 2.5rem;
            }
        }

        @media (max-width: 768px) {
            .magical-title {
                font-size: 2.5rem;
            }
            
            .cards-container {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 2rem;
                padding: 2rem 1rem;
            }
            
            .card {
                width: 150px;
                height: 260px;
            }
            
            .card-symbol {
                font-size: 3rem;
            }
            
            .card-title {
                font-size: 1.2rem;
            }
            
            .card-desc {
                font-size: 1rem;
            }
            
            .message-card {
                padding: 2rem;
                margin: 1rem;
            }
            
            .mystical-btn {
                padding: 1rem 2rem;
                font-size: 1rem;
            }
            
            .control-panel {
                top: 10px;
                right: 10px;
                padding: 1rem;
            }
            
            .settings-panel {
                top: 10px;
                left: 10px;
                min-width: 250px;
            }
            
            .card-stats {
                gap: 1rem;
            }
            
            .footer-links {
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 1rem;
            }
            
            .cards-container {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 1.5rem;
            }
            
            .card {
                width: 120px;
                height: 200px;
            }
            
            .card-symbol {
                font-size: 2.5rem;
            }
            
            .card-title {
                font-size: 1rem;
            }
            
            .card-desc {
                font-size: 0.9rem;
            }
            
            .message-card {
                padding: 1.5rem;
            }
            
            .control-panel {
                position: static;
                margin: 1rem auto;
                flex-direction: row;
                justify-content: center;
            }
            
            .settings-panel {
                position: static;
                transform: none;
                margin: 1rem auto;
                min-width: auto;
                width: 100%;
            }
        }

        /* Enhanced Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Enhanced Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #000000;
                --text-color: #ffffff;
                --glass-bg: rgba(255, 255, 255, 0.05);
                --glass-border: rgba(255, 255, 255, 0.15);
            }
        }

        /* Enhanced Print Styles */
        @media print {
            .control-panel,
            .settings-panel,
            .loading-animation,
            .notification,
            .progress-container,
            canvas {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .card {
                break-inside: avoid;
            }
        }

        /* Enhanced Focus Styles */
        .mystical-btn:focus,
        .control-btn:focus,
        .toggle-switch:focus,
        .setting-slider:focus {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }

        /* Enhanced Selection Styles */
        ::selection {
            background: var(--primary-color);
            color: white;
        }

        ::-moz-selection {
            background: var(--primary-color);
            color: white;
        }

        /* Enhanced Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
    </style>
</head>
<body>
    <!-- Enhanced Canvas Elements -->
    <canvas id="shine-canvas"></canvas>
    <canvas id="particle-canvas"></canvas>
    <canvas id="glitter-canvas"></canvas>
    <canvas id="constellation-canvas"></canvas>
    
    <!-- Enhanced Background -->
    <div class="cosmic-bg"></div>
    
    <!-- Loading Animation -->
    <div class="loading-animation" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Channeling cosmic energies...</div>
    </div>
    
    <!-- Enhanced Floating Symbols -->
    <div class="mystical-bg">
        <div class="floating-symbol animate__animated animate__fadeInUp">✨</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-1s">🌙</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-2s">⭐</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-3s">🔮</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-4s">🌟</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-5s">💫</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-6s">🦋</div>
        <div class="floating-symbol animate__animated animate__fadeInUp animate__delay-7s">🌈</div>
    </div>

    <!-- Enhanced Control Panel -->
    <div class="control-panel">
        <button class="control-btn" id="settings
        <button class="control-btn" id="settingsBtn" title="Settings (S)" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>
        <button class="control-btn" id="soundBtn" title="Toggle Sound (M)" aria-label="Toggle Sound">
            <i class="fas fa-volume-up"></i>
        </button>
        <button class="control-btn" id="fullscreenBtn" title="Fullscreen (F)" aria-label="Toggle Fullscreen">
            <i class="fas fa-expand"></i>
        </button>
        <button class="control-btn" id="themeBtn" title="Toggle Theme (T)" aria-label="Toggle Theme">
            <i class="fas fa-palette"></i>
        </button>
        <button class="control-btn" id="helpBtn" title="Help (H)" aria-label="Show Help">
            <i class="fas fa-question"></i>
        </button>
        <button class="control-btn" id="shareBtn" title="Share (P)" aria-label="Share Fortune">
            <i class="fas fa-share-alt"></i>
        </button>
    </div>

    <!-- Enhanced Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-title">Mystical Settings</div>
        
        <div class="setting-group">
            <label class="setting-label">Particle Density</label>
            <input type="range" class="setting-slider" id="particleDensity" min="1" max="10" value="5">
        </div>
        
        <div class="setting-group">
            <label class="setting-label">Animation Speed</label>
            <input type="range" class="setting-slider" id="animationSpeed" min="0.5" max="3" step="0.1" value="1">
        </div>
        
        <div class="setting-group">
            <label class="setting-label">Glow Intensity</label>
            <input type="range" class="setting-slider" id="glowIntensity" min="0.1" max="2" step="0.1" value="1">
        </div>
        
        <div class="setting-group">
            <div class="setting-toggle">
                <span class="setting-label">Auto-Shuffle</span>
                <div class="toggle-switch" id="autoShuffle"></div>
            </div>
        </div>
        
        <div class="setting-group">
            <div class="setting-toggle">
                <span class="setting-label">Particle Effects</span>
                <div class="toggle-switch active" id="particleEffects"></div>
            </div>
        </div>
        
        <div class="setting-group">
            <div class="setting-toggle">
                <span class="setting-label">Screen Shake</span>
                <div class="toggle-switch" id="screenShake"></div>
            </div>
        </div>
        
        <div class="setting-group">
            <button class="mystical-btn" id="resetSettings">Reset to Default</button>
        </div>
    </div>

    <!-- Enhanced Main Container -->
    <div class="container">
        <!-- Enhanced Header -->
        <header class="animate__animated animate__fadeInDown">
            <div class="energy-orb"></div>
            <h1 class="magical-title" data-text="Mystical Fortune Cards">
                Mystical Fortune Cards
            </h1>
            <p class="subtitle animate__animated animate__fadeInUp animate__delay-1s">
                Discover your cosmic destiny through the ancient art of divination. 
                Each card holds the power to reveal hidden truths and guide your spiritual journey.
            </p>
        </header>

        <!-- Enhanced Stats -->
        <div class="card-stats animate__animated animate__fadeInUp animate__delay-2s">
            <div class="stat-item">
                <div class="stat-number" id="totalDraws">0</div>
                <div class="stat-label">Total Draws</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="rareCards">0</div>
                <div class="stat-label">Rare Cards</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="luckScore">0</div>
                <div class="stat-label">Luck Score</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="streakCount">0</div>
                <div class="stat-label">Current Streak</div>
            </div>
        </div>

        <!-- Enhanced Card Selection -->
        <div class="card-selection animate__animated animate__fadeInUp animate__delay-3s">
            <button class="mystical-btn" id="drawCard" onclick="drawCard()">
                <i class="fas fa-magic"></i> Draw Your Fortune
            </button>
            <button class="mystical-btn secondary" id="shuffleCards" onclick="shuffleCards()">
                <i class="fas fa-random"></i> Shuffle Deck
            </button>
            <button class="mystical-btn" id="drawThree" onclick="drawThreeCards()">
                <i class="fas fa-star"></i> Three Card Reading
            </button>
            <button class="mystical-btn danger" id="clearHistory" onclick="clearHistory()">
                <i class="fas fa-trash"></i> Clear History
            </button>
        </div>

        <!-- Enhanced Progress Bar -->
        <div class="progress-container" id="progressContainer" style="display: none;">
            <div class="progress-label">Mystical Energy</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- Enhanced Card Table -->
        <div class="card-table">
            <div class="cards-container" id="cardContainer">
                <!-- Cards will be generated dynamically -->
            </div>
        </div>

        <!-- Enhanced Footer -->
        <footer class="animate__animated animate__fadeInUp animate__delay-4s">
            <div class="footer-content">
                <div class="mystical-quote" id="mysticalQuote">
                    "The universe speaks to those who listen with their hearts."
                </div>
                <div class="footer-links">
                    <a href="#" class="footer-link" onclick="showAbout()">About</a>
                    <a href="#" class="footer-link" onclick="showHelp()">Help</a>
                    <a href="#" class="footer-link" onclick="showCredits()">Credits</a>
                    <a href="#" class="footer-link" onclick="contact()">Contact</a>
                </div>
                <p>&copy; 2024 Mystical Fortune Cards. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Enhanced Fortune Message Display -->
    <div class="message-container" id="messageContainer">
        <div class="message-card animate__animated animate__zoomIn">
            <div class="card-reveal-animation">
                <div class="cosmic-circle"></div>
            </div>
            <div class="message-content">
                <h2 class="message-title" id="messageTitle">Your Fortune</h2>
                <p class="message-text" id="messageText">The cards have spoken...</p>
                <div class="fortune-details" id="fortuneDetails">
                    Additional insights will appear here...
                </div>
                <div class="message-actions">
                    <button class="mystical-btn" onclick="saveReading()">
                        <i class="fas fa-save"></i> Save Reading
                    </button>
                    <button class="mystical-btn secondary" onclick="shareReading()">
                        <i class="fas fa-share"></i> Share
                    </button>
                    <button class="mystical-btn" onclick="drawAnother()">
                        <i class="fas fa-redo"></i> Draw Another
                    </button>
                    <button class="mystical-btn danger" onclick="closeMessage()">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced JavaScript -->
    <script>
        class UltimateEnhancedMysticalCards {
            constructor() {
                this.initializeApp();
                this.setupEventListeners();
                this.initializeCanvas();
                this.initializeSettings();
                this.initializeStats();
                this.initializeAudio();
                this.startAnimations();
                this.preloadResources();
            }

            initializeApp() {
                // Enhanced card data with more detailed information
                this.cards = [
                    {
                        title: "The Cosmic Dreamer",
                        symbol: "🌌",
                        desc: "Dreams manifest into reality through cosmic alignment",
                        fortune: "Your deepest aspirations are aligning with universal forces. The cosmos whispers secrets of manifestation to those who dare to dream beyond the veil of ordinary perception.",
                        rarity: "legendary",
                        element: "🌠",
                        power: 95,
                        wisdom: "Dreams are the language of the soul",
                        guidance: "Trust in your visions, for they are messages from your higher self"
                    },
                    {
                        title: "The Time Weaver",
                        symbol: "⏳",
                        desc: "Past, present, and future converge in this moment",
                        fortune: "The threads of time are weaving a tapestry of opportunity around you. What seemed lost in the past is returning in a new form, bringing wisdom and renewed purpose.",
                        rarity: "mythic",
                        element: "⚡",
                        power: 98,
                        wisdom: "Time is a river that flows in all directions",
                        guidance: "Embrace the lessons of the past while stepping boldly into your future"
                    },
                    {
                        title: "The Soul's Mirror",
                        symbol: "🪞",
                        desc: "Reflection reveals the truth within",
                        fortune: "Look deeper than the surface, for your soul's mirror reflects not just who you are, but who you are becoming. The person you seek to be already exists within you.",
                        rarity: "rare",
                        element: "💎",
                        power: 87,
                        wisdom: "The outer world reflects your inner state",
                        guidance: "Change your perception, and you change your reality"
                    },
                    {
                        title: "The Phoenix Rising",
                        symbol: "🔥",
                        desc: "From ashes of the old, new life emerges",
                        fortune: "Like the phoenix, you are being reborn from the ashes of what no longer serves you. This transformation, though challenging, leads to unprecedented growth and power.",
                        rarity: "epic",
                        element: "🔥",
                        power: 92,
                        wisdom: "Destruction is the beginning of creation",
                        guidance: "Embrace the fire of change, for it purifies and strengthens"
                    },
                    {
                        title: "The Infinite Path",
                        symbol: "♾️",
                        desc: "Every ending is a new beginning",
                        fortune: "Your journey has no true end, only transformation. Each step you take creates new pathways of possibility, extending infinitely into realms of potential you have yet to explore.",
                        rarity: "legendary",
                        element: "🌈",
                        power: 94,
                        wisdom: "The path itself is the destination",
                        guidance: "Trust the journey, for it knows where you need to go"
                    },
                    {
                        title: "The Quantum Heart",
                        symbol: "💖",
                        desc: "Love transcends all dimensions",
                        fortune: "Your heart operates on quantum principles, capable of love that transcends time and space. The connections you make now will ripple through eternity, creating bonds that cannot be broken.",
                        rarity: "mythic",
                        element: "💫",
                        power: 99,
                        wisdom: "Love is the force that binds the universe",
                        guidance: "Lead with your heart, for it knows truths your mind cannot comprehend"
                    },
                    {
                        title: "The Stellar Navigator",
                        symbol: "🧭",
                        desc: "Stars guide those who seek their light",
                        fortune: "The stars have aligned to provide you with clear direction. Your internal compass is perfectly calibrated to navigate the cosmic currents that will carry you to your destiny.",
                        rarity: "rare",
                        element: "⭐",
                        power: 88,
                        wisdom: "Direction comes from within",
                        guidance: "Trust your inner navigation system"
                    },
                    {
                        title: "The Crystal Oracle",
                        symbol: "🔮",
                        desc: "Clarity emerges from the crystal's depths",
                        fortune: "The mists of confusion are clearing, revealing crystal-clear insights about your path. Your intuitive abilities are heightened, allowing you to perceive truth with unprecedented clarity.",
                        rarity: "epic",
                        element: "💎",
                        power: 90,
                        wisdom: "Clarity is the gift of stillness",
                        guidance: "Quiet your mind to hear the whispers of wisdom"
                    },
                    {
                        title: "The Lunar Mystic",
                        symbol: "🌙",
                        desc: "Moon cycles bring transformation and insight",
                        fortune: "The lunar energies are particularly strong around you, bringing heightened intuition and emotional healing. Your psychic abilities are amplified during this powerful moon phase.",
                        rarity: "uncommon",
                        element: "🌙",
                        power: 75,
                        wisdom: "The moon reflects the light of consciousness",
                        guidance: "Honor your cycles and trust your intuition"
                    },
                    {
                        title: "The Solar Warrior",
                        symbol: "☀️",
                        desc: "Inner fire illuminates the path to victory",
                        fortune: "Your inner sun is blazing with confidence and power. Now is the time to step into your full strength and illuminate the darkness with your radiant energy and unwavering determination.",
                        rarity: "epic",
                        element: "☀️",
                        power: 93,
                        wisdom: "Strength comes from inner light",
                        guidance: "Shine your light boldly and fearlessly"
                    },
                    {
                        title: "The Ethereal Dancer",
                        symbol: "🦋",
                        desc: "Grace and transformation flow as one",
                        fortune: "Like a butterfly emerging from its chrysalis, you are experiencing a beautiful transformation. Your grace and elegance are attracting positive energies and opening new doors.",
                        rarity: "uncommon",
                        element: "🌸",
                        power: 78,
                        wisdom: "Transformation is a dance, not a battle",
                        guidance: "Move with grace through all changes"
                    },
                    {
                        title: "The Void Walker",
                        symbol: "🌑",
                        desc: "From emptiness comes infinite possibility",
                        fortune: "You are being called to embrace the void, the space between thoughts where infinite possibility resides. In this sacred emptiness, you will find the seeds of your greatest creations.",
                        rarity: "legendary",
                        element: "🌌",
                        power: 96,
                        wisdom: "The void is not empty, but full of potential",
                        guidance: "Do not fear the unknown, for it is where magic happens"
                    },
                    {
                        title: "The Harmony Keeper",
                        symbol: "🎵",
                        desc: "Universal music guides your steps",
                        fortune: "You are attuned to the cosmic symphony, able to hear the music of the spheres. Your life is coming into perfect harmony, with all elements working together in beautiful synchronicity.",
                        rarity: "rare",
                        element: "🎼",
                        power: 85,
                        wisdom: "Life is a song waiting to be sung",
                        guidance: "Listen to the rhythm of your heart"
                    },
                    {
                        title: "The Wisdom Keeper",
                        symbol: "📚",
                        desc: "Ancient knowledge awakens within",
                        fortune: "The wisdom of ages flows through you now. You are remembering knowledge that transcends this lifetime, accessing the akashic records of universal truth and understanding.",
                        rarity: "epic",
                        element: "📜",
                        power: 89,
                        wisdom: "All knowledge exists within you",
                        guidance: "Trust the wisdom that emerges from stillness"
                    },
                    {
                        title: "The Rainbow Bridge",
                        symbol: "🌈",
                        desc: "Connection between earthly and divine",
                        fortune: "You are serving as a bridge between different worlds, helping others find their way to higher understanding. Your unique perspective brings healing and unity to divided energies.",
                        rarity: "uncommon",
                        element: "🌈",
                        power: 80,
                        wisdom: "Bridges are built with love and understanding",
                        guidance: "Be the connection that others need"
                    },
                    {
                        title: "The Eternal Flame",
                        symbol: "🕯️",
                        desc: "Inner light never dims",
                        fortune: "Your inner flame burns eternal, a beacon of hope in times of darkness. This light within you is indestructible, growing stronger with each challenge you overcome.",
                        rarity: "legendary",
                        element: "🔥",
                        power: 97,
                        wisdom: "The flame of spirit cannot be extinguished",
                        guidance: "Keep your inner light burning bright"
                    }
                ];

                // Enhanced settings
                this.settings = {
                    particleDensity: 5,
                    animationSpeed: 1,
                    glowIntensity: 1,
                    autoShuffle: false,
                    particleEffects: true,
                    screenShake: false,
                    soundEnabled: true,
                    theme: 'cosmic',
                    difficulty: 'normal'
                };

                // Enhanced stats
                this.stats = {
                    totalDraws: 0,
                    rareCards: 0,
                    luckScore: 0,
                    streakCount: 0,
                    savedReadings: [],
                    achievements: [],
                    sessionStart: Date.now()
                };

                // Enhanced state management
                this.state = {
                    isCardSelected: false,
                    selectedCard: null,
                    isAnimating: false,
                    canDraw: true,
                    threeCardMode: false,
                    currentTheme: 'cosmic',
                    lastDrawTime: 0,
                    notifications: [],
                    achievements: new Set()
                };

                // Enhanced arrays for various effects
                this.particles = [];
                this.glitterParticles = [];
                this.shineParticles = [];
                this.constellationParticles = [];
                this.quotes = [
                    "The universe speaks to those who listen with their hearts.",
                    "In the tapestry of existence, every thread has meaning.",
                    "Stars align not by chance, but by cosmic design.",
                    "The wisdom of ages flows through the present moment.",
                    "Your destiny is written in the language of dreams.",
                    "Between breaths lies the space of infinite possibility.",
                    "The soul's journey transcends the boundaries of time.",
                    "In darkness, even the smallest light becomes a beacon."
                ];
            }

            setupEventListeners() {
                // Enhanced keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) return;
                    
                    switch(e.key.toLowerCase()) {
                        case ' ':
                        case 'enter':
                            e.preventDefault();
                            if (this.state.canDraw) this.drawCard();
                            break;
                        case 's':
                            e.preventDefault();
                            this.toggleSettings();
                            break;
                        case 'm':
                            e.preventDefault();
                            this.toggleSound();
                            break;
                        case 'f':
                            e.preventDefault();
                            this.toggleFullscreen();
                            break;
                        case 't':
                            e.preventDefault();
                            this.toggleTheme();
                            break;
                        case 'h':
                            e.preventDefault();
                            this.showHelp();
                            break;
                        case 'p':
                            e.preventDefault();
                            this.shareReading();
                            break;
                        case 'r':
                            e.preventDefault();
                            this.shuffleCards();
                            break;
                        case 'escape':
                            e.preventDefault();
                            this.closeMessage();
                            break;
                    }
                });

                // Enhanced mouse and touch events
                this.handleMouseMove = (e) => {
                    if (this.settings.particleEffects) {
                        this.createTrailParticles(e.clientX, e.clientY);
                    }
                };

                this.handleTouchMove = (e) => {
                    if (this.settings.particleEffects) {
                        const touch = e.touches[0];
                        this.createTrailParticles(touch.clientX, touch.clientY);
                    }
                };

                this.handleResize = () => {
                    this.resizeCanvas();
                };

                // Enhanced event listeners
                window.addEventListener('mousemove', this.handleMouseMove);
                window.addEventListener('touchmove', this.handleTouchMove);
                window.addEventListener('resize', this.handleResize);

                // Enhanced UI event listeners
                this.setupUIEventListeners();
            }

            setupUIEventListeners() {
                // Settings panel
                document.getElementById('settingsBtn').addEventListener('click', () => this.toggleSettings());
                document.getElementById('soundBtn').addEventListener('click', () => this.toggleSound());
                document.getElementById('fullscreenBtn').addEventListener('click', () => this.toggleFullscreen());
                document.getElementById('themeBtn').addEventListener('click', () => this.toggleTheme());
                document.getElementById('helpBtn').addEventListener('click', () => this.showHelp());
                document.getElementById('shareBtn').addEventListener('click', () => this.shareReading());

                // Settings controls
                document.getElementById('particleDensity').addEventListener('input', (e) => {
                    this.settings.particleDensity = parseInt(e.target.value);
                    this.updateParticleSystem();
                });

                document.getElementById('animationSpeed').addEventListener('input', (e) => {
                    this.settings.animationSpeed = parseFloat(e.target.value);
                    this.updateAnimationSpeed();
                });

                document.getElementById('glowIntensity').addEventListener('input', (e) => {
                    this.settings.glowIntensity = parseFloat(e.target.value);
                    this.updateGlowEffects();
                });

                // Toggle switches
                document.getElementById('autoShuffle').addEventListener('click', () => {
                    this.settings.autoShuffle = !this.settings.autoShuffle;
                    this.updateToggleSwitch('autoShuffle');
                    if (this.settings.autoShuffle) {
                        this.startAutoShuffle();
                    } else {
                        this.stopAutoShuffle();
                    }
                });

                document.getElementById('particleEffects').addEventListener('click', () => {
                    this.settings.particleEffects = !this.settings.particleEffects;
                    this.updateToggleSwitch('particleEffects');
                    this.updateParticleSystem();
                });

                document.getElementById('screenShake').addEventListener('click', () => {
                    this.settings.screenShake = !this.settings.screenShake;
                    this.updateToggleSwitch('screenShake');
                });

                document.getElementById('resetSettings').addEventListener('click', () => this.resetSettings());

                // Close settings when clicking outside
                document.addEventListener('click', (e) => {
                    const settingsPanel = document.getElementById('settingsPanel');
                    const settingsBtn = document.getElementById('settingsBtn');
                    if (!settingsPanel.contains(e.target) && !settingsBtn.contains(e.target)) {
                        settingsPanel.classList.remove('open');
                    }
                });

                // Message container close on backdrop click
                document.getElementById('messageContainer').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        this.closeMessage();
                    }
                });
            }

            initializeCanvas() {
                this.canvases = {
                    shine: document.getElementById('shine-canvas'),
                    particle: document.getElementById('particle-canvas'),
                    glitter: document.getElementById('glitter-canvas'),
                    constellation: document.getElementById('constellation-canvas')
                };

                this.contexts = {};
                Object.keys(this.canvases).forEach(key => {
                    this.contexts[key] = this.canvases[key].getContext('2d');
                });

                this.resizeCanvas();
                this.initializeConstellations();
            }

            resizeCanvas() {
                const width = window.innerWidth;
                const height = window.innerHeight;

                Object.values(this.canvases).forEach(canvas => {
                    canvas.width = width;
                    canvas.height = height;
                });
            }

            initializeConstellations() {
                // Create constellation pattern
                const numStars = 50;
                for (let i = 0; i < numStars; i++) {
                    this.constellationParticles.push({
                        x: Math.random() * window.innerWidth,
                        y: Math.random() * window.innerHeight,
                        radius: Math.random() * 2 + 1,
                        opacity: Math.random() * 0.5 + 0.3,
                        twinkleSpeed: Math.random() * 0.02 + 0.01,
                        connections: []
                    });
                }

                // Create connections between nearby stars
                this.constellationParticles.forEach((star, index) => {
                    this.constellationParticles.forEach((otherStar, otherIndex) => {
                        if (index !== otherIndex) {
                            const distance = Math.sqrt(
                                Math.pow(star.x - otherStar.x, 2) + 
                                Math.pow(star.y - otherStar.y, 2)
                            );
                            if (distance < 150 && star.connections.length < 3) {
                                star.connections.push(otherIndex);
                            }
                        }
                    });
                });
            }

            initializeSettings() {
                // Load saved settings
                const savedSettings = localStorage.getItem('mysticalCardsSettings');
                if (savedSettings) {
                    this.settings = { ...this.settings, ...JSON.parse(savedSettings) };
                }

                // Apply settings to UI
                document.getElementById('particleDensity').value = this.settings.particleDensity;
                document.getElementById('animationSpeed').value = this.settings.animationSpeed;
                document.getElementById('glowIntensity').value = this.settings.glowIntensity;
                
                this.updateToggleSwitch('autoShuffle');
                this.updateToggleSwitch('particleEffects');
                this.updateToggleSwitch('screenShake');
            }

            initializeStats() {
                // Load saved stats
                const savedStats = localStorage.getItem('mysticalCardsStats');
                if (savedStats) {
                    this.stats = { ...this.stats, ...JSON.parse(savedStats) };
                }

                this.updateStatsDisplay();
            }

            initializeAudio() {
                // Initialize Web Audio API for enhanced sound effects
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.masterGain = this.audioContext.createGain();
                    this.masterGain.connect(this.audioContext.destination);
                    this.masterGain.gain.value = this.settings.soundEnabled ? 0.3 : 0;
                } catch (error) {
                    console.log('Audio context not available');
                    this.audioContext = null;
                }
            }

            startAnimations() {
                this.animationFrame = requestAnimationFrame(() => this.animate());
                this.startAmbientEffects();
                this.startQuoteRotation();
                
                // Hide loading screen
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    document.body.style.overflow = 'auto';
                }, 2000);
            }

            preloadResources() {
                // Preload any additional resources
                this.createCards();
                this.initializeAchievements();
            }

            createCards() {
                const cardContainer = document.getElementById('cardContainer');
                cardContainer.innerHTML = '';

                this.cards.forEach((card, index) => {
                    const cardElement = this.createCardElement(card, index);
                    cardContainer.appendChild(cardElement);
                });
            }

            createCardElement(card, index) {
                const cardDiv = document.createElement('div');
                cardDiv.className = `card ${card.rarity}`;
                cardDiv.innerHTML = `
                    <div class="card-face card-back">
                        <div class="card-rarity-badge">${card.rarity}</div>
                        <div class="card-element">${card.element}</div>
                        <div class="card-symbol">🌟</div>
                    </div>
                    <div class="card-face card-front">
                        <div class="card-rarity-badge">${card.rarity}</div>
                        <div class="card-element">${card.element}</div>
                        <div class="card-symbol">${card.symbol}</div>
                        <div class="card-title">${card.title}</div>
                        <div class="card-desc">${card.desc}</div>
                    </div>
                `;

                cardDiv.addEventListener('click', () => this.selectCard(index));
                cardDiv.addEventListener('mouseenter', () => this.onCardHover(cardDiv));
                cardDiv.addEventListener('mouseleave', () => this.onCardLeave(cardDiv));

                return cardDiv;
            }

            // Enhanced card interaction methods
            selectCard(index) {
                if (this.state.isAnimating || !this.state.canDraw) return;

                this.state.isAnimating = true;
                this.state.selectedCard = index;
                this.state.isCardSelected = true;

                const card = this.cards[index];
                const cardElement = document.querySelectorAll('.card')[index];

                // Enhanced selection animation
                cardElement.classList.add('selected');
                this.createSelectionParticles(cardElement);
                
                if (this.settings.screenShake) {
                    this.createScreenShake();
                }

                // Play enhanced sound
                this.playEnhancedSound('cardSelect');

                // Reveal card after delay
                setTimeout(() => {
                    this.revealCard(card, cardElement);
                }, 1500);
            }

            revealCard(card, cardElement) {
                cardElement.classList.add('flipped');
                
                // Calculate luck and rarity bonuses
                const luckBonus = this.calculateLuckBonus(card);
                const rarityMultiplier = this.getRarityMultiplier(card.rarity);
                const powerScore = Math.floor(card.power * rarityMultiplier * luckBonus);

                // Update stats
                this.stats.totalDraws++;
                if (['rare', 'epic', 'legendary', 'mythic'].includes(card.rarity)) {
                    this.stats.rareCards++;
                }
                this.stats.luckScore += powerScore;
                this.updateStreakCount(card);

                // Check for achievements
                this.checkAchievements(card);

                // Show fortune message
                setTimeout(() => {
                    this.showFortuneMessage(card, powerScore);
                }, 1000);

                // Save stats
                this.saveStats();
            }

            showFortuneMessage(card, powerScore) {
                const messageContainer = document.getElementById('messageContainer');
                const messageTitle = document.getElementById('messageTitle');
                const messageText = document.getElementById('messageText');
                const fortuneDetails = document.getElementById('fortuneDetails');

                messageTitle.textContent = card.title;
                messageText.textContent = card.fortune;
                fortuneDetails.innerHTML = `
                    <div><strong>Wisdom:</strong> ${card.wisdom}</div>
                    <div><strong>Guidance:</strong> ${card.guidance}</div>
                    <div><strong>Power Level:</strong> ${powerScore}</div>
                    <div><strong>Rarity:</strong> ${card.rarity.toUpperCase()}</div>
                `;

                messageContainer.classList.add('visible');
                
                // Create message particles
                this.createMessageParticles();
                
                // Play reveal sound
                this.playEnhancedSound('fortuneReveal');

                // Reset animation state
                this.state.isAnimating = false;
                this.state.canDraw = true;
            }

            // Enhanced drawing methods
            drawCard() {
                if (this.state.isAnimating || !this.state.canDraw) return;

                // Add cooldown
                const now = Date.now();
                if (now - this.state.lastDrawTime < 1000) {
                    this.showNotification('Please wait before drawing another card', 'warning');
                    return;
                }
                this.state.lastDrawTime = now;

                // Shuffle and select random card
                const availableCards = this.cards.map((_, index) => index);
                const randomIndex = Math.floor(Math.random() * availableCards.length);
                
                this.selectCard(randomIndex);
            }

            drawThreeCards() {
                if (this.state.isAnimating || !this.state.canDraw) return;

                this.state.threeCardMode = true;
                this.state.canDraw = false;

                // Show loading
                this.showNotification('Drawing three cards for your reading...', 'info');

                // Select three random cards
                const selectedCards = [];
                while (selectedCards.length < 3) {
                    const randomIndex = Math.floor(Math.random() * this.cards.length);
                    if (!selectedCards.includes(randomIndex)) {
                        selectedCards.push(randomIndex);
                    }
                }

                // Animate cards one by one
                selectedCards.forEach((cardIndex, i) => {
                    setTimeout(() => {
                        this.selectCard(cardIndex);
                    }, i * 2000);
                });

                // Reset after all cards are drawn
                setTimeout(() => {
                    this.state.threeCardMode = false;
                    this.state.canDraw = true;
                }, 8000);
            }

            shuffleCards() {
                if (this.state.isAnimating) return;

                this.state.isAnimating = true;
                
                // Shuffle animation
                const cards = document.querySelectorAll('.card');
                cards.forEach((card, index) => {
                    setTimeout(() => {
                        card.style.animation = 'shuffle 0.8s ease-in-out';
                        card.addEventListener('animationend', () => {
                            card.style.animation = '';
                        }, { once: true });
                    }, index * 100);
                });

                // Play shuffle sound
                this.playEnhancedSound('shuffle');

                // Reset cards
                setTimeout(() => {
                    this.resetCards();
                    this.state.isAnimating = false;
                    this.showNotification('Cards shuffled successfully!', 'success');
                }, 2000);
            }

            resetCards() {
                const cards = document.querySelectorAll('.card');
                cards.forEach(card => {
                    card.classList.remove('selected', 'flipped');
                });
                this.state.isCardSelected = false;
                this.state.selectedCard = null;
            }

            // Enhanced particle system methods
            createTrailParticles(x, y) {
                if (!this.settings.particleEffects) return;

                for (let i = 0; i < this.settings.particleDensity; i++) {
                    this.particles.push({
                        x: x + (Math.random() - 0.5) * 20,
                        y: y + (Math.random() - 0.5) * 20,
                        vx: (Math.random() - 0.5) * 4,
                        vy: (Math.random() - 0.5) * 4,
                        life: 1,
                        decay: 0.02,
                        size: Math.random() * 4 + 2,
                        color: this.getRandomColor(),
                        type: 'trail'
                    });
                }
            }

            createSelectionParticles(cardElement) {
                const rect = cardElement.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                for (let i = 0; i < 50; i++) {
                    this.particles.push({
                        x: centerX + (Math.random() - 0.5) * 200,
                        y: centerY + (Math.random() - 0.5) * 200,
                        vx: (Math.random() - 0.5) * 8,
                        vy: (Math.random() - 0.5) * 8,
                        life: 1,
                        decay: 0.015,
                        size: Math.random() * 8 + 4,
                        color: 'rgba(255, 215, 0, 0.8)',
                        type: 'selection'
                    });
                }
            }

            createMessageParticles() {
                for (let i = 0; i < 100; i++) {
                    this.particles.push({
                        x: Math.random() * window.innerWidth,
                        y: window.innerHeight,
                        vx: (Math.random() - 0.5) * 2,
                        vy: -Math.random() * 3 - 1,
                        life: 1,
                        decay: 0.01,
                        size: Math.random() * 6 + 3,
                        color: this.getRandomColor(),
                        type: 'message'
                    });
                }
            }

            // Enhanced animation methods
            animate() {
                this.updateParticles();
                this.updateConstellations();
                this.render();
                this.animationFrame = requestAnimationFrame(() => this.animate());
            }

            updateParticles() {
                // Update trail particles
                this.particles = this.particles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life -= particle.decay;
                    particle.vx *= 0.99;
                    particle.vy *= 0.99;
                    particle.size *= 0.99;

                    return particle.life > 0;
                });

                // Update glitter particles
                this.glitterParticles = this.glitterParticles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.rotation += particle.rotationSpeed;
                    particle.life -= particle.decay;
                    particle.size *= 0.98;

                    return particle.life > 0;
                });

                // Update shine particles
                this.shineParticles = this.shineParticles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life -= particle.decay;
                    particle.opacity *= 0.99;

                    return particle.life > 0;
                });
            }

            updateConstellations() {
                this.constellationParticles.forEach(star => {
                    star.opacity += Math.sin(Date.now() * star.twinkleSpeed) * 0.01;
                    star.opacity = Math.max(0.1, Math.min(0.8, star.opacity));
                });
            }

            render() {
                // Clear all canvases
                Object.values(this.contexts).forEach(ctx => {
                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                });

                this.renderConstellations();
                this.renderParticles();
                this.renderGlitter();
                this.renderShine();
            }

            renderConstellations() {
                const ctx = this.contexts.constellation;
                ctx.save();

                // Draw constellation stars
                this.constellationParticles.forEach(star => {
                    ctx.globalAlpha = star.opacity;
                    ctx.fillStyle = '#ffffff';
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = '#9969ff';
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                    ctx.fill();
                });

                // Draw constellation lines
                ctx.strokeStyle = 'rgba(153, 105, 255, 0.3)';
                ctx.lineWidth = 1;
                this.constellationParticles.forEach((star, index) => {
                    star.connections.forEach(connectionIndex => {
                        const connectedStar = this.constellationParticles[connectionIndex];
                        if (connectedStar) {
                            ctx.beginPath();
                            ctx.moveTo(star.x, star.y);
                            ctx.lineTo(connectedStar.x, connectedStar.y);
                            ctx.stroke();
                        }
                    });
                });

                ctx.restore();
            }

            renderParticles() {
                const ctx = this.contexts.particle;
                ctx.save();

                this.particles.forEach(particle => {
                    ctx.globalAlpha = particle.life;
                    ctx.fillStyle = particle.color;
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                });

                ctx.restore();
            }

            renderGlitter() {
                const ctx = this.contexts.glitter;
                ctx.save();

                this.glitterParticles.forEach(particle => {
                    ctx.globalAlpha = particle.life;
                    ctx.fillStyle = particle.color;
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = particle.color;
                    
                    ctx.save();
                    ctx.translate(particle.x, particle.y);
                    ctx.rotate(particle.rotation);
                    ctx.fillRect(-particle.size/2, -particle.size/2, particle.size, particle.size);
                    ctx.restore();
                });

                ctx.restore();
            }

            renderShine() {
                const ctx = this.contexts.shine;
                ctx.save();

                this.shineParticles.forEach(particle => {
                    ctx.globalAlpha = particle.opacity;
                    ctx.fillStyle = particle.color;
                    ctx.shadowBlur = 25;
                    ctx.shadowColor = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                });

                ctx.restore();
            }

            // Enhanced sound methods
            playEnhancedSound(type) {
                if (!this.settings.soundEnabled || !this.audioContext) return;

                const now = this.audioContext.currentTime;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(this.masterGain);

                let frequency, duration, volume;

                switch (type) {
                    case 'cardSelect':
                        frequency = 440;
                        duration = 0.3;
                        volume = 0.2;
                        break;
                    case 'fortuneReveal':
                        frequency = 660;
                        duration = 0.8;
                        volume = 0.3;
                        break;
                    case 'shuffle':
                        frequency = 220;
                        duration = 0.5;
                        volume = 0.15;
                        break;
                    case 'notification':
                        frequency = 880;
                        duration = 0.2;
                        volume = 0.1;
                        break;
                    default:
                        frequency = 440;
                        duration = 0.3;
                        volume = 0.2;
                }

                oscillator.frequency.setValueAtTime(frequency, now);
                oscillator.frequency.exponentialRampToValueAtTime(frequency * 1.5, now + duration);
                
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(volume, now + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);

                oscillator.start(now);
                oscillator.stop(now + duration);
            }

            // Enhanced utility methods
            getRandomColor() {
                const colors = [
                    'rgba(153, 105, 255, 0.8)',
                    'rgba(255, 105, 161, 0.8)',
                    'rgba(105, 180, 255, 0.8)',
                    'rgba(255, 235, 59, 0.8)',
                    'rgba(255, 255, 255, 0.8)'
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            calculateLuckBonus(card) {
                const timeFactor = Math.sin(Date.now() / 10000) * 0.3 + 1;
                const rarityBonus = this.getRarityMultiplier(card.rarity);
                return Math.max(0.5, Math.min(2.0, timeFactor * rarityBonus));
            }

            getRarityMultiplier(rarity) {
                const multipliers = {
                    'common': 1.0,
                    'uncommon': 1.2,
                    'rare': 1.5,
                    'epic': 2.0,
                    'legendary': 2.5,
                    'mythic': 3.0
                };
                return multipliers[rarity] || 1.0;
            }

            updateStreakCount(card) {
                if (['rare', 'epic', 'legendary', 'mythic'].includes(card.rarity)) {
                    this.stats.streakCount++;
                } else {
                    this.stats.streakCount = 0;
                }
            }

            // Enhanced achievement system
            initializeAchievements() {
                this.achievements = [
                    { id: 'first_draw', name: 'First Steps', description: 'Draw your first card', condition: () => this.stats.totalDraws >= 1 },
                    { id: 'lucky_seven', name: 'Lucky Seven', description: 'Draw 7 cards', condition: () => this.stats.totalDraws >= 7 },
                    { id: 'rare_collector', name: 'Rare Collector', description: 'Collect 5 rare cards', condition: () => this.stats.rareCards >= 5 },
                    { id: 'mystic_master', name: 'Mystic Master', description: 'Reach 1000 luck score', condition: () => this.stats.luckScore >= 1000 },
                    { id: 'streak_master', name: 'Streak Master', description: 'Get a 5-card rare streak', condition: () => this.stats.streakCount >= 5 },
                    { id: 'time_traveler', name: 'Time Traveler', description: 'Play for 30 minutes', condition: () => Date.now() - this.stats.sessionStart >= 1800000 }
                ];
            }

            checkAchievements(card) {
                this.achievements.forEach(achievement => {
                    if (!this.state.achievements.has(achievement.id) && achievement.condition()) {
                        this.state.achievements.add(achievement.id);
                        this.showAchievement(achievement);
                    }
                });
            }

            showAchievement(achievement) {
                this.showNotification(`Achievement Unlocked: ${achievement.name}`, 'success');
                this.createAchievementParticles();
                this.playEnhancedSound('notification');
            }

            createAchievementParticles() {
                for (let i = 0; i < 30; i++) {
                    this.particles.push({
                        x: window.innerWidth / 2,
                        y: window.innerHeight / 2,
                        vx: (Math.random() - 0.5) * 10,
                        vy: (Math.random() - 0.5) * 10,
                        life: 1,
                        decay: 0.02,
                        size: Math.random() * 10 + 5,
                        color: 'rgba(255, 215, 0, 0.9)',
                        type: 'achievement'
                    });
                }
            }

            // Enhanced UI methods
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="notification-content">
                        <div class="notification-icon">
                            ${type === 'success' ? '✅' : type === 'warning' ? '⚠️' : 'ℹ️'}
                        </div>
                        <div class="notification-text">${message}</div>
                        <button class="notification-close">×</button>
                    </div>
                `;

                document.body.appendChild(notification);

                // Auto-remove after 5 seconds
                setTimeout(() => {
                    notification.remove();
                }, 5000);

                // Close button
                notification.querySelector('.notification-close').addEventListener('click', () => {
                    notification.remove();
                });

                // Animate in
                setTimeout(() => {
                    notification.classList.add('animate__animated', 'animate__slideInRight');
                }, 100);
            }

            updateStatsDisplay() {
                document.getElementById('totalDraws').textContent = this.stats.totalDraws;
                document.getElementById('rareCards').textContent = this.stats.rareCards;
                document.getElementById('luckScore').textContent = this.stats.luckScore;
                document.getElementById('streakCount').textContent = this.stats.streakCount;
            }

            updateToggleSwitch(switchId) {
                const switchElement = document.getElementById(switchId);
                if (this.settings[switchId]) {
                    switchElement.classList.add('active');
                } else {
                    switchElement.classList.remove('active');
                }
            }

            // Enhanced settings methods
            toggleSettings() {
                const settingsPanel = document.getElementById('settingsPanel');
                settingsPanel.classList.toggle('open');
            }

            toggleSound() {
                this.settings.soundEnabled = !this.settings.soundEnabled;
                if (this.masterGain) {
                    this.masterGain.gain.value = this.settings.soundEnabled ? 0.3 : 0;
                }
                
                const soundBtn = document.getElementById('soundBtn');
                soundBtn.innerHTML = this.settings.soundEnabled ? 
                    '<i class="fas fa-volume-up"></i>' : 
                    '<i class="fas fa-volume-mute"></i>';
                
                this.saveSettings();
            }

            toggleFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        this.showNotification('Fullscreen not supported', 'warning');
                    });
                } else {
                    document.exitFullscreen();
                }
            }

            toggleTheme() {
                const themes = ['cosmic', 'ethereal', 'mystic', 'celestial'];
                const currentIndex = themes.indexOf(this.state.currentTheme);
                const nextIndex = (currentIndex + 1) % themes.length;
                this.state.currentTheme = themes[nextIndex];
                
                this.applyTheme(this.state.currentTheme);
                this.showNotification(`Theme changed to ${this.state.currentTheme}`, 'info');
            }

            applyTheme(theme) {
                const root = document.documentElement;
                
                switch (theme) {
                    case 'ethereal':
                        root.style.setProperty('--primary-color', '#e1bee7');
                        root.style.setProperty('--secondary-color', '#f8bbd9');
                        root.style.setProperty('--tertiary-color', '#b3e5fc');
                        break;
                    case 'mystic':
                        root.style.setProperty('--primary-color', '#4a148c');
                        root.style.setProperty('--secondary-color', '#880e4f');
                        root.style.setProperty('--tertiary-color', '#1a237e');
                        break;
                    case 'celestial':
                        root.style.setProperty('--primary-color', '#ffd700');
                        root.style.setProperty('--secondary-color', '#ff8c00');
                        root.style.setProperty('--tertiary-color', '#4169e1');
                        break;
                    default: // cosmic
                        root.style.setProperty('--primary-color', '#9969ff');
                        root.style.setProperty('--secondary-color', '#ff69a1');
                        root.style.setProperty('--tertiary-color', '#69b4ff');
                }
            }

            resetSettings() {
                this.settings = {
                    particleDensity: 5,
                    animationSpeed: 1,
                    glowIntensity: 1,
                    autoShuffle: false,
                    particleEffects: true,
                    screenShake: false,
                    soundEnabled: true,
                    theme: 'cosmic',
                    difficulty: 'normal'
                };

                this.initializeSettings();
                this.updateParticleSystem();
                this.updateAnimationSpeed();
                this.updateGlowEffects();
                this.showNotification('Settings reset to default', 'info');
            }

            updateParticleSystem() {
                // Adjust particle generation based on settings
                if (!this.settings.particleEffects) {
                    this.particles.length = 0;
                    this.glitterParticles.length = 0;
                    this.shineParticles.length = 0;
                }
            }

            updateAnimationSpeed() {
                document.documentElement.style.setProperty('--animation-speed', this.settings.animationSpeed);
            }

            updateGlowEffects() {
                document.documentElement.style.setProperty('--glow-intensity', this.settings.glowIntensity);
            }

            // Enhanced event handlers
            onCardHover(cardElement) {
                if (this.settings.particleEffects) {
                    const rect = cardElement.getBoundingClientRect();
                    this.createHoverParticles(rect.left + rect.width / 2, rect.top + rect.height / 2);
                }
            }

            onCardLeave(cardElement) {
                // Clean up hover effects
            }

            createHoverParticles(x, y) {
                for (let i = 0; i < 5; i++) {
                    this.particles.push({
                        x: x + (Math.random() - 0.5) * 50,
                        y: y + (Math.random() - 0.5) * 50,
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        life: 1,
                        decay: 0.03,
                        size: Math.random() * 3 + 1,
                        color: 'rgba(255, 255, 255, 0.6)',
                        type: 'hover'
                    });
                }
            }

            createScreenShake() {
                if (!this.settings.screenShake) return;

                const container = document.querySelector('.container');
                container.style.animation = 'screenShake 0.5s ease-in-out';
                setTimeout(() => {
                    container.style.animation = '';
                }, 500);
            }

            // Enhanced ambient effects
            startAmbientEffects() {
                // Ambient particle generation
                this.ambientInterval = setInterval(() => {
                    if (this.settings.particleEffects) {
                        this.createAmbientParticles();
                    }
                }, 2000);

                // Ambient glitter
                this.glitterInterval = setInterval(() => {
                    if (this.settings.particleEffects) {
                        this.createAmbientGlitter();
                    }
                }, 3000);

                // Ambient shine
                this.shineInterval = setInterval(() => {
                    if (this.settings.particleEffects) {
                        this.createAmbientShine();
                    }
                }, 1500);
            }

            createAmbientParticles() {
                for (let i = 0; i < 3; i++) {
                    this.particles.push({
                        x: Math.random() * window.innerWidth,
                        y: window.innerHeight + 50,
                        vx: (Math.random() - 0.5) * 1,
                        vy: -Math.random() * 2 - 1,
                        life: 1,
                        decay: 0.005,
                        size: Math.random() * 4 + 2,
                        color: this.getRandomColor(),
                        type: 'ambient'
                    });
                }
            }

            createAmbientGlitter() {
                for (let i = 0; i < 5; i++) {
                    this.glitterParticles.push({
                        x: Math.random() * window.innerWidth,
                        y: -50,
                        vx: (Math.random() - 0.5) * 2,
                        vy: Math.random() * 3 + 1,
                        rotation: Math.random() * Math.PI * 2,
                        rotationSpeed: (Math.random() - 0.5) * 0.2,
                        life: 1,
                        decay: 0.008,
                        size: Math.random() * 6 + 3,
                        color: 'rgba(255, 215, 0, 0.7)',
                        type: 'glitter'
                    });
                }
            }

            createAmbientShine() {
                for (let i = 0; i < 2; i++) {
                    this.shineParticles.push({
                        x: Math.random() * window.innerWidth,
                        y: Math.random() * window.innerHeight,
                        vx: (Math.random() - 0.5) * 0.5,
                        vy: (Math.random() - 0.5) * 0.5,
                        life: 1,
                        decay: 0.01,
                        size: Math.random() * 8 + 4,
                        opacity: 0.3,
                        color: 'rgba(255, 255, 255, 0.8)',
                        type: 'shine'
                    });
                }
            }

            startQuoteRotation() {
                this.quoteInterval = setInterval(() => {
                    this.rotateQuote();
                }, 8000);
            }

            rotateQuote() {
                const quoteElement = document.getElementById('mysticalQuote');
                const randomQuote = this.quotes[Math.floor(Math.random() * this.quotes.length)];
                
                quoteElement.style.opacity = '0';
                setTimeout(() => {
                    quoteElement.textContent = randomQuote;
                    quoteElement.style.opacity = '1';
                }, 500);
            }

            startAutoShuffle() {
                if (this.settings.autoShuffle) {
                    this.autoShuffleInterval = setInterval(() => {
                        if (!this.state.isAnimating) {
                            this.shuffleCards();
                        }
                    }, 30000);
                }
            }

            stopAutoShuffle() {
                if (this.autoShuffleInterval) {
                    clearInterval(this.autoShuffleInterval);
                    this.autoShuffleInterval = null;
                }
            }

            // Enhanced save/load methods
            saveStats() {
                localStorage.setItem('mysticalCardsStats', JSON.stringify(this.stats));
                this.updateStatsDisplay();
            }

            saveSettings() {
                localStorage.setItem('mysticalCardsSettings', JSON.stringify(this.settings));
            }

            saveReading() {
                if (!this.state.selectedCard) return;

                const card = this.cards[this.state.selectedCard];
                const reading = {
                    id: Date.now(),
                    card: card,
                    timestamp: new Date().toISOString(),
                    luckScore: this.stats.luckScore
                };

                this.stats.savedReadings.push(reading);
                this.saveStats();
                this.showNotification('Reading saved successfully!', 'success');
            }

            clearHistory() {
                if (confirm('Are you sure you want to clear all history and stats?')) {
                    this.stats = {
                        totalDraws: 0,
                        rareCards: 0,
                        luckScore: 0,
                        streakCount: 0,
                        savedReadings: [],
                        achievements: [],
                        sessionStart: Date.now()
                    };
                    this.state.achievements.clear();
                    this.saveStats();
                    this.resetCards();
                    this.showNotification('History cleared successfully!', 'info');
                }
            }

            // Enhanced messaging methods
            closeMessage() {
                const messageContainer = document.getElementById('messageContainer');
                messageContainer.classList.remove('visible');
                this.resetCards();
            }

            drawAnother() {
                this.closeMessage();
                setTimeout(() => {
                    this.drawCard();
                }, 500);
            }

            shareReading() {
                if (!this.state.selectedCard) {
                    this.showNotification('No card selected to share', 'warning');
                    return;
                }

                const card = this.cards[this.state.selectedCard];
                const shareText = `I drew "${card.title}" - ${card.desc}\n\n${card.fortune}\n\nTry your luck at Mystical Fortune Cards!`;

                if (navigator.share) {
                    navigator.share({
                        title: 'My Mystical Fortune',
                        text: shareText,
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(shareText).then(() => {
                        this.showNotification('Fortune copied to clipboard!', 'success');
                    });
                }
            }

            // Enhanced help and info methods
            showHelp() {
                const helpContent = `
                    <div class="help-content">
                        <h3>How to Use Mystical Fortune Cards</h3>
                        <div class="help-section">
                            <h4>Basic Controls:</h4>
                            <ul>
                                <li><strong>Space/Enter</strong> - Draw a random card</li>
                                <li><strong>S</strong> - Toggle settings panel</li>
                                <li><strong>M</strong> - Toggle sound</li>
                                <li><strong>F</strong> - Toggle fullscreen</li>
                                <li><strong>T</strong> - Change theme</li>
                                <li><strong>R</strong> - Shuffle cards</li>
                                <li><strong>P</strong> - Share reading</li>
                                <li><strong>Escape</strong> - Close message</li>
                            </ul>
                        </div>
                        <div class="help-section">
                            <h4>Card Rarities:</h4>
                            <ul>
                                <li><strong>Common</strong> - Basic wisdom (1x multiplier)</li>
                                <li><strong>Uncommon</strong> - Enhanced insight (1.2x multiplier)</li>
                                <li><strong>Rare</strong> - Powerful guidance (1.5x multiplier)</li>
                                <li><strong>Epic</strong> - Profound revelations (2x multiplier)</li>
                                <li><strong>Legendary</strong> - Cosmic wisdom (2.5x multiplier)</li>
                                <li><strong>Mythic</strong> - Divine knowledge (3x multiplier)</li>
                            </ul>
                        </div>
                        <div class="help-section">
                            <h4>Features:</h4>
                            <ul>
                                <li>Interactive particle effects</li>
                                <li>Multiple drawing modes</li>
                                <li>Achievement system</li>
                                <li>Customizable settings</li>
                                <li>Reading history</li>
                                <li>Multiple themes</li>
                            </ul>
                        </div>
                    </div>
                `;

                this.showModal('Help & Guide', helpContent);
            }

            showAbout() {
                const aboutContent = `
                    <div class="about-content">
                        <h3>About Mystical Fortune Cards</h3>
                        <p>Welcome to the ultimate mystical experience! This enchanted application combines ancient wisdom with modern technology to provide you with personalized cosmic insights.</p>
                        
                        <h4>Features:</h4>
                        <ul>
                            <li>16 unique mystical cards with detailed fortunes</li>
                            <li>Advanced particle systems and 3D effects</li>
                            <li>Multiple drawing modes including three-card readings</li>
                            <li>Achievement system and progress tracking</li>
                            <li>Customizable settings and themes</li>
                            <li>Local storage for saved readings</li>
                            <li>Responsive design for all devices</li>
                        </ul>
                        
                        <h4>Technology:</h4>
                        <p>Built with HTML5, CSS3, and JavaScript featuring:</p>
                        <ul>
                            <li>Canvas-based particle systems</li>
                            <li>Web Audio API for mystical sounds</li>
                            <li>CSS animations and transitions</li>
                            <li>Local storage for persistence</li>
                            <li>Responsive design principles</li>
                        </ul>
                    </div>
                `;

                this.showModal('About', aboutContent);
            }

            showCredits() {
                const creditsContent = `
                    <div class="credits-content">
                        <h3>Credits & Acknowledgments</h3>
                        
                        <h4>Libraries & Resources:</h4>
                        <ul>
                            <li><strong>Animate.css</strong> - CSS animation library</li>
                            <li><strong>Font Awesome</strong> - Icon library</li>
                            <li><strong>Google Fonts</strong> - Typography</li>
                            <li><strong>Canvas API</strong> - Particle effects</li>
                            <li><strong>Web Audio API</strong> - Sound effects</li>
                        </ul>
                        
                        <h4>Fonts Used:</h4>
                        <ul>
                            <li><strong>Cinzel</strong> - Elegant display font</li>
                            <li><strong>Cormorant Garamond</strong> - Readable serif</li>
                            <li><strong>Poiret One</strong> - Mystical headings</li>
                            <li><strong>Uncial Antiqua</strong> - Ancient-style text</li>
                        </ul>
                        
                        <h4>Special Thanks:</h4>
                        <p>To all the mystics, fortune tellers, and spiritual guides who have inspired this digital divination experience.</p>
                        
                        <p class="version">Version 2.0 - Ultimate Enhanced Edition</p>
                    </div>
                `;

                this.showModal('Credits', creditsContent);
            }

            showModal(title, content) {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>${title}</h2>
                            <button class="modal-close">&times;</button>
                        </div>
                        <div class="modal-body">
                            ${content}
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Close modal events
                modal.querySelector('.modal-close').addEventListener('click', () => {
                    modal.remove();
                });

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });

                // Escape key to close
                const escapeHandler = (e) => {
                    if (e.key === 'Escape') {
                        modal.remove();
                        document.removeEventListener('keydown', escapeHandler);
                    }
                };
                document.addEventListener('keydown', escapeHandler);
            }

            contact() {
                const contactContent = `
                    <div class="contact-content">
                        <h3>Contact & Support</h3>
                        <p>For questions, suggestions, or mystical inquiries, please reach out:</p>
                        
                        <div class="contact-methods">
                            <div class="contact-method">
                                <i class="fas fa-envelope"></i>
                                <span>Email: mystical@fortunecards.com</span>
                            </div>
                            <div class="contact-method">
                                <i class="fas fa-globe"></i>
                                <span>Website: www.mysticalfortunecards.com</span>
                            </div>
                            <div class="contact-method">
                                <i class="fab fa-twitter"></i>
                                <span>Twitter: @MysticalCards</span>
                            </div>
                        </div>
                        
                        <h4>Support:</h4>
                        <p>If you encounter any issues or have suggestions for improvements, please don't hesitate to contact us. We're always working to enhance your mystical experience!</p>
                        
                        <h4>Privacy:</h4>
                        <p>Your readings and personal data are stored locally on your device. We respect your privacy and do not collect or transmit any personal information.</p>
                    </div>
                `;

                this.showModal('Contact', contactContent);
            }

            // Enhanced cleanup methods
            cleanup() {
                // Remove event listeners
                window.removeEventListener('mousemove', this.handleMouseMove);
                window.removeEventListener('touchmove', this.handleTouchMove);
                window.removeEventListener('resize', this.handleResize);

                // Clear intervals
                if (this.ambientInterval) clearInterval(this.ambientInterval);
                if (this.glitterInterval) clearInterval(this.glitterInterval);
                if (this.shineInterval) clearInterval(this.shineInterval);
                if (this.quoteInterval) clearInterval(this.quoteInterval);
                if (this.autoShuffleInterval) clearInterval(this.autoShuffleInterval);

                // Clear animation frame
                if (this.animationFrame) cancelAnimationFrame(this.animationFrame);

                // Clear particle arrays
                this.particles.length = 0;
                this.glitterParticles.length = 0;
                this.shineParticles.length = 0;
                this.constellationParticles.length = 0;

                // Close audio context
                if (this.audioContext) {
                    this.audioContext.close();
                }
            }
        }

        // Global functions for button events
        function drawCard() {
            app.drawCard();
        }

        function shuffleCards() {
            app.shuffleCards();
        }

        function drawThreeCards() {
            app.drawThreeCards();
        }

        function clearHistory() {
            app.clearHistory();
        }

        function closeMessage() {
            app.closeMessage();
        }

        function saveReading() {
            app.saveReading();
        }

        function shareReading() {
            app.shareReading();
        }

        function drawAnother() {
            app.drawAnother();
        }

        function showHelp() {
            app.showHelp();
        }

        function showAbout() {
            app.showAbout();
        }

        function showCredits() {
            app.showCredits();
        }

        function contact() {
            app.contact();
        }

        // Enhanced CSS for modals
        const modalStyles = `
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: blur(20px);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            }

            .modal-content {
                background: var(--glass-bg);
                backdrop-filter: blur(25px);
                border: 2px solid var(--primary-color);
                border-radius: 25px;
                max-width: 800px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 30px 80px var(--shadow-color);
                animation: slideInUp 0.4s ease;
            }

            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 2rem;
                border-bottom: 1px solid var(--glass-border);
            }

            .modal-header h2 {
                font-family: "Cinzel", serif;
                color: var(--primary-color);
                margin: 0;
            }

            .modal-close {
                background: none;
                border: none;
                font-size: 2rem;
                color: var(--text-color);
                cursor: pointer;
                padding: 0.5rem;
                border-radius: 50%;
                transition: all 0.3s ease;
            }

            .modal-close:hover {
                background: var(--primary-color);
                color: white;
                transform: scale(1.1);
            }

            .modal-body {
                padding: 2rem;
                color: var(--text-color);
                line-height: 1.6;
            }

            .modal-body h3 {
                color: var(--accent-color);
                margin-top: 0;
            }

            .modal-body h4 {
                color: var(--primary-color);
                margin-top: 2rem;
            }

            .modal-body ul {
                padding-left: 2rem;
            }

            .modal-body li {
                margin-bottom: 0.5rem;
            }

            .help-section, .contact-methods {
                margin-bottom: 2rem;
            }

            .contact-method {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin-bottom: 1rem;
                padding: 1rem;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 10px;
            }

            .contact-method i {
                color: var(--primary-color);
                font-size: 1.2rem;
            }

            .version {
                text-align: center;
                color: var(--accent-color);
                font-style: italic;
                margin-top: 2rem;
            }

            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            @keyframes slideInUp {
                from { 
                    opacity: 0; 
                    transform: translateY(100px) scale(0.8); 
                }
                to { 
                    opacity: 1; 
                    transform: translateY(0) scale(1); 
                }
            }

            @keyframes screenShake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }

            @keyframes shuffle {
                0% { transform: rotateY(0deg) scale(1); }
                50% { transform: rotateY(180deg) scale(1.1); }
                100% { transform: rotateY(360deg) scale(1); }
            }
        `;

        // Inject modal styles
        const styleSheet = document.createElement('style');
        styleSheet.textContent = modalStyles;
        document.head.appendChild(styleSheet);

        // Initialize the ultimate enhanced application
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new UltimateEnhancedMysticalCards();

            // Enhanced cleanup on page
            // Enhanced cleanup on page unload
            window.addEventListener('beforeunload', () => {
                app.cleanup();
            });

            // Enhanced performance monitoring
            if ('performance' in window) {
                window.addEventListener('load', () => {
                    setTimeout(() => {
                        const perfData = performance.getEntriesByType('navigation')[0];
                        console.log(`App loaded in ${perfData.loadEventEnd - perfData.fetchStart}ms`);
                    }, 0);
                });
            }

            // Enhanced error handling
            window.addEventListener('error', (e) => {
                console.error('Application error:', e.error);
                app.showNotification('An error occurred. Please refresh the page.', 'warning');
            });

            // Enhanced visibility change handling
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'hidden') {
                    app.pauseAnimations();
                } else {
                    app.resumeAnimations();
                }
            });

            // Enhanced connection status monitoring
            window.addEventListener('online', () => {
                app.showNotification('Connection restored', 'success');
            });

            window.addEventListener('offline', () => {
                app.showNotification('You are offline. Some features may be limited.', 'warning');
            });

            // Enhanced device orientation handling
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    app.resizeCanvas();
                    app.updateLayout();
                }, 500);
            });

            // Enhanced accessibility features
            document.addEventListener('keydown', (e) => {
                // Screen reader support
                if (e.key === 'F1') {
                    e.preventDefault();
                    app.announceCurrentState();
                }
            });

            // Enhanced gesture support for mobile
            let touchStartTime = 0;
            let touchStartPos = { x: 0, y: 0 };

            document.addEventListener('touchstart', (e) => {
                touchStartTime = Date.now();
                touchStartPos = {
                    x: e.touches[0].clientX,
                    y: e.touches[0].clientY
                };
            });

            document.addEventListener('touchend', (e) => {
                const touchEndTime = Date.now();
                const touchEndPos = {
                    x: e.changedTouches[0].clientX,
                    y: e.changedTouches[0].clientY
                };

                const duration = touchEndTime - touchStartTime;
                const distance = Math.sqrt(
                    Math.pow(touchEndPos.x - touchStartPos.x, 2) +
                    Math.pow(touchEndPos.y - touchStartPos.y, 2)
                );

                // Swipe gestures
                if (duration < 500 && distance > 50) {
                    const deltaX = touchEndPos.x - touchStartPos.x;
                    const deltaY = touchEndPos.y - touchStartPos.y;

                    if (Math.abs(deltaX) > Math.abs(deltaY)) {
                        if (deltaX > 0) {
                            app.handleSwipeRight();
                        } else {
                            app.handleSwipeLeft();
                        }
                    } else {
                        if (deltaY > 0) {
                            app.handleSwipeDown();
                        } else {
                            app.handleSwipeUp();
                        }
                    }
                }

                // Double tap
                if (duration < 300 && distance < 20) {
                    if (app.lastTapTime && touchEndTime - app.lastTapTime < 300) {
                        app.handleDoubleTap();
                    }
                    app.lastTapTime = touchEndTime;
                }
            });

            // Enhanced save state on page visibility change
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'hidden') {
                    app.saveCurrentState();
                }
            });

            // Enhanced periodic state saving
            setInterval(() => {
                app.saveCurrentState();
            }, 60000); // Save every minute

            // Enhanced memory management
            setInterval(() => {
                app.performMemoryCleanup();
            }, 300000); // Clean up every 5 minutes

            // Enhanced battery optimization
            if ('getBattery' in navigator) {
                navigator.getBattery().then(battery => {
                    const updateBatteryOptimization = () => {
                        if (battery.level < 0.2) {
                            app.enableBatteryOptimization();
                        } else {
                            app.disableBatteryOptimization();
                        }
                    };

                    battery.addEventListener('levelchange', updateBatteryOptimization);
                    updateBatteryOptimization();
                });
            }

            // Enhanced service worker registration for offline support
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('Service Worker registered:', registration);
                }).catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
            }

            // Enhanced analytics and tracking (privacy-conscious)
            app.trackUsage = {
                sessionStart: Date.now(),
                cardsDrawn: 0,
                featuresUsed: new Set(),
                errors: []
            };

            // Enhanced theme detection
            if (window.matchMedia) {
                const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
                const reducedMotionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');

                darkModeQuery.addEventListener('change', (e) => {
                    if (e.matches) {
                        app.enableDarkMode();
                    } else {
                        app.disableDarkMode();
                    }
                });

                reducedMotionQuery.addEventListener('change', (e) => {
                    if (e.matches) {
                        app.enableReducedMotion();
                    } else {
                        app.disableReducedMotion();
                    }
                });
            }

            // Enhanced WebGL detection for advanced effects
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (gl) {
                app.enableWebGLEffects();
            }

            // Enhanced device capabilities detection
            const deviceInfo = {
                isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                isTablet: /iPad|Android(?!.*Mobile)/i.test(navigator.userAgent),
                isDesktop: !(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),
                hasTouch: 'ontouchstart' in window,
                hasGyroscope: 'DeviceOrientationEvent' in window,
                hasAccelerometer: 'DeviceMotionEvent' in window
            };

            app.optimizeForDevice(deviceInfo);

            // Enhanced feature detection and progressive enhancement
            const features = {
                webGL: !!gl,
                webAudio: !!(window.AudioContext || window.webkitAudioContext),
                localStorage: typeof(Storage) !== 'undefined',
                canvas: !!document.createElement('canvas').getContext,
                fullscreen: !!(document.fullscreenEnabled || document.webkitFullscreenEnabled),
                vibration: 'vibrate' in navigator,
                share: 'share' in navigator,
                animations: CSS.supports('animation', 'test'),
                transforms: CSS.supports('transform', 'translateZ(0)'),
                backdrop: CSS.supports('backdrop-filter', 'blur(10px)')
            };

            app.initializeFeatures(features);

            // Enhanced initialization completion
            app.showNotification('Mystical Fortune Cards loaded successfully! ✨', 'success');
            
            // Enhanced tutorial for first-time users
            if (!localStorage.getItem('mysticalCardsTutorialCompleted')) {
                setTimeout(() => {
                    app.showTutorial();
                }, 3000);
            }

            // Enhanced welcome message based on time of day
            const hour = new Date().getHours();
            let greeting = '';
            if (hour < 12) {
                greeting = 'Good morning, seeker of wisdom! ☀️';
            } else if (hour < 17) {
                greeting = 'Good afternoon, cosmic traveler! 🌅';
            } else {
                greeting = 'Good evening, mystical explorer! 🌙';
            }

            setTimeout(() => {
                app.showNotification(greeting, 'info');
            }, 5000);

            // Enhanced console welcome message
            console.log(`
                ✨ Mystical Fortune Cards - Ultimate Enhanced Edition ✨
                
                Welcome to the most advanced mystical experience on the web!
                
                Features:
                • 16 unique mystical cards with detailed fortunes
                • Advanced particle systems and 3D effects
                • Multiple drawing modes and achievement system
                • Customizable settings and themes
                • Full keyboard and gesture support
                • Offline capability with service worker
                • Progressive enhancement for all devices
                
                Keyboard shortcuts:
                • Space/Enter: Draw card
                • S: Settings
                • M: Toggle sound
                • F: Fullscreen
                • T: Change theme
                • H: Help
                • R: Shuffle
                • P: Share
                
                Version: 2.0 Ultimate Enhanced Edition
                Built with ❤️ and ✨ magic
            `);
        });

        // Enhanced utility functions for the app class
        UltimateEnhancedMysticalCards.prototype.pauseAnimations = function() {
            this.animationsPaused = true;
            if (this.animationFrame) {
                cancelAnimationFrame(this.animationFrame);
            }
        };

        UltimateEnhancedMysticalCards.prototype.resumeAnimations = function() {
            this.animationsPaused = false;
            if (!this.animationFrame) {
                this.animationFrame = requestAnimationFrame(() => this.animate());
            }
        };

        UltimateEnhancedMysticalCards.prototype.updateLayout = function() {
            this.resizeCanvas();
            this.repositionElements();
        };

        UltimateEnhancedMysticalCards.prototype.repositionElements = function() {
            // Reposition floating elements based on new layout
            const floatingSymbols = document.querySelectorAll('.floating-symbol');
            floatingSymbols.forEach((symbol, index) => {
                const x = Math.random() * (window.innerWidth - 100);
                const y = Math.random() * (window.innerHeight - 100);
                symbol.style.left = `${x}px`;
                symbol.style.top = `${y}px`;
            });
        };

        UltimateEnhancedMysticalCards.prototype.announceCurrentState = function() {
            const announcement = document.createElement('div');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.style.position = 'absolute';
            announcement.style.left = '-10000px';
            announcement.style.width = '1px';
            announcement.style.height = '1px';
            announcement.style.overflow = 'hidden';
            
            const state = this.state.isCardSelected ? 
                `Card selected: ${this.cards[this.state.selectedCard].title}` : 
                `Ready to draw cards. Total draws: ${this.stats.totalDraws}`;
            
            announcement.textContent = state;
            document.body.appendChild(announcement);
            
            setTimeout(() => {
                document.body.removeChild(announcement);
            }, 1000);
        };

        UltimateEnhancedMysticalCards.prototype.handleSwipeRight = function() {
            this.drawCard();
        };

        UltimateEnhancedMysticalCards.prototype.handleSwipeLeft = function() {
            this.shuffleCards();
        };

        UltimateEnhancedMysticalCards.prototype.handleSwipeUp = function() {
            this.toggleSettings();
        };

        UltimateEnhancedMysticalCards.prototype.handleSwipeDown = function() {
            this.closeMessage();
        };

        UltimateEnhancedMysticalCards.prototype.handleDoubleTap = function() {
            this.drawThreeCards();
        };

        UltimateEnhancedMysticalCards.prototype.saveCurrentState = function() {
            const state = {
                selectedCard: this.state.selectedCard,
                isCardSelected: this.state.isCardSelected,
                currentTheme: this.state.currentTheme,
                lastSaved: Date.now()
            };
            localStorage.setItem('mysticalCardsState', JSON.stringify(state));
        };

        UltimateEnhancedMysticalCards.prototype.performMemoryCleanup = function() {
            // Clean up old particles
            this.particles = this.particles.filter(p => p.life > 0.1);
            this.glitterParticles = this.glitterParticles.filter(p => p.life > 0.1);
            this.shineParticles = this.shineParticles.filter(p => p.life > 0.1);
            
            // Clean up old notifications
            const oldNotifications = document.querySelectorAll('.notification');
            oldNotifications.forEach(notification => {
                if (Date.now() - parseInt(notification.dataset.created || '0') > 10000) {
                    notification.remove();
                }
            });
        };

        UltimateEnhancedMysticalCards.prototype.enableBatteryOptimization = function() {
            this.settings.particleDensity = Math.max(1, this.settings.particleDensity - 2);
            this.settings.animationSpeed = Math.max(0.5, this.settings.animationSpeed - 0.3);
            this.updateParticleSystem();
            this.updateAnimationSpeed();
            this.showNotification('Battery optimization enabled', 'info');
        };

        UltimateEnhancedMysticalCards.prototype.disableBatteryOptimization = function() {
            this.settings.particleDensity = Math.min(10, this.settings.particleDensity + 2);
            this.settings.animationSpeed = Math.min(3, this.settings.animationSpeed + 0.3);
            this.updateParticleSystem();
            this.updateAnimationSpeed();
        };

        UltimateEnhancedMysticalCards.prototype.enableDarkMode = function() {
            document.documentElement.setAttribute('data-theme', 'dark');
        };

        UltimateEnhancedMysticalCards.prototype.disableDarkMode = function() {
            document.documentElement.removeAttribute('data-theme');
        };

        UltimateEnhancedMysticalCards.prototype.enableReducedMotion = function() {
            document.documentElement.setAttribute('data-reduced-motion', 'true');
            this.settings.animationSpeed = 0.1;
            this.settings.particleEffects = false;
            this.updateAnimationSpeed();
            this.updateParticleSystem();
        };

        UltimateEnhancedMysticalCards.prototype.disableReducedMotion = function() {
            document.documentElement.removeAttribute('data-reduced-motion');
            this.settings.animationSpeed = 1;
            this.settings.particleEffects = true;
            this.updateAnimationSpeed();
            this.updateParticleSystem();
        };

        UltimateEnhancedMysticalCards.prototype.enableWebGLEffects = function() {
            this.webGLEnabled = true;
            // Initialize WebGL-based particle systems for enhanced performance
            this.initializeWebGLParticles();
        };

        UltimateEnhancedMysticalCards.prototype.initializeWebGLParticles = function() {
            // Advanced WebGL particle system implementation
            console.log('WebGL particle system initialized');
        };

        UltimateEnhancedMysticalCards.prototype.optimizeForDevice = function(deviceInfo) {
            if (deviceInfo.isMobile) {
                this.settings.particleDensity = Math.min(3, this.settings.particleDensity);
                this.settings.animationSpeed = Math.min(1.5, this.settings.animationSpeed);
            }
            
            if (deviceInfo.isTablet) {
                this.settings.particleDensity = Math.min(5, this.settings.particleDensity);
            }
            
            if (deviceInfo.hasTouch) {
                this.enableTouchOptimizations();
            }
            
            if (deviceInfo.hasGyroscope) {
                this.enableGyroscopeEffects();
            }
        };

        UltimateEnhancedMysticalCards.prototype.enableTouchOptimizations = function() {
            // Optimize touch interactions
            document.body.style.touchAction = 'manipulation';
            
            // Add haptic feedback
            if ('vibrate' in navigator) {
                const originalSelectCard = this.selectCard.bind(this);
                this.selectCard = function(index) {
                    navigator.vibrate(50);
                    originalSelectCard(index);
                };
            }
        };

        UltimateEnhancedMysticalCards.prototype.enableGyroscopeEffects = function() {
            window.addEventListener('deviceorientation', (e) => {
                if (this.settings.particleEffects) {
                    const tiltX = e.gamma; // Left to right
                    const tiltY = e.beta;  // Front to back
                    
                    // Adjust particle gravity based on device orientation
                    this.particles.forEach(particle => {
                        particle.vx += tiltX * 0.001;
                        particle.vy += tiltY * 0.001;
                    });
                }
            });
        };

        UltimateEnhancedMysticalCards.prototype.initializeFeatures = function(features) {
            this.features = features;
            
            if (!features.webAudio) {
                this.settings.soundEnabled = false;
                document.getElementById('soundBtn').style.display = 'none';
            }
            
            if (!features.fullscreen) {
                document.getElementById('fullscreenBtn').style.display = 'none';
            }
            
            if (!features.share) {
                document.getElementById('shareBtn').style.display = 'none';
            }
            
            if (!features.backdrop) {
                // Fallback for browsers without backdrop-filter support
                document.documentElement.style.setProperty('--glass-bg', 'rgba(0, 0, 0, 0.8)');
            }
        };

        UltimateEnhancedMysticalCards.prototype.showTutorial = function() {
            const tutorialSteps = [
                {
                    title: 'Welcome to Mystical Fortune Cards! ✨',
                    content: 'Let me guide you through this magical experience.',
                    target: null
                },
                {
                    title: 'Draw Your First Card 🎴',
                    content: 'Click the "Draw Your Fortune" button or press Space to reveal your destiny.',
                    target: '#drawCard'
                },
                {
                    title: 'Explore the Cards 🌟',
                    content: 'Each card has unique powers and rarities. Click any card to select it.',
                    target: '.card'
                },
                {
                    title: 'Customize Your Experience ⚙️',
                    content: 'Use the settings panel to adjust effects, sound, and more.',
                    target: '#settingsBtn'
                },
                {
                    title: 'Advanced Features 🎭',
                    content: 'Try the three-card reading for deeper insights, or shuffle for new possibilities.',
                    target: '#drawThree'
                },
                {
                    title: 'Ready to Begin! 🚀',
                    content: 'You\'re all set! May the cosmic forces guide your journey.',
                    target: null
                }
            ];
            
            this.currentTutorialStep = 0;
            this.showTutorialStep(tutorialSteps[0], tutorialSteps);
        };

        UltimateEnhancedMysticalCards.prototype.showTutorialStep = function(step, allSteps) {
            const tutorial
           const tutorialOverlay = document.createElement('div');
            tutorialOverlay.className = 'tutorial-overlay';
            tutorialOverlay.innerHTML = `
                <div class="tutorial-content">
                    <div class="tutorial-header">
                        <h3>${step.title}</h3>
                        <button class="tutorial-close">&times;</button>
                    </div>
                    <div class="tutorial-body">
                        <p>${step.content}</p>
                    </div>
                    <div class="tutorial-footer">
                        <div class="tutorial-progress">
                            <div class="tutorial-progress-bar" style="width: ${((this.currentTutorialStep + 1) / allSteps.length) * 100}%"></div>
                        </div>
                        <div class="tutorial-buttons">
                            ${this.currentTutorialStep > 0 ? '<button class="tutorial-btn tutorial-prev">Previous</button>' : ''}
                            ${this.currentTutorialStep < allSteps.length - 1 ? '<button class="tutorial-btn tutorial-next">Next</button>' : '<button class="tutorial-btn tutorial-finish">Finish</button>'}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(tutorialOverlay);

            // Highlight target element
            if (step.target) {
                const targetElement = document.querySelector(step.target);
                if (targetElement) {
                    targetElement.classList.add('tutorial-highlight');
                    setTimeout(() => {
                        targetElement.classList.remove('tutorial-highlight');
                    }, 3000);
                }
            }

            // Event listeners
            const closeBtn = tutorialOverlay.querySelector('.tutorial-close');
            const nextBtn = tutorialOverlay.querySelector('.tutorial-next');
            const prevBtn = tutorialOverlay.querySelector('.tutorial-prev');
            const finishBtn = tutorialOverlay.querySelector('.tutorial-finish');

            const closeTutorial = () => {
                tutorialOverlay.remove();
                localStorage.setItem('mysticalCardsTutorialCompleted', 'true');
            };

            closeBtn.addEventListener('click', closeTutorial);

            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    tutorialOverlay.remove();
                    this.currentTutorialStep++;
                    this.showTutorialStep(allSteps[this.currentTutorialStep], allSteps);
                });
            }

            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    tutorialOverlay.remove();
                    this.currentTutorialStep--;
                    this.showTutorialStep(allSteps[this.currentTutorialStep], allSteps);
                });
            }

            if (finishBtn) {
                finishBtn.addEventListener('click', closeTutorial);
            }

            // Keyboard navigation
            const keyHandler = (e) => {
                if (e.key === 'Escape') {
                    closeTutorial();
                    document.removeEventListener('keydown', keyHandler);
                } else if (e.key === 'ArrowRight' && nextBtn) {
                    nextBtn.click();
                } else if (e.key === 'ArrowLeft' && prevBtn) {
                    prevBtn.click();
                } else if (e.key === 'Enter' && finishBtn) {
                    finishBtn.click();
                }
            };

            document.addEventListener('keydown', keyHandler);
        };

        // Enhanced CSS for tutorial system
        const tutorialStyles = `
            .tutorial-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.85);
                backdrop-filter: blur(15px);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 15000;
                animation: fadeIn 0.3s ease;
            }

            .tutorial-content {
                background: var(--glass-bg);
                backdrop-filter: blur(25px);
                border: 2px solid var(--primary-color);
                border-radius: 20px;
                max-width: 500px;
                width: 90%;
                box-shadow: 0 30px 80px var(--shadow-color);
                animation: slideInScale 0.4s ease;
            }

            .tutorial-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1.5rem;
                border-bottom: 1px solid var(--glass-border);
            }

            .tutorial-header h3 {
                font-family: "Cinzel", serif;
                color: var(--primary-color);
                margin: 0;
                font-size: 1.3rem;
            }

            .tutorial-close {
                background: none;
                border: none;
                font-size: 1.5rem;
                color: var(--text-color);
                cursor: pointer;
                padding: 0.5rem;
                border-radius: 50%;
                transition: all 0.3s ease;
            }

            .tutorial-close:hover {
                background: var(--primary-color);
                color: white;
                transform: scale(1.1);
            }

            .tutorial-body {
                padding: 1.5rem;
                color: var(--text-color);
                line-height: 1.6;
            }

            .tutorial-body p {
                margin: 0;
                font-size: 1.1rem;
            }

            .tutorial-footer {
                padding: 1.5rem;
                border-top: 1px solid var(--glass-border);
            }

            .tutorial-progress {
                height: 4px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 2px;
                margin-bottom: 1rem;
                overflow: hidden;
            }

            .tutorial-progress-bar {
                height: 100%;
                background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
                border-radius: 2px;
                transition: width 0.3s ease;
            }

            .tutorial-buttons {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 1rem;
            }

            .tutorial-btn {
                background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
                color: white;
                border: none;
                padding: 0.8rem 1.5rem;
                border-radius: 25px;
                cursor: pointer;
                font-family: "Cinzel", serif;
                font-size: 1rem;
                transition: all 0.3s ease;
                box-shadow: 0 5px 15px rgba(153, 105, 255, 0.3);
            }

            .tutorial-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(153, 105, 255, 0.5);
            }

            .tutorial-btn.tutorial-prev {
                background: linear-gradient(45deg, var(--tertiary-color), var(--accent-color));
            }

            .tutorial-highlight {
                position: relative;
                z-index: 16000;
                animation: tutorialHighlight 2s ease-in-out infinite;
            }

            .tutorial-highlight::before {
                content: '';
                position: absolute;
                top: -10px;
                left: -10px;
                right: -10px;
                bottom: -10px;
                border: 3px solid var(--primary-color);
                border-radius: 15px;
                animation: tutorialPulse 1.5s ease-in-out infinite;
                pointer-events: none;
            }

            @keyframes slideInScale {
                from { 
                    opacity: 0; 
                    transform: scale(0.8) translateY(50px); 
                }
                to { 
                    opacity: 1; 
                    transform: scale(1) translateY(0); 
                }
            }

            @keyframes tutorialHighlight {
                0%, 100% { 
                    box-shadow: 0 0 20px var(--primary-color); 
                }
                50% { 
                    box-shadow: 0 0 40px var(--primary-color); 
                }
            }

            @keyframes tutorialPulse {
                0%, 100% { 
                    opacity: 0.5; 
                    transform: scale(1); 
                }
                50% { 
                    opacity: 1; 
                    transform: scale(1.05); 
                }
            }

            /* Enhanced responsive design for tutorial */
            @media (max-width: 768px) {
                .tutorial-content {
                    max-width: 95%;
                    margin: 1rem;
                }
                
                .tutorial-header,
                .tutorial-body,
                .tutorial-footer {
                    padding: 1rem;
                }
                
                .tutorial-buttons {
                    flex-direction: column;
                }
                
                .tutorial-btn {
                    width: 100%;
                }
            }
        `;

        // Enhanced accessibility features
        const accessibilityStyles = `
            /* Enhanced focus styles */
            .card:focus,
            .mystical-btn:focus,
            .control-btn:focus {
                outline: 3px solid var(--accent-color);
                outline-offset: 3px;
            }

            /* High contrast mode support */
            @media (prefers-contrast: high) {
                :root {
                    --primary-color: #0066cc;
                    --secondary-color: #cc0066;
                    --text-color: #ffffff;
                    --bg-color: #000000;
                }
            }

            /* Reduced motion support */
            @media (prefers-reduced-motion: reduce) {
                * {
                    animation-duration: 0.01ms !important;
                    animation-iteration-count: 1 !important;
                    transition-duration: 0.01ms !important;
                }
                
                .floating-symbol {
                    animation: none !important;
                }
                
                .card:hover {
                    transform: none !important;
                }
            }

            /* Screen reader only content */
            .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            /* Enhanced keyboard navigation */
            .keyboard-user .card:focus {
                z-index: 1000;
                transform: scale(1.1);
            }

            /* Color blind friendly indicators */
            .card.rare::after {
                content: "R";
                position: absolute;
                top: 5px;
                left: 5px;
                font-size: 0.8rem;
                font-weight: bold;
                color: var(--text-color);
            }

            .card.epic::after {
                content: "E";
                position: absolute;
                top: 5px;
                left: 5px;
                font-size: 0.8rem;
                font-weight: bold;
                color: var(--text-color);
            }

            .card.legendary::after {
                content: "L";
                position: absolute;
                top: 5px;
                left: 5px;
                font-size: 0.8rem;
                font-weight: bold;
                color: var(--text-color);
            }

            .card.mythic::after {
                content: "M";
                position: absolute;
                top: 5px;
                left: 5px;
                font-size: 0.8rem;
                font-weight: bold;
                color: var(--text-color);
            }
        `;

        // Enhanced performance optimization styles
        const performanceStyles = `
            /* GPU acceleration for animations */
            .card,
            .mystical-btn,
            .floating-symbol,
            .particle {
                will-change: transform;
                transform: translateZ(0);
            }

            /* Optimize repaints */
            .card-table {
                contain: layout style paint;
            }

            /* Optimize font loading */
            @font-display: swap;

            /* Optimize image loading */
            img {
                loading: lazy;
                decoding: async;
            }

            /* Container queries for responsive design */
            @container (min-width: 768px) {
                .card {
                    width: 220px;
                    height: 380px;
                }
            }

            @container (min-width: 1200px) {
                .card {
                    width: 250px;
                    height: 420px;
                }
            }
        `;

        // Inject all additional styles
        const allStyles = tutorialStyles + accessibilityStyles + performanceStyles;
        const additionalStyleSheet = document.createElement('style');
        additionalStyleSheet.textContent = allStyles;
        document.head.appendChild(additionalStyleSheet);

        // Enhanced service worker for offline functionality
        const serviceWorkerCode = `
            const CACHE_NAME = 'mystical-cards-v2';
            const urlsToCache = [
                '/',
                '/index.html',
                '/styles.css',
                '/script.js',
                'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css',
                'https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Poiret+One&family=Uncial+Antiqua&display=swap',
                'https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css'
            ];

            self.addEventListener('install', (event) => {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then((cache) => cache.addAll(urlsToCache))
                );
            });

            self.addEventListener('fetch', (event) => {
                event.respondWith(
                    caches.match(event.request)
                        .then((response) => {
                            if (response) {
                                return response;
                            }
                            return fetch(event.request);
                        })
                );
            });

            self.addEventListener('activate', (event) => {
                event.waitUntil(
                    caches.keys().then((cacheNames) => {
                        return Promise.all(
                            cacheNames.map((cacheName) => {
                                if (cacheName !== CACHE_NAME) {
                                    return caches.delete(cacheName);
                                }
                            })
                        );
                    })
                );
            });
        `;

        // Register service worker
        if ('serviceWorker' in navigator) {
            const blob = new Blob([serviceWorkerCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(registration => {
                    console.log('Service Worker registered successfully');
                })
                .catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
        }

        // Enhanced Web App Manifest
        const manifest = {
            name: "Mystical Fortune Cards - Ultimate Enhanced Edition",
            short_name: "Mystical Cards",
            description: "Discover your cosmic destiny through ancient divination",
            start_url: "/",
            display: "standalone",
            theme_color: "#9969ff",
            background_color: "#0a0a0a",
            icons: [
                {
                    src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiM5OTY5ZmYiLz4KPHRleHQgeD0iOTYiIHk9IjEwNCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjY0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+UruKcqO+4jzwvdGV4dD4KPC9zdmc+",
                    sizes: "192x192",
                    type: "image/svg+xml"
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
        const manifestUrl = URL.createObjectURL(manifestBlob);
        
        const manifestLink = document.createElement('link');
        manifestLink.rel = 'manifest';
        manifestLink.href = manifestUrl;
        document.head.appendChild(manifestLink);

        // Enhanced meta tags for SEO and social sharing
        const metaTags = [
            { name: 'description', content: 'Discover your cosmic destiny through the ancient art of divination with Mystical Fortune Cards. Interactive mystical experience with particle effects, achievements, and personalized readings.' },
            { name: 'keywords', content: 'fortune cards, mystical, divination, cosmic, spiritual, tarot, oracle, fortune telling, mystical experience' },
            { name: 'author', content: 'Mystical Fortune Cards' },
            { property: 'og:title', content: 'Mystical Fortune Cards - Ultimate Enhanced Edition' },
            { property: 'og:description', content: 'Discover your cosmic destiny through ancient divination' },
            { property: 'og:type', content: 'website' },
            { property: 'og:image', content: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwMCIgaGVpZ2h0PSI2MzAiIHZpZXdCb3g9IjAgMCAxMjAwIDYzMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEyMDAiIGhlaWdodD0iNjMwIiBmaWxsPSIjMGEwYTBhIi8+Cjx0ZXh0IHg9IjYwMCIgeT0iMzE1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iNjQiIGZpbGw9IiM5OTY5ZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPk15c3RpY2FsIEZvcnR1bmUgQ2FyZHM8L3RleHQ+CjwvdGV4dD4KPC9zdmc+' },
            { name: 'twitter:card', content: 'summary_large_image' },
            { name: 'twitter:title', content: 'Mystical Fortune Cards - Ultimate Enhanced Edition' },
            { name: 'twitter:description', content: 'Discover your cosmic destiny through ancient divination' },
            { name: 'viewport', content: 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' },
            { name: 'theme-color', content: '#9969ff' },
            { name: 'apple-mobile-web-app-capable', content: 'yes' },
            { name: 'apple-mobile-web-app-status-bar-style', content: 'black-translucent' },
            { name: 'apple-mobile-web-app-title', content: 'Mystical Cards' }
        ];

        metaTags.forEach(tag => {
            const metaElement = document.createElement('meta');
            if (tag.name) metaElement.name = tag.name;
            if (tag.property) metaElement.property = tag.property;
            metaElement.content = tag.content;
            document.head.appendChild(metaElement);
        });

        // Enhanced final initialization message
        console.log('🌟 Mystical Fortune Cards - Ultimate Enhanced Edition fully loaded! 🌟');
        console.log('✨ All systems operational - ready for cosmic exploration! ✨');
    </script>
</body>
</html>

